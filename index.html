<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HOME ROUGH EDITOR v0.95</title>
  <!--
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="all.min.css"/>
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body style="background:#f2eee5;margin:0;padding:0;">

<div id="extension-floorplanner-content">
    
    <div id="extension-floorplanner-content-container">
		<div id="extension-floorplanner-first-run-hint">
			<div>
				
				<h1>Floorplanner</h1>
				<p>This design tool allows you to draw a floorplan for your home. Start by clicking on the wall button to the left, and drawing the first room.</p>
				<div style="text-align:right">
					<button class="text-button" id="extension-floorplanner-accept-limitations-button">I understand</button>
				</div>
				
			</div>
		</div>
        <div id="extension-floorplanner-main">
		    <div id="extension-floorplanner-tool-root">
			    <header>Floorplanner</header>
				<div id="extension-floorplanner-svg-container">
				    <svg id="extension-floorplanner-lin" viewBox="0 0 1100 700" preserveAspectRatio="xMidYMin slice" xmlns="http://www.w3.org/2000/svg"
				      style="margin:0;padding:0;width:100vw;height:100vh;position:absolute;top:0;left:0;right:0;bottom:0">

				      <defs>
				        <linearGradient id="extension-floorplanner-gradientRed" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#e65d5e" stop-opacity="1" />
				          <stop offset="100%" stop-color="#e33b3c" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientYellow" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#FDEB71" stop-opacity="1" />
				          <stop offset="100%" stop-color="#F8D800" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientGreen" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#c0f7d9" stop-opacity="1" />
				          <stop offset="100%" stop-color="#6ce8a3" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientSky" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#c4e0f4" stop-opacity="1" />
				          <stop offset="100%" stop-color="#87c8f7" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientOrange" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#f9ad67" stop-opacity="1" />
				          <stop offset="100%" stop-color="#f97f00" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientWhite" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#ffffff" stop-opacity="1" />
				          <stop offset="100%" stop-color="#f0f0f0" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientGrey" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#666" stop-opacity="1" />
				          <stop offset="100%" stop-color="#aaa" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientBlue" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#4f72a6" stop-opacity="1" />
				          <stop offset="100%" stop-color="#365987" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientPurple" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#E2B0FF" stop-opacity="1" />
				          <stop offset="100%" stop-color="#9F44D3" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientPink" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#f6c4dd" stop-opacity="1" />
				          <stop offset="100%" stop-color="#f699c7" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientBlack" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#3c3b3b" stop-opacity="1" />
				          <stop offset="100%" stop-color="#000000" stop-opacity="1" />
				        </linearGradient>
				        <linearGradient id="extension-floorplanner-gradientNeutral" x1="0%" y1="0%" x2="100%" y2="100%" spreadMethod="pad">
				          <stop offset="0%" stop-color="#dbc6a0" stop-opacity="1" />
				          <stop offset="100%" stop-color="#c69d56" stop-opacity="1" />
				        </linearGradient>

				        <pattern id="extension-floorplanner-grass" patternUnits="userSpaceOnUse" width="256" height="256">
				          <image
				            src="/extensions/floorplanner/images/grass.jpg"
				            x="0" y="0" width="256" height="256" />
				        </pattern>
				        <pattern id="extension-floorplanner-wood" patternUnits="userSpaceOnUse" width="32" height="256">
				          <image
				  		  src="/extensions/floorplanner/images/planks.jpg"
				            x="0" y="0" width="256" height="256" />
				        </pattern>
				        <pattern id="extension-floorplanner-tiles" patternUnits="userSpaceOnUse" width="25" height="25">
				          <image
				            src="/extensions/floorplanner/images/tiles.jpg"
				            x="0" y="0" width="256" height="256" />
				        </pattern>
				        <pattern id="extension-floorplanner-granite" patternUnits="userSpaceOnUse" width="256" height="256">
				          <image
				            src="/extensions/floorplanner/images/granite.jpg"
				            x="0" y="0" width="256" height="256" />
				        </pattern>
				        <pattern id="extension-floorplanner-smallGrid" width="60" height="60" patternUnits="userSpaceOnUse">
				          <path d="M 60 0 L 0 0 0 60" fill="none" stroke="#777" stroke-width="0.25" />
				        </pattern>
				        <pattern id="extension-floorplanner-grid" width="180" height="180" patternUnits="userSpaceOnUse">
				          <rect width="180" height="180" fill="url(#extension-floorplanner-smallGrid)" />
				          <path d="M 200 10 L 200 0 L 190 0 M 0 10 L 0 0 L 10 0 M 0 190 L 0 200 L 10 200 M 190 200 L 200 200 L 200 190"
				            fill="none" stroke="#999" stroke-width="0.8" />
				        </pattern>
				        <pattern id="extension-floorplanner-hatch" width="5" height="5" patternTransform="rotate(50 0 0)" patternUnits="userSpaceOnUse">
				          <path d="M 0 0 L 0 5 M 10 0 L 10 10 Z" style="stroke:#666;stroke-width:5;" />
				        </pattern>
				      </defs>
				      <g id="extension-floorplanner-boxgrid">
				        <rect width="8000" height="5000" x="-3500" y="-2000" fill="url(#extension-floorplanner-grid)" />
				      </g>
				      <g id="extension-floorplanner-boxpath"></g>
				      <g id="extension-floorplanner-boxSurface"></g>
				      <g id="extension-floorplanner-boxRoom"></g>
				      <g id="extension-floorplanner-boxwall"></g>
				      <g id="extension-floorplanner-boxcarpentry"></g>
				      <g id="extension-floorplanner-boxEnergy"></g>
				      <g id="extension-floorplanner-boxFurniture"></g>
				      <g id="extension-floorplanner-boxbind"></g>
				      <g id="extension-floorplanner-boxArea"></g>
				      <g id="extension-floorplanner-boxRib"></g>
				      <g id="extension-floorplanner-boxScale"></g>
				      <g id="extension-floorplanner-boxText"></g>
				      <g id="extension-floorplanner-boxDebug"></g>
				    </svg>
			    </div>

			    <div id="extension-floorplanner-areaValue"></div>

			    <div id="extension-floorplanner-reportTools" class="extension-floorplanner-leftBox" style="width:500px;overflow-y: scroll;overflow-x: hidden;position:relative;z-index:100">
			      <h2>CALCULATOR Report plan.</h2>
			      <br /><br />
			      <h2 class="extension-floorplanner-toHide" id="extension-floorplanner-reportTotalSurface" style="display:none"></h2>
			      <h2 class="extension-floorplanner-toHide" id="extension-floorplanner-reportNumberSurface" style="display:none"></h2>
			      <hr />
			      <section id="extension-floorplanner-reportRooms" class="extension-floorplanner-toHide" style="display:none">
			      </section>
			      <button class="extension-floorplanner-btn extension-floorplanner-btn-info extension-floorplanner-btn-done extension-floorplanner-fully" id="extension-floorplanner-reportTools-done-button" style="margin-top:50px"
			        onclick="document.querySelector('#extension-floorplanner-reportTools').style.display='none';document.querySelector('#extension-floorplanner-panel').style.display='block';mode = 'select_mode';">DONE</button>
			    </div>

			    <div id="extension-floorplanner-wallTools" class="extension-floorplanner-leftBox">
						<div class="extension-floorplanner-vertical-flex-between">
							<div>
					      <h2 id="extension-floorplanner-titleWallTools">Modify the wall</h2>
					      <hr />
					      <section id="extension-floorplanner-rangeThick">
					        <p>Width [<span id="extension-floorplanner-wallWidthScale"></span>] : <span id="extension-floorplanner-wallWidthVal"></span> cm</span></p>
					        <input type="range" id="extension-floorplanner-wallWidth" step="0.1" class="extension-floorplanner-range" />
					      </section>
					      <ul class="extension-floorplanner-list-unstyled">
					        <section id="extension-floorplanner-cutWall">
					          <p>Cut the wall :<br /><small>A cut will be made at each wall encountered.</small></p>
					          <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" onclick="floorplanEditor.splitWall();">CUTLERY</button></li>
					        </section>

					        <section id="extension-floorplanner-separate">
					          <p>Separation wall :<br /><small>Transform the wall into simple separation line.</small></p>
					          <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" onclick="floorplanEditor.invisibleWall();" id="extension-floorplanner-wallInvisible">CROP</button></li>
					        </section>
					        <section id="extension-floorplanner-recombine">
					          <p>Transform to wall :<br /><small>The thickness will be identical to the last known.</small></p>
					          <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" onclick="floorplanEditor.visibleWall();" id="extension-floorplanner-wallVisible">CROP</button></li>
					        </section>

					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-info extension-floorplanner-btn-done extension-floorplanner-fully" style="margin-top:50px"
					            onclick="fonc_button('select_mode');document.querySelector('#extension-floorplanner-boxinfo').innerHTML='Selection mode';document.querySelector('#extension-floorplanner-wallTools').style.display='none';document.querySelector('#extension-floorplanner-panel').style.display='block'">DONE</button></li>
					      </ul>
							</div>
							<div>
								<ul class="extension-floorplanner-list-unstyled">
					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-danger extension-floorplanner-fully" id="extension-floorplanner-wallTrash"><span class="extension-floorplanner-unicode-icon-large">🗑</span></button></li>
								</ul>
							</div>
						</div>
			    </div>

			    <div id="extension-floorplanner-objBoundingBox" class="extension-floorplanner-leftBox">
			      <div class="extension-floorplanner-vertical-flex-between">
							<div>
								<h2>Modify object</h2>
					      <hr />
					      <section id="extension-floorplanner-objBoundingBoxScale">
					        <p>Width<span class="extension-floorplanner-show-if-developer"> [<span id="extension-floorplanner-bboxWidthScale"></span>]: <span id="extension-floorplanner-bboxWidthVal"></span> cm</span></span></p>
					        <input type="range" id="extension-floorplanner-bboxWidth" step="1" class="extension-floorplanner-range" />
					        <p>Length<span class="extension-floorplanner-show-if-developer"> [<span id="extension-floorplanner-bboxHeightScale"></span>]: <span id="extension-floorplanner-bboxHeightVal"></span> cm</span></span></p>
					        <input type="range" id="extension-floorplanner-bboxHeight" step="1" class="extension-floorplanner-range" />
					      </section>
						
								<hr />
					      <section id="extension-floorplanner-objBoundingBoxRotation">
					        <p>Rotation</p>
					        <input type="range" id="extension-floorplanner-bboxRotation" step="1" class="extension-floorplanner-range" min="-180" max="180" />
									<div style="text-align:center"><span id="extension-floorplanner-bboxRotationVal"></span> °</div>
					      </section>

								<div class="extension-floorplanner-show-if-developer">
						      <div id="extension-floorplanner-stepsCounter" style="display:none;">
						        <p><span id="extension-floorplanner-bboxSteps">Nb steps [2-15] : <span id="extension-floorplanner-bboxStepsVal">0</span></span></p>
										<div class="extension-floorplanner-flex-between">
						        	<button class="extension-floorplanner-btn extension-floorplanner-btn-info" id="extension-floorplanner-bboxStepsAdd">+</button>
						        	<button class="extension-floorplanner-btn extension-floorplanner-btn-info" id="extension-floorplanner-bboxStepsMinus">-</button>
										</div>
						      </div>
								</div>

					      <div id="extension-floorplanner-objBoundingBoxColor" style="display:none">
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientRed"
					          style="color:#f55847;background:linear-gradient(30deg, #f55847, #f00);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientYellow"
					          style="color:#e4c06e;background:linear-gradient(30deg,#e4c06e, #ffb000);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientGreen"
					          style="color:#88cc6c;background:linear-gradient(30deg,#88cc6c, #60c437);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientSky"
					          style="color:#77e1f4;background:linear-gradient(30deg,#77e1f4, #00d9ff);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientBlue"
					          style="color:#4f72a6;background:linear-gradient(30deg,#4f72a6, #284d7e);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientGrey"
					          style="color:#666666;background:linear-gradient(30deg,#666666, #aaaaaa);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientWhite"
					          style="color:#fafafa;background:linear-gradient(30deg,#fafafa, #eaeaea);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientOrange"
					          style="color:#f9ad67;background:linear-gradient(30deg, #f9ad67, #f97f00);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientPurple"
					          style="color:#a784d9;background:linear-gradient(30deg,#a784d9, #8951da);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientPink"
					          style="color:#df67bd;background:linear-gradient(30deg,#df67bd, #e22aae);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientBlack"
					          style="color:#3c3b3b;background:linear-gradient(30deg,#3c3b3b, #000000);"></div>
					        <div class="extension-floorplanner-color textEditorColor" data-type="gradientNeutral"
					          style="color:#e2c695;background:linear-gradient(30deg,#e2c695, #c69d56);"></div>
					        <div style="clear:both"></div>
					      </div>

					      <br /><br />
				      
					      <button class="extension-floorplanner-btn extension-floorplanner-btn-info extension-floorplanner-btn-done"
					        onclick="save_object();">DONE</button>

							</div>
						
							<div>
								<ul class="extension-floorplanner-list-unstyled">
					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-danger extension-floorplanner-fully" id="extension-floorplanner-bboxTrash"><span class="extension-floorplanner-unicode-icon-large">🗑</span></button></li>
								</ul>
							</div>
						</div>
						
			    </div>




			    <div id="extension-floorplanner-objTools" class="extension-floorplanner-leftBox">
			      <div class="extension-floorplanner-vertical-flex-between">
							<div>
								<h2>Modify door/window</h2>
					      <hr />
					      <ul class="extension-floorplanner-list-unstyled">
									<br />
					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-objToolsHinge">Reverse hinges</button></li>

					        <p>Width<span class="extension-floorplanner-show-if-developer"> [<span id="extension-floorplanner-doorWindowWidthScale"></span>] : <span id="extension-floorplanner-doorWindowWidthVal"></span> cm</span></span></p>
					        <input type="range" id="extension-floorplanner-doorWindowWidth" step="1" class="extension-floorplanner-range" />

				        
					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-info extension-floorplanner-btn-done" style="margin-top:100px"
					            onclick="fonc_button('select_mode');document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Selection mode';document.querySelector('#extension-floorplanner-objTools').style.display='none';document.querySelector('#extension-floorplanner-panel').style.display='block';binder.graph.remove();bye_binder();rib();">DONE</button></li>
					      </ul>
							</div>
							<div>
								<ul class="extension-floorplanner-list-unstyled">
					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-danger extension-floorplanner-fully extension-floorplanner-objTrash"><span class="extension-floorplanner-unicode-icon-large">🗑</span></button>
					        </li>
								</ul>
							</div>
						</div>
			    </div>




			    <div id="extension-floorplanner-roomTools" class="extension-floorplanner-leftBox">

			      <div class="extension-floorplanner-show-if-developer">
							<span style="color:#08d">Room</span><br/>
							Estimated a surface of:<br /><b><span class="extension-floorplanner-size"></span></b>
				      <br /><br />
				      <p>If you have the actual area, you can write it</p>
				      <div class="extension-floorplanner-input-group">
				        <input type="text" class="extension-floorplanner-form-control" id="extension-floorplanner-roomSurface" placeholder="Real surface area"
				          aria-describedby="basic-addon2">
				        <span class="extension-floorplanner-input-group-addon" id="extension-floorplanner-basic-addon2">m²</span>
				      </div>
				      <br />
				      <input type="hidden" id="extension-floorplanner-roomName" value="" />
				      Wording:<br />
				      <select class="extension-floorplanner-form-select" aria-label="Default select example" id="extension-floorplanner-roomLabel">
				        <option selected value="0">None</option>
				        <option value="1">Lounge</option>
				        <option value="2">Lunchroom</option>
				        <option value="3">Kitchen</option>
				        <option value="4">Toilet</option>
				        <option value="5">Bathroom</option>
				        <option value="6">Bedroom 1</option>
				        <option value="7">Bedroom 2</option>
				        <option value="8">Bedroom 3</option>
				        <option value="9">Locker</option>
				        <option value="10">Office</option>
				        <option value="11">Hall</option>
				        <option value="12">Loggia</option>
				        <option value="13">Bath 2</option>
				        <option value="14">Toilet 2</option>
				        <option value="15">Bedroom 4</option>
				        <option value="16">Bedroom 5</option>
				        <option value="17">Balcony</option>
				        <option value="18">Terrace</option>
				        <option value="19">Corridor</option>
				        <option value="20">Garage</option>
				        <option value="21">Clearance</option>
				      </select>
				      <br />
				      <br />
				      Meter:
				      <div class="extension-floorplanner-funkyradio">
				        <div class="extension-floorplanner-funkyradio-success">
				          <input type="checkbox" name="roomShow" value="showSurface" id="extension-floorplanner-seeArea" checked />
				          <label for="extension-floorplanner-seeArea">Show the surface</label>
				        </div>
				      </div>
				      <div class="extension-floorplanner-funkyradio">
				        <div class="extension-floorplanner-funkyradio-success">
				          <input type="radio" name="roomAction" id="extension-floorplanner-addAction" value="add" checked />
				          <label for="extension-floorplanner-addAction">Add the surface</label>
				        </div>
				        <div class="extension-floorplanner-funkyradio-warning">
				          <input type="radio" name="roomAction" id="extension-floorplanner-passAction" value="pass" />
				          <label for="extension-floorplanner-passAction">Ignore the surface</label>
				        </div>
				      </div>
				      <hr />
						</div>

			      <p>Room Colors</p>
							<div class="extension-floorplanner-flex-between extension-floorplanner-flex-wrap">
				      <div class="extension-floorplanner-roomColor" data-type="gradientRed" style="background:linear-gradient(30deg, #f55847, #f00);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientYellow" style="background:linear-gradient(30deg,#e4c06e, #ffb000);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientGreen" style="background:linear-gradient(30deg,#88cc6c, #60c437);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientSky" style="background:linear-gradient(30deg,#77e1f4, #00d9ff);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientBlue" style="background:linear-gradient(30deg,#4f72a6, #284d7e);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientGrey" style="background:linear-gradient(30deg,#666666, #aaaaaa);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientWhite" style="background:linear-gradient(30deg,#fafafa, #eaeaea);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientOrange" style="background:linear-gradient(30deg, #f9ad67, #f97f00);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientPurple" style="background:linear-gradient(30deg,#a784d9, #8951da);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientPink" style="background:linear-gradient(30deg,#df67bd, #e22aae);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientBlack" style="background:linear-gradient(30deg,#3c3b3b, #000000);"></div>
				      <div class="extension-floorplanner-roomColor" data-type="gradientNeutral" style="background:linear-gradient(30deg,#e2c695, #c69d56);"></div>
						</div>
						<div class="extension-floorplanner-show-if-developer">
							<br /><br />
				      <p>Materials</p>
				      <div class="extension-floorplanner-roomColor" data-type="wood"
				        style="background: url('/extensions/floorplanner/images/planks.jpg');">
				      </div>
				      <div class="extension-floorplanner-roomColor" data-type="tiles"
				        style="background: url('/extensions/floorplanner/images/tiles.jpg');">
				      </div>
				      <div class="extension-floorplanner-roomColor" data-type="granite"
				        style="background: url('/extensions/floorplanner/images/granite.jpg');">
				      </div>
				      <div class="extension-floorplanner-roomColor" data-type="grass"
				        style="background: url('/extensions/floorplanner/images/grass.jpg');">
				      </div>
				      <div data-type="#ff008a" style="clear:both"></div>
				      <br /><br />
				      <input type="hidden" id="extension-floorplanner-roomBackground" value="gradientNeutral" />
				      <input type="hidden" id="extension-floorplanner-roomIndex" value="" />
						</div>
						<br/><br/>
			      <button type="button" class="extension-floorplanner-btnextension-floorplanner-btn-primary extension-floorplanner-btn-done" id="extension-floorplanner-applySurface">Apply</button><br/><br/>
			      <button type="button" class="extension-floorplanner-btn extension-floorplanner-btn-danger" id="extension-floorplanner-resetRoomTools">Cancel</button>

			      <br />
			    </div>













			    <div id="extension-floorplanner-panel" class="extension-floorplanner-leftBox">
						<div id="extension-floorplanner-panel-scroller">
					      <ul class="extension-floorplanner-list-unstyled">
					        <li class="extension-floorplanner-flex-between"><button class="extension-floorplanner-btn extension-floorplanner-disabled extension-floorplanner-halfy" id="extension-floorplanner-undo" title="undo"><span>↺</span></button>
					            <button class="extension-floorplanner-btn extension-floorplanner-disabled extension-floorplanner-halfy extension-floorplanner-pull-right" id="extension-floorplanner-redo" title="redo"><span>↻</span></button>
					        </li>

					        <li><button class="extension-floorplanner-btn extension-floorplanner-btn-success extension-floorplanner-fully" id="extension-floorplanner-select_mode" style="box-shadow:2px 2px 3px #ccc;" title="Select objects"><span>◄</span></button></li>

					        <li id="extension-floorplanner-wall-buttons">
										<div class="extension-floorplanner-vertical-shrinker2">
						          <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" style="margin-bottom:0px" id="extension-floorplanner-line_mode" data-toggle="tooltip"
						            data-placement="right" title="Make walls"><span class="extension-floorplanner-unicode-icon-large">🧱</span></button>
						          <button class="extension-floorplanner-mt-2 expansion-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-show-if-room extension-floorplanner-shadow extension-floorplanner-fully" style="margin-bottom:0px" id="extension-floorplanner-partition_mode"
						            data-toggle="tooltip" data-placement="right" title="Make room dividers (small walls)"><span class="extension-floorplanner-unicode-icon-medium">━</span></button>
										</div>
										<div id="extension-floorplanner-multi-container" class="extension-floorplanner-funkyradio extension-floorplanner-flex-between" title="Draw multiple lines in a row">
											<div id="extension-floorplanner-multi-container-zigzag"><span>⦚</span></div>
					            <div class="extension-floorplanner-funkyradio-success">
					              <input type="checkbox" id="extension-floorplanner-multi" />
					              <label for="extension-floorplanner-multi"></label>
					            </div>
					          </div>
					        </li>


									 <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-node_mode" title="Cut walls, giving them an extra joint to move"><span class="extension-floorplanner-unicode-icon-medium">✂</span></button></li>
							 
					        
			       

					        <li style="display:none"><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-distance_mode" data-toggle="tooltip" data-placement="right"
					            title="Add a measurement">MEASURE</button></li>
			        

					        <div id="extension-floorplanner-door_list" class="extension-floorplanner-list-unstyled extension-floorplanner-sub"
					          style="box-shadow:2px 2px 3px #ccc;display:none;background:#fff;border-radius: 0 5px 5px 0; padding:10px;position:absolute;left:100px;width:150px">
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-door" data-type="aperture" id="extension-floorplanner-aperture">Opening</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-door" data-type="simple" id="extension-floorplanner-simple">Simple</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-door" data-type="double" id="extension-floorplanner-double">Double</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-door" data-type="pocket" id="extension-floorplanner-pocket">Pocket</button>
					        </div>
									
									
					        <li class="extension-floorplanner-show-if-room">
										<div class="extension-floorplanner-vertical-shrinker">
											<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-door_mode"
					            onclick="hide_submenus();document.querySelector('#extension-floorplanner-door_list').style.display='block';document.querySelector('#extension-floorplanner-window_list').style.display='none'" title="Add a door to a wall"><span class="extension-floorplanner-unicode-icon-large">🚪</span></button>

					        		<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-window_mode"
					            onclick="hide_submenus();document.querySelector('#extension-floorplanner-window_list').style.display='block';document.querySelector('#extension-floorplanner-door_list').style.display='none'" title="Add a window to a wall"><span class="extension-floorplanner-unicode-icon-large">🪟</span></button>
										</div>
									</li>
			        
					        <div id="extension-floorplanner-window_list" class="extension-floorplanner-list-unstyled extension-floorplanner-sub"
					          style="box-shadow:2px 2px 3px #ccc;display:none;background:#fff;border-radius: 0 5px 5px 0; padding:10px;position:absolute;left:100px;width:150px">
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-window" id="extension-floorplanner-fix">Fix</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-window" id="extension-floorplanner-flap">Simple</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-window" id="extension-floorplanner-twin">Double</button>
					          <button class="extension-floorplanner-btn extension-floorplanner-fully extension-floorplanner-window" id="extension-floorplanner-bay">Slide</button>
					        </div>
							
									<li class="extension-floorplanner-show-if-room">
										<div class="extension-floorplanner-vertical-shrinker">
											<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-stair_mode"
							            onclick="hide_submenus();document.querySelector('#extension-floorplanner-door_list').style.display='none'" title="Add a staircase"><span class="extension-floorplanner-unicode-icon-large">🪜</span></button>

							        <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-room_mode" title="Give rooms a background color"><span class="extension-floorplanner-unicode-icon-large">🎨</span></button>
										</div>
									</li>
									

					        <div id="extension-floorplanner-energy_list" class="extension-floorplanner-list-unstyled extension-floorplanner-sub"
					          style="box-shadow:2px 2px 3px #ccc;display:none;background:#fff;border-radius: 0 5px 5px 0; padding:10px;position:absolute;left:100px;bottom:40px;width:600px">
					          <div style="width:600px;float:left;padding:10px">
					            <p>🛋️ Furniture</p>
									
					            <div style="float:left;padding:10px;margin:5px;border:1px solid #ddd;border-radius:5px">
					              <p>Generic shapes</p>
					              <div style="width:120px;float:left;padding:2px">
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-circle">◌ Circle</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-half-circle">◖ Half circle</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-square">□ Square</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-rounded-square1">□ Rounded square</button>
											
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-triangle">▲ Triangle</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-heart">♥ Heart</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-droplet">💧 Droplet</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-half-rounded-square">⥰ Half rounded square</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-chair">✿ Flower</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-button1">◘ Button</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-button2">◙ Button</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-paw">🐾 Paw</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-note">♪ Audio</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-wifi">⌔ Wifi</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-bed">🛏 Bed</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-star">★ Star</button>
													<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-pill">💊 Pill</button>
											
												</div>
					            </div>
									
					            <div style="float:left;padding:10px;margin:5px;border:1px solid #ddd;border-radius:5px">
					              <p>High current</p>
					              <div style="width:120px;float:left;padding:2px">
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-gtl">Switchboard</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-switch">Switch</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-doubleSwitch">Multiways</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-dimmer">◌ Variator</button>

					              </div>
					              <div style="width:120px;float:left;padding:2px">
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-plug">Electrical outlet</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-plug20">Outlet 20A</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-plug32">Outlet 32A</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-rooflight extension-floorplanner-shadow">Ceiling lamp</button>
					                <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-walllight extension-floorplanner-shadow">Wall light</button>
					              </div>
					            </div>
					            <div style="width:130px;float:left;padding:10px;margin:5px;border:1px solid #ddd;border-radius:5px">
					              <p>Wall plugs</p>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-www">Internet access</button>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-rj45">RJ45 plug</button>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-tv">Antenna plug</button>
					            </div>

					            <div style="width:130px;float:left;padding:10px;margin:5px;border:1px solid #ddd;border-radius:5px">
					              <p>Heating & Cooling</p>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object extension-floorplanner-hidden" id="extension-floorplanner-boiler">Boiler</button>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-heater">◍ Water heater</button>
					              <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-fully extension-floorplanner-object" id="extension-floorplanner-radiator">▥ Radiator</button>
					            </div>
					          </div>

					        </div>
					        <li class="extension-floorplanner-show-if-room">
										<div class="extension-floorplanner-vertical-shrinker3">
											<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-object_mode"
					            	onclick="toggle_furniture();"><span class="extension-floorplanner-unicode-icon-large">🛋</span></button>
											<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-text_mode" data-toggle="tooltip" data-placement="right"
												title="Add text"><span class="extension-floorplanner-unicode-icon-large" style="font-family:'serif'">A</span></button>
										</div>
									</li>
					        <!-- <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-object_mode" onclick="hide_submenus();document.querySelector('#extension-floorplanner-object_list').style.display='block';">FURNITURE</button></li> -->


					    <li class="extension-floorplanner-show-if-room"><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-layer_mode"
					            onclick="toggle_layers();"><span style="display:inline-block;transform:rotate(90deg)">〣</span>  Layers</button></li>
					

					        <div id="extension-floorplanner-layer_list" class="extension-floorplanner-list-unstyled extension-floorplanner-sub">
					          <div class="extension-floorplanner-funkyradio">
					            <div class="extension-floorplanner-funkyradio-info">
					              <input type="checkbox" id="extension-floorplanner-showRib" checked />
					              <label for="extension-floorplanner-showRib"></label>
					            </div>
											<div><span class="extension-floorplanner-unicode-icon-medium">📐</span></div>
					          </div>
										<!--
					          <div class="extension-floorplanner-funkyradio" style="font-size:0.8em">
					            <div class="extension-floorplanner-funkyradio-info">
					              <input type="checkbox" id="extension-floorplanner-showArea" checked />
					              <label for="extension-floorplanner-showArea">Surface area</label>
					            </div>
					          </div>
										-->
					          <div class="extension-floorplanner-funkyradio" title="Show or hide Background colors">
					            <div class="extension-floorplanner-funkyradio-info">
					              <input type="checkbox" id="extension-floorplanner-showLayerRoom" checked />
					              <label for="extension-floorplanner-showLayerRoom"></label>
					            </div>
											<div><span class="extension-floorplanner-unicode-icon-medium">🎨</span></div>
					          </div>
					          <div class="extension-floorplanner-funkyradio">
					            <div class="extension-floorplanner-funkyradio-info">
					              <input type="checkbox" id="extension-floorplanner-showLayerEnergy" checked />
					              <label for="extension-floorplanner-showLayerEnergy"></label>
					            </div>
											<div><span class="extension-floorplanner-unicode-icon-medium">🛋</span></div>
					          </div>
					        </div>

					        <li class="extension-floorplanner-show-if-room"><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-show-if-developer" id="extension-floorplanner-report_mode" title="Show report">📊 Report</button></li>
							
					        <li class="extension-floorplanner-flex-between"><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-halfy extension-floorplanner-pull-right"
					              onclick="fullscreen();this.style.display='none';document.querySelector('#extension-floorplanner-nofull_mode').style.display='block';" id="extension-floorplanner-full_mode"
					              title="Full screen"><span class="extension-floorplanner-unicode-icon-medium"><sup>⇱</sup><sub>⇲</sub></span></button>
					            <button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-halfy extension-floorplanner-pull-right" style="display:none"
					              onclick="outFullscreen();this.style.display='none';document.querySelector('#extension-floorplanner-full_mode').style.display='block';" id="extension-floorplanner-nofull_mode"
					              data-toggle="tooltip" data-placement="right" title="Full screen"><span class="extension-floorplanner-unicode-icon-medium" style="transform:rotate(-90deg);display:inline-block"><sup>⇲</sup><sub>⇱</sub></span></button>
											<button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow" id="extension-floorplanner-svg-download-button" title="Download"><span class="extension-floorplanner-unicode-icon-medium" style="font-weight:bold">⤓</span></button>
					        <li>

					          <div style="clear:both"></div>
								
								
							    <li><button class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-fully" id="extension-floorplanner-new-file-button"
							            onclick="new_floorplan();"><span>📃</span> New</button></li>
								
					      </ul>
			      </div>
			    </div>





			    <div class="extension-floorplanner-modal extension-floorplanner-fade " id="extension-floorplanner-myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			      <div class="extension-floorplanner-modal-dialog modal-lg  modal-dialog-centered" role="document">
			        <div class="extension-floorplanner-modal-content" style="text-align:center">
			          <div class="extension-floorplanner-modal-header">
			            <h2 class="extension-floorplanner-modal-title" id="extension-floorplanner-myModalLabel">📃 Start a new floorplan</h2>
									<p id="extension-floorplanner-plan-exists-warning">This will remove your current floorplan!</p>
			          </div>
			          <div class="extension-floorplanner-modal-body m-2">
			            <div id="extension-floorplanner-recover">
			              <p>Would you like to continue working on your last plan?</p>
			              <button class="extension-floorplanner-btn extension-floorplanner-btn-success extension-floorplanner-shadow" data-bs-dismiss="modal"
			                onclick="initHistory('recovery');">YES</button></p>
			              <hr />
			              <p>Or do you prefer start a new plan ?<br/></p>
			            </div>
			            <div class="extension-floorplanner-w-100 extension-floorplanner-d-flex extension-floorplanner-justify-content-center">
			              <div class="extension-floorplanner-boxMouseOver"><img src="/extension/floorplanner/images/newPlanEmpty.jpg" class="extension-floorplanner-img-fluid" onclick="initHistory('boot');"
			                  data-bs-dismiss="modal" /></div>
			              <div class="extension-floorplanner-boxMouseOver"><img src="/extension/floorplanner/images/newPlanSquare.jpg" class="extension-floorplanner-img-fluid"
			                  onclick="initHistory('newSquare');" data-bs-dismiss="modal" /></div>
			              <div class="extension-floorplanner-boxMouseOver"><img src="/extension/floorplanner/images/newPlanL.jpg" class="extension-floorplanner-img-fluid" onclick="initHistory('newL');"
			                  data-bs-dismiss="modal" /></div>
			            </div>
			          </div>
			          <!-- <div class="extension-floorplanner-modal-footer">
			            <button type="button" class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow" data-dismiss="modal">CLOSE</button>
			            <button type="button" class="extension-floorplanner-btnextension-floorplanner-btn-primary">YES</button>
			          </div> -->
			        </div>
			      </div>
			    </div>





			    <div class="extension-floorplanner-modal extension-floorplanner-fade" id="extension-floorplanner-textToLayer" tabindex="-1" role="dialog" aria-labelledby="textToLayerLabel">
			      <div class="extension-floorplanner-modal-dialog" role="document">
			        <div class="extension-floorplanner-modal-content">
			          <div class="extension-floorplanner-modal-header">
			            <button type="button" class="extension-floorplanner-btn-close" onclick="cancel_adding_text();" data-bs-dismiss="modal" aria-label="Close"><span
			                aria-hidden="true">&times;</span></button>
			            <h4 class="extension-floorplanner-modal-title" id="extension-floorplanner-textToLayerLabel">Text floorplanEditor</h4>
			          </div>
			          <div class="extension-floorplanner-modal-body">
			            <p>Choose room color</p>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientRed"
			              style="color:#f55847;background:linear-gradient(30deg, #f55847, #f00);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientYellow"
			              style="color:#e4c06e;background:linear-gradient(30deg,#e4c06e, #ffb000);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientGreen"
			              style="color:#88cc6c;background:linear-gradient(30deg,#88cc6c, #60c437);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientSky"
			              style="color:#77e1f4;background:linear-gradient(30deg,#77e1f4, #00d9ff);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientBlue"
			              style="color:#4f72a6;background:linear-gradient(30deg,#4f72a6, #284d7e);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientGrey"
			              style="color:#666666;background:linear-gradient(30deg,#666666, #aaaaaa);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientWhite"
			              style="color:#fafafa;background:linear-gradient(30deg,#fafafa, #eaeaea);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientOrange"
			              style="color:#f9ad67;background:linear-gradient(30deg, #f9ad67, #f97f00);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientPurple"
			              style="color:#a784d9;background:linear-gradient(30deg,#a784d9, #8951da);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientPink"
			              style="color:#df67bd;background:linear-gradient(30deg,#df67bd, #e22aae);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientBlack"
			              style="color:#3c3b3b;background:linear-gradient(30deg,#3c3b3b, #000000);"></div>
			            <div class="extension-floorplanner-color textEditorColor" data-type="gradientNeutral"
			              style="color:#e2c695;background:linear-gradient(30deg,#e2c695, #c69d56);"></div>
			            <div style="clear:both"></div>
			            <hr />
			            <p>Room size</p>
			            <input type="range" list="tickmarks" id="extension-floorplanner-sizePolice" step="0.1" min="10" max="30" value="15" class="extension-floorplanner-range"
			              style="width:200px" />
			            <hr />
			            <p contenteditable="true" id="extension-floorplanner-labelBox" onfocus="this.innerHTML='';"
			              style="font-size:15px;padding:5px;border-radius:5px;color:#333">Your text</p>
			          </div>
			          <div class="extension-floorplanner-modal-footer">
			            <button id="extension-floorplanner-cancel-text" type="button" class="extension-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow"  onclick="document.querySelector('#extension-floorplanner-textToLayer').style.display='none';" data-bs-dismiss="modal">Cancel</button>
			            <button id="extension-floorplanner-save-text" type="button" class="extension-floorplanner-btnextension-floorplanner-btn-primary" onclick="document.querySelector('#extension-floorplanner-textToLayer').style.display='none';">Apply</button>
			          </div>
			        </div>
			      </div>
			    </div>

			    <div style="position:absolute;bottom:10px;left:210px;font-size:1.5em;color:#08d" id="extension-floorplanner-boxinfo">
			    </div>

			    <div id="extension-floorplanner-moveBox"
			      style="position:absolute;right:-150px;top:10px;color:#08d;background:transparent;z-index:2;text-align:center;transition-duration: 0.2s;transition-timing-function: ease-in;">
			      
						<p id="extension-floorplanner-title" style="margin:0px 0 0 0;font-size:1rem;font-family:sans-serif">
			        Floorplanner
			      </p>
			      <div class="extension-floorplanner-pull-right" style="margin:10px">
			        <p style="margin:0"><button class="extension-floorplanner-btn btn-xs extension-floorplanner-btn-info extension-floorplanner-zoom" data-zoom="zoomtop"
			            style="box-shadow:2px 2px 3px #ccc;">↑</button></p>
			        <p style="margin:0">
			          <button class="extension-floorplanner-btn btn-xs extension-floorplanner-btn-info extension-floorplanner-zoom" data-zoom="zoomleft" style="box-shadow:2px 2px 3px #ccc;">←</button>
			          <button class="extension-floorplanner-btn btn-xs extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-zoom" data-zoom="zoomreset" style="box-shadow:2px 2px 3px #ccc;">⊙</button>
			          <button class="extension-floorplanner-btn btn-xs extension-floorplanner-btn-info extension-floorplanner-zoom" data-zoom="zoomright" style="box-shadow:2px 2px 3px #ccc;">→</button>
			        </p>
			        <p style="margin:0"><button class="extension-floorplanner-btn btn-xs extension-floorplanner-btn-info extension-floorplanner-zoom" data-zoom="zoombottom"
			            style="box-shadow:2px 2px 3px #ccc;">↓</button></p>
			      </div>
			    </div>

			    <div id="extension-floorplanner-zoomBox"
			      style="position:absolute;z-index:100;right:-150px;bottom:20px;text-align:center;background:transparent;padding:0px;color:#fff;transition-duration: 0.2s;transition-timing-function: ease-in;">
			      <div class="extension-floorplanner-pull-right" style="margin-right:10px">
			        <button class="extension-floorplanner-btn expansion-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-zoom" data-zoom="zoomin" style="box-shadow:2px 2px 3px #ccc;">+</button>
			        <button class="extension-floorplanner-btn expansion-floorplanner-btn extension-floorplanner-btn-light extension-floorplanner-shadow extension-floorplanner-zoom" data-zoom="zoomout" style="box-shadow:2px 2px 3px #ccc;">-</button>
			      </div>
			      <div style="clear:both"></div>
			      <div id="extension-floorplanner-scaleVal" class="extension-floorplanner-pull-right"
			        style="box-shadow:2px 2px 3px #ccc;width:60px;height:20px;background:#4b79aa;border-radius:4px;margin-right:10px">
			        1m
			      </div>

			      <div style="clear:both"></div>
			    </div>
		    </div>
        </div>
        
        <!--
        <div id="extension-floorplanner-overview" class="extension-floorplanner-hidden">
            <h3>Live bookmarks</h3>
            <ul id="extension-floorplanner-tiles-list"></ul>
			
            <input id="extension-floorplanner-tiles-file-selector"  accept=".gif,.png,.jpg,.jpeg,image/gif,image/png,image/jpeg" type="file" />
            <div id="extension-floorplanner-tiles-file-selector-overlay">&nbsp;</div>
           
            <div id="extension-floorplanner-response">
                <p id="extension-floorplanner-response-data"></p>
            </div>
			
        </div>
		-->
        
    </div>
	
	
</div>
</body>
<!--
<script src="jquery-3.6.1.slim.min.js"></script>

<script src="bootstrap.min.js"></script>
-->
<!--
<script src="mousewheel.js"></script>
<script src="func.js"></script>-->
<script src="qSVG.js"></script>
<script src="floorplanEditor.js"></script>
<!--
<script src="engine.js"></script>
-->

<script>
	
	
	
	// Additions
	
	let root_el = document.getElementById('extension-floorplanner-tool-root');
	let linElement = document.querySelector('#extension-floorplanner-lin');
	let layers_list_el = document.querySelector('#extension-floorplanner-layer_list');
	let myModal = document.querySelector('#extension-floorplanner-myModal');
	
	
	function getOffset(element)
	{
	    var bound = element.getBoundingClientRect();
	    var html = document.documentElement;

	    return {
	        top: bound.top + window.pageYOffset - html.clientTop,
	        left: bound.left + window.pageXOffset - html.clientLeft
	    };
	}
	
	
	
	
	//
	//   ENGINE
	//
	
	
	document.querySelector('#extension-floorplanner-lin').addEventListener("mouseup", _MOUSEUP);
	document.querySelector('#extension-floorplanner-lin').addEventListener("mousemove", throttle(function (event) { _MOUSEMOVE(event); }, 30));
	document.querySelector('#extension-floorplanner-lin').addEventListener("mousedown", _MOUSEDOWN, true);

	document.querySelector('#extension-floorplanner-lin').addEventListener("click", function (event) {
	  event.preventDefault();
	});
 

	document.querySelector('#extension-floorplanner-panel').addEventListener('mousemove', function (event) {
	  if ((mode == 'line_mode' || mode == 'partition_mode') && action == 1) {
	    action = 0;
	    if (typeof (binder) != 'undefined') {
		    //binder.remove();
	      //delete binder;
				bye_binder();
	    }
		// TODO: this check shouldn't be here
		if(document.querySelector('#extension-floorplanner-linetemp')){
		    document.querySelector('#extension-floorplanner-linetemp').remove();
		    document.querySelector('#extension-floorplanner-line_construc').remove();
		}
	    lengthTemp.remove();
	    //delete lengthTemp;
	  }
	});

	if(typeof window.floorplan_listeners_added == 'undefined'){
		console.log("floorplan: engine.js: adding resize listeners");
		window.floorplan_listeners_added = true;

		window.addEventListener('resize', function (event) {
			
		  var rect = linElement.getBoundingClientRect(); // get the bounding rectangle

		  console.log( rect.width );
		  console.log( rect.height);
		  
		  //const lin_offset = getOffset(document.querySelector('#extension-floorplanner-lin'));
		  //width_viewbox = linElement.getBBox().width; //document.querySelector('#extension-floorplanner-lin').offsetWidth;
		  //height_viewbox = linElement.getBBox().height; //document.querySelector('#extension-floorplanner-lin').offsetHeight;
		  width_viewbox = rect.width;
		  height_viewbox = rect.height;
		  console.error("!!! SETTING VIEWBOX 3: ", originX_viewbox, originY_viewbox, width_viewbox,height_viewbox);
		  console.error("window resized.  originX_viewbox,width_viewbox: ", originX_viewbox, width_viewbox, originY_viewbox, height_viewbox);
		  document.querySelector('#extension-floorplanner-lin').setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox)
		});

		// *****************************************************************************************************
		// ******************************        KEYPRESS on KEYBOARD          *********************************
		// *****************************************************************************************************
		document.addEventListener("keydown", (event) => {
		  if (mode != "text_mode") {
		    if (event.keyCode == '37') {
		      //LEFT
		      zoom_maker('zoomleft', 100, 30);
		    }
		    if (event.keyCode == '38') {
		      //UP
		      zoom_maker('zoomtop', 100, 30);
		    }
		    if (event.keyCode == '39') {
		      //RIGHT
		      zoom_maker('zoomright', 100, 30);
		    }
		    if (event.keyCode == '40') {
		      //DOWN
		      zoom_maker('zoombottom', 100, 30);
		    }
		    if (event.keyCode == '107') {
		      //+
		      zoom_maker('zoomin', 20, 50);
		    }
		    if (event.keyCode == '109') {
		      //-
		      zoom_maker('zoomout', 20, 50);
		    }
				
			  if (event.ctrlKey && event.key === 'z') {
					console.log("CTRL Z keyboard press detected");
			    floorplanner_undo();
			  }
				
				
		  }
		  // else {
		  //   if (action == 1) {
		  //     binder.textContent = binder.textContent + event.key;
		  //     console.log(field.value);
		  //   }
		  // }
		});
	}



	// *****************************************************************************************************
	// ******************************        MOUSE MOVE          *******************************************
	// *****************************************************************************************************

	function _MOUSEMOVE(event) {
	  event.preventDefault();
	  document.querySelector('.extension-floorplanner-sub').style.display='none';

		//console.log("ROOM: ", ROOM);
		if(typeof binder != 'undefined'){
			//console.log("-> mode, binder: ", mode, binder);
		}
		else{
			//console.log("-> mode (no binder): ", mode);
		}
		
		

	  //**************************************************************************
	  //********************   TEXT   MODE   *************************************
	  //**************************************************************************
	  if (mode == 'text_mode') {
			console.log("in text_mode. action: ", action);
	    snap = calcul_snap(event, grid_snap);
	    if (action == 0) cursor('text');
	    else {
	      cursor('none');
	    }
	  }

	  //**************************************************************************
	  //*******************   OBJECT   MODE   ************************************
	  //**************************************************************************
	  if (mode == 'object_mode') {
			console.log("---> in object mode");
	    snap = calcul_snap(event, grid_snap);
	    if (typeof (binder) != 'undefined' && typeof binder.family != 'undefined') {
	      if ((binder.family != 'stick' && binder.family != 'collision') || WALLS.length == 0) {
			    console.log("binder: ", binder);
	        binder.x = snap.x;
	        binder.y = snap.y;
	        binder.oldX = binder.x;
	        binder.oldY = binder.y;
	        binder.update();
	      }
	      if (binder.family == 'collision') {
	        var found = false;

	        if (floorplanEditor.rayCastingWalls({ x: binder.bbox.left, y: binder.bbox.top })) found = true;
	        if (!found && floorplanEditor.rayCastingWalls({ x: binder.bbox.left, y: binder.bbox.bottom })) found = true;
	        if (!found && floorplanEditor.rayCastingWalls({ x: binder.bbox.right, y: binder.bbox.top })) found = true;
	        if (!found && floorplanEditor.rayCastingWalls({ x: binder.bbox.right, y: binder.bbox.bottom })) found = true;

	        if (!found) {
	          binder.x = snap.x;
	          binder.y = snap.y;
	          binder.oldX = binder.x;
	          binder.oldY = binder.y;
	          binder.update();
	        }
	        else {
	          binder.x = binder.oldX;
	          binder.y = binder.oldY;
	          binder.update();
	        }
	      }
	      if (binder.family == 'stick') {
	        pos = floorplanEditor.stickOnWall(snap);
	        binder.oldX = pos.x;
	        binder.oldY = pos.y;
	        var angleWall = qSVG.angleDeg(pos.wall.start.x, pos.wall.start.y, pos.wall.end.x, pos.wall.end.y);
	        var v1 = qSVG.vectorXY({ x: pos.wall.start.x, y: pos.wall.start.y }, { x: pos.wall.end.x, y: pos.wall.end.y });
	        var v2 = qSVG.vectorXY({ x: pos.wall.end.x, y: pos.wall.end.y }, snap);
	        binder.x = pos.x - Math.sin(pos.wall.angle * (360 / 2 * Math.PI)) * binder.thick / 2;
	        binder.y = pos.y - Math.cos(pos.wall.angle * (360 / 2 * Math.PI)) * binder.thick / 2;
	        var newAngle = qSVG.vectorDeter(v1, v2);
	        if (Math.sign(newAngle) == 1) {
	          angleWall += 180;
	          binder.x = pos.x + Math.sin(pos.wall.angle * (360 / 2 * Math.PI)) * binder.thick / 2;
	          binder.y = pos.y + Math.cos(pos.wall.angle * (360 / 2 * Math.PI)) * binder.thick / 2;
	        }
	        binder.angle = angleWall;
	        binder.update();
	      }
	    }
	    else {
				if(document.querySelector('#extension-floorplanner-object_list')){
					document.querySelector('#extension-floorplanner-object_list').style.display='none';
				}
	      if (modeOption == 'simpleStair') binder = new floorplanEditor.obj2D("free", "stair", "simpleStair", snap, 0, 0, 0, "normal", 0, 15);
	      else {
	        var typeObj = modeOption;
	        binder = new floorplanEditor.obj2D("free", "energy", typeObj, snap, 0, 0, 0, "normal", 0);
	      }

	      //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
				
	    }
	  }

	  //**************************************************************************
	  //**************        DISTANCE MODE **************************************
	  //**************************************************************************
	  if (mode == 'distance_mode') {
	    snap = calcul_snap(event, grid_snap);
	    if (typeof (binder) == 'undefined') {
	      cross = qSVG.create("boxbind", "path", {
	        d: "M-3000,0 L3000,0 M0,-3000 L0,3000",
	        "stroke-width": 0.5,
	        "stroke-opacity": "0.8",
	        stroke: "#e2b653",
	        fill: "#e2b653"
	      });
	      binder = new floorplanEditor.obj2D("free", "measure", "", { x: 0, y: 0 }, 0, 0, 0, "normal", 0, "");
	      labelMeasure = qSVG.create("none", "text", {
	        x: 0,
	        y: - 10,
	        'font-size': '1.2em',
	        stroke: "#ffffff",
	        "stroke-width": "0.4px",
	        'font-family': 'roboto',
	        'text-anchor': 'middle',
	        fill: "#3672d9"
	      });
	      binder.graph.append(labelMeasure);
	      //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	    }
	    else {
	      x = snap.x;
	      y = snap.y;
	      cross.setAttribute(
	        "transform", "translate(" + (snap.x) + "," + (snap.y) + ")"
	      );
	      if (action == 1) {
	        var startText = qSVG.middle(pox, poy, x, y);
	        var angleText = qSVG.angle(pox, poy, x, y);
	        var valueText = qSVG.measure({
	          x: pox,
	          y: poy
	        }, {
	          x: x,
	          y: y
	        });
	        binder.size = valueText;
	        binder.x = startText.x;
	        binder.y = startText.y;
	        binder.angle = angleText.deg;
	        valueText = (valueText / meter).toFixed(2) + ' m';
	        //labelMeasure.context.textContent = valueText;
	        labelMeasure[0].textContent = valueText;

	        binder.update();
	      }
	    }
	  }

	  //**************************************************************************
	  //**************        ROOM MODE *****************************************
	  //**************************************************************************

	  if (mode == 'room_mode') {
		  console.log("in room_mode");
	    snap = calcul_snap(event, grid_snap);
	    var roomTarget;
	    if (roomTarget = floorplanEditor.rayCastingRoom(snap)) {
	      if (typeof (binder) != 'undefined') {
	        //binder.remove();
	        //delete binder;
					bye_binder();
	      }

	      var pathSurface = roomTarget.coords;
	      var pathCreate = "M" + pathSurface[0].x + "," + pathSurface[0].y;
	      for (var p = 1; p < pathSurface.length - 1; p++) {
	        pathCreate = pathCreate + " " + "L" + pathSurface[p].x + "," + pathSurface[p].y;
	      }
	      pathCreate = pathCreate + "Z";

	      if (roomTarget.inside.length > 0) {
	        for (var ins = 0; ins < roomTarget.inside.length; ins++) {
	          pathCreate = pathCreate + " M" + Rooms.polygons[roomTarget.inside[ins]].coords[Rooms.polygons[roomTarget.inside[ins]].coords.length - 1].x + "," + Rooms.polygons[roomTarget.inside[ins]].coords[Rooms.polygons[roomTarget.inside[ins]].coords.length - 1].y;
	          for (var free = Rooms.polygons[roomTarget.inside[ins]].coords.length - 2; free > -1; free--) {
	            pathCreate = pathCreate + " L" + Rooms.polygons[roomTarget.inside[ins]].coords[free].x + "," + Rooms.polygons[roomTarget.inside[ins]].coords[free].y;
	          }
	        }
	      }
		  console.warn("room_mode: SETTING BINDER AS SVG..");
	      binder = qSVG.create('boxbind', 'path', {
	        id: "extension-floorplanner-roomSelected",
	        d: pathCreate,
	        fill: '#c9c14c',
	        'fill-opacity': 0.5,
	        stroke: '#c9c14c',
	        'fill-rule': 'evenodd',
	        'stroke-width': 3
	      });
	      binder.type = 'room';
	      binder.area = roomTarget.area;
	      binder.id = ROOM.indexOf(roomTarget);
	    }
	    else {
	      if (typeof (binder) != 'undefined') {
	        //binder.remove();
	        //delete binder;
					bye_binder();
	      }
	    }
	  }

	  //**************************************************************************
	  //**************        DOOR/WINDOW MODE   *********************************
	  //**************************************************************************

	  if (mode == 'door_mode') {
		  //console.log("in door_mode");
	    snap = calcul_snap(event, grid_snap);
		  //console.log("--snap: ", snap)
	    if (wallSelect = floorplanEditor.nearWall(snap)) {
		  //console.log("-- got wall to snap to: ", wallSelect);
	      var wall = wallSelect.wall;
	      if (wall.type != 'separate') {
			  //console.log("-- wall type is not separate: ", wall.type);
	        if (typeof (binder) != 'undefined' && typeof binder.update != 'undefined') {
  			  //console.log("binder already existed: ", binder);
  	          var angleWall = qSVG.angleDeg(wall.start.x, wall.start.y, wall.end.x, wall.end.y);
  	          var v1 = qSVG.vectorXY({ x: wall.start.x, y: wall.start.y }, { x: wall.end.x, y: wall.end.y });
  	          var v2 = qSVG.vectorXY({ x: wall.end.x, y: wall.end.y }, snap);
  	          var newAngle = qSVG.vectorDeter(v1, v2);
  	          binder.angleSign = 0;
  	          if (Math.sign(newAngle) == 1) {
  	            binder.angleSign = 1;
  	            angleWall += 180;
  	          }

  	          var limits = limitObj(wall.equations.base, binder.size, wallSelect);
  	          if (qSVG.btwn(limits[0].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[0].y, wall.start.y, wall.end.y) && qSVG.btwn(limits[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[1].y, wall.start.y, wall.end.y)) {
  	            binder.x = wallSelect.x;
  	            binder.y = wallSelect.y;
  	            binder.angle = angleWall;
  	            binder.thick = wall.thick;
  	            binder.limit = limits;
  	            binder.update();
  	          }

  	          if ((wallSelect.x == wall.start.x && wallSelect.y == wall.start.y) || (wallSelect.x == wall.end.x && wallSelect.y == wall.end.y)) {
  	            if (qSVG.btwn(limits[0].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[0].y, wall.start.y, wall.end.y)) {
  	              binder.x = limits[0].x;
  	              binder.y = limits[0].y;
  	            }
  	            if (qSVG.btwn(limits[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[1].y, wall.start.y, wall.end.y)) {
  	              binder.x = limits[1].x;
  	              binder.y = limits[1].y;
  	            }
  	            binder.limit = limits;
  	            binder.angle = angleWall;
  	            binder.thick = wall.thick;
  	            binder.update();
  	          }
	        }
	        else {
  			  console.log("-- binder is undefined, making doorWindow object.  modeOption, wallSelect,wall.thick:", modeOption, wallSelect,wall.thick);
  	          // family, classe, type, pos, angle, angleSign, size, hinge, thick 
  	          binder = new floorplanEditor.obj2D("inWall", "doorWindow", modeOption, wallSelect, 0, 0, 60, "normal", wall.thick);
			  console.log("new door binder, should be obj2D: ", binder);
  	          var angleWall = qSVG.angleDeg(wall.start.x, wall.start.y, wall.end.x, wall.end.y);
			  console.log("angleWall: ", angleWall);
  	          var v1 = qSVG.vectorXY({ x: wall.start.x, y: wall.start.y }, { x: wall.end.x, y: wall.end.y });
  	          var v2 = qSVG.vectorXY({ x: wall.end.x, y: wall.end.y }, snap);
  	          var newAngle = qSVG.vectorDeter(v1, v2);
			  console.log("newAngle: ", newAngle);
  	          if (Math.sign(newAngle) == 1) {
  	            angleWall += 180;
  	            binder.angleSign = 1;
  	          }
  	          var startCoords = qSVG.middle(wall.start.x, wall.start.y, wall.end.x, wall.end.y);
			  console.log("startCoords: ", startCoords);
  	          binder.x = startCoords.x;
  	          binder.y = startCoords.y;
  	          binder.angle = angleWall;
  	          binder.update();
			  console.log("door mode: appending binder.graph: ", binder.graph);
  	          //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	        }
	      }
	    }
	    else {
	      if (typeof (binder) != 'undefined') {
			    console.log("cannot add door: no walls yet?");
	        //binder.graph.remove();
	        //delete binder;
					bye_binder();
	      }
	    }
	  } // END DOOR MODE

	  //**************************************************************************
	  //**************        NODE MODE *****************************************
	  //**************************************************************************

	  if (mode == 'node_mode') {
		  console.log("in node_mod. This creates circlebinder as binder if there isn't already a binder");
	    snap = calcul_snap(event, grid_snap);

	    if (typeof (binder) == 'undefined') {
	      if (addNode = floorplanEditor.nearWall(snap, 30)) {
	        var x2 = addNode.wall.end.x;
	        var y2 = addNode.wall.end.y;
	        var x1 = addNode.wall.start.x;
	        var y1 = addNode.wall.start.y;
	        angleWall = qSVG.angle(x1, y1, x2, y2);
					console.warn("node_mode: SETTING BINDER AS SVG..");
	        binder = qSVG.create('boxbind', 'path', {
	          id: "extension-floorplanner-circlebinder",
	          d: "M-20,-10 L-13,0 L-20,10 Z M-13,0 L13,0 M13,0 L20,-10 L20,10 Z",
	          stroke: "#5cba79",
	          fill: "#5cba79",
	          "stroke-width": "1.5px"
	        });
			
	        binder.setAttribute(
	          "transform", "translate(" + (addNode.x) + "," + (addNode.y) + ") rotate(" + (angleWall.deg + 90) + ",0,0)"
	        );
	        binder.data = addNode;
	        binder.x1 = x1;
	        binder.x2 = x2;
	        binder.y1 = y1;
	        binder.y2 = y2;
			console.log("node_mode: see? binder: ", binder);
	      }
	    } else {
				console.log("node_mode: a binder already existed: ", binder);
				console.log("node_mode: addNode: ", floorplanEditor.nearWall(snap, 30));
	      if (addNode = floorplanEditor.nearWall(snap, 30)) {
	        if (addNode) {
	          var x2 = addNode.wall.end.x;
	          var y2 = addNode.wall.end.y;
	          var x1 = addNode.wall.start.x;
	          var y1 = addNode.wall.start.y;
	          angleWall = qSVG.angle(x1, y1, x2, y2);
	          binder.setAttribute(
	            "transform", "translate(" + (addNode.x) + "," + (addNode.y) + ") rotate(" + (angleWall.deg + 90) + ",0,0)"
	          );
	          binder.data = addNode;
	        }
	        else {
				console.log("node_mode: removing binder 2");
	          //binder.remove();
	          //delete binder;
						bye_binder();
	        }
	      } else {
			  console.log("node_mode: removing binder");
	        //binder.remove();
	        //delete binder;
					bye_binder();
	      }
	    }
	  } // END NODE MODE

	  //**********************************  SELECT MODE ***************************************************************
	  if (mode == 'select_mode' && drag == 'off') { // FIRST TEST ON SELECT MODE (and drag OFF) to detect MOUSEOVER DOOR
		  //console.log("in select_mode.  drag,OBJDATA: ", drag, OBJDATA);
	    snap = calcul_snap(event, 'off');
			//console.log("select mode: snap: ", snap);
	    var objTarget = false;
			//console.log("select_mode: OBJDATA: ", OBJDATA);
	    for (var i = 0; i < OBJDATA.length; i++) {
	      var objX1 = OBJDATA[i].bbox.left;
	      var objX2 = OBJDATA[i].bbox.right;
	      var objY1 = OBJDATA[i].bbox.top;
	      var objY2 = OBJDATA[i].bbox.bottom;
	      var realBboxCoords = OBJDATA[i].realBbox;
				//console.log("realBboxCoords: ", realBboxCoords);
	      if (qSVG.rayCasting(snap, realBboxCoords)) {
					//console.warn("FOUND NEARBY OBJECT");
	        objTarget = OBJDATA[i];
					//binder = OBJDATA[i];
	      }
	    }
			//console.log("select_mode: objTarget:", objTarget);
			if (typeof (binder) != 'undefined'){
				//console.log("select_mode: binder:", binder);
			}
			
			
	    if (objTarget !== false) {
	      if (typeof (binder) != 'undefined' && (binder.type == 'segment')) {
					//console.log("removing binder that is segment type");
	        //binder.graph.remove();
	        //delete binder;
					bye_binder();
	        cursor('default');
	      }
	      if (objTarget.params.bindBox) { // OBJ -> BOUNDINGBOX TOOL
					console.log("OBJ -> BOUNDINGBOX TOOL");
	        //if (typeof (binder) == 'undefined') {
	          binder = new floorplanEditor.obj2D("free", "boundingBox", "", objTarget.bbox.origin, objTarget.angle, 0, objTarget.size, "normal", objTarget.thick, objTarget.realBbox);
	          binder.update();
	          binder.obj = objTarget;
	          binder.type = 'boundingBox';
	          binder.oldX = binder.x;
	          binder.oldY = binder.y;
	          //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	          if (!objTarget.params.move) cursor('trash'); // LIKE MEASURE ON PLAN
	          if (objTarget.params.move) cursor('move');
					//}
	      }
	      else {  // DOOR, WINDOW, APERTURE.. -- OBJ WITHOUT BINDBOX (params.bindBox = False) -- !!!!
			    console.log("select_mode: DOOR, WINDOW, APERTURE.. -- OBJ WITHOUT BINDBOX");
	        
					if(typeof (binder) != 'undefined'){
						console.log("select_mode: binder already existed: ", binder);
						//console.log("event.target =?= binder.graph.firstChild: ", event.target, binder.graph.firstChild)
	          if (typeof binder.graph != 'undefined' && event.target == binder.graph.firstChild) {
	            cursor('move');
	            binder.graph.firstChild.setAttribute("class", "extension-floorplanner-circle_css_2");
	            binder.type = "obj";
	            binder.obj = objTarget;
	          }
	          else if(typeof binder.graph != 'undefined'){
	            cursor('default');
	            binder.graph.firstChild.setAttribute("class", "extension-floorplanner-circle_css_1");
	            binder.type = false;
	          }
						else{
							console.error("eh? binder but no graph, unexpectely");
							bye_binder();
						}
					}
					else {
	          var wallList = floorplanEditor.rayCastingWall(objTarget);
	          if (wallList.length > 1) wallList = wallList[0];
	          inWallRib(wallList);
	          var thickObj = wallList.thick;
	          var sizeObj = objTarget.size;

	          binder = new floorplanEditor.obj2D("inWall", "socle", "", objTarget, objTarget.angle, 0, sizeObj, "normal", thickObj);
			  		console.log("select_mode: binder or inWall type: ", binder);
	          binder.update();

	          binder.oldXY = { x: objTarget.x, y: objTarget.y }; // FOR OBJECT MENU
	          //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	        }
	      }
	    }
	    

	    // BIND CIRCLE IF nearNode and GROUP ALL SAME XY SEG POINTS
	    else if (wallNode = floorplanEditor.nearWallNode(snap, 20)) {
				console.log("POINTER IS NEAR WALL NODE");
				if(typeof binder != 'undefined'){
					console.log("--binder already exists: ", binder);
				}
        binder = qSVG.create('boxbind', 'circle', {
          id: "extension-floorplanner-circlebinder",
          class: "extension-floorplanner-circle_css_2",
          cx: wallNode.x,
          cy: wallNode.y,
          r: Rcirclebinder
        });
        binder.data = wallNode;
        binder.type = "node";
				if (document.querySelectorAll('#extension-floorplanner-linebinder').length) document.querySelector('#extension-floorplanner-linebinder').remove();
				
				/*
	      if (typeof binder == 'undefined' || (typeof binder != 'undefined' && typeof binder.type != 'undefined ' && binder.type == 'segment')) {
	        binder = qSVG.create('boxbind', 'circle', {
	          id: "extension-floorplanner-circlebinder",
	          class: "extension-floorplanner-circle_css_2",
	          cx: wallNode.x,
	          cy: wallNode.y,
	          r: Rcirclebinder
	        });
	        binder.data = wallNode;
	        binder.type = "node";
					if (document.querySelectorAll('#extension-floorplanner-linebinder').length) document.querySelector('#extension-floorplanner-linebinder').remove();
	        
	      } else {
					console.log("...nothing here")
	        // REMAKE CIRCLE_CSS ON BINDER AND TAKE DATA SEG GROUP
	        // if (typeof(binder) != 'undefined') {
	        //     binder.attr({
	        //         class: "circle_css_2"
	        //     });
	        // }
	      }
				*/
	      cursor('move');
	    }
			else if (typeof (binder) != "undefined" && binder.type == 'node') {
				console.log("select_mode: not near wall node, but binder type is node, so calling bye_binder");
				bye_binder();
        //binder.remove();
        //delete binder;
        hideAllSize();
        cursor('default');
        rib();
	      
	    }
	    else if (typeof binder != 'undefined') {
				console.log("select_mode, but nothing near the mouse pointer?");
	      
				//console.log("clearing binder")
        //if (typeof (binder.graph) != 'undefined') binder.graph.remove();
        bye_binder();
				//if (binder.type == 'node') binder.remove();
        //delete binder;
        cursor('default');
        rib();

	    }

	    // BIND WALL WITH NEARPOINT function ---> WALL BINDER CREATION
	    if (wallBind = floorplanEditor.rayCastingWalls(snap, WALLS)) {
	      if (wallBind.length > 1) wallBind = wallBind[wallBind.length - 1];
	      if (wallBind && typeof (binder) == 'undefined') {
	        var objWall = floorplanEditor.objFromWall(wallBind);
	        if (objWall.length > 0) floorplanEditor.inWallRib2(wallBind);
	        binder = {};
	        binder.wall = wallBind;
	        inWallRib(binder.wall);
	        var line = qSVG.create('none', 'line', {
	          x1: binder.wall.start.x, y1: binder.wall.start.y, x2: binder.wall.end.x, y2: binder.wall.end.y,
	          "stroke-width": 5,
	          stroke: "#5cba79"
	        });
	        var ball1 = qSVG.create('none', 'circle', {
	          class: "extension-floorplanner-circle_css",
	          cx: binder.wall.start.x, cy: binder.wall.start.y,
	          r: Rcirclebinder / 1.8
	        });
	        var ball2 = qSVG.create('none', 'circle', {
	          class: "extension-floorplanner-circle_css",
	          cx: binder.wall.end.x, cy: binder.wall.end.y,
	          r: Rcirclebinder / 1.8
	        });
	        binder.graph = qSVG.create('none', 'g');
	        binder.graph.append(line);
	        binder.graph.append(ball1);
	        binder.graph.append(ball2);
	        //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	        binder.type = "segment";
	        cursor('pointer');
	      }
	    } else {
	      if (wallBind = floorplanEditor.nearWall(snap, 6)) {
	        if (wallBind && typeof (binder) == 'undefined') {
	          wallBind = wallBind.wall;
	          var objWall = floorplanEditor.objFromWall(wallBind);
	          if (objWall.length > 0) floorplanEditor.inWallRib2(wallBind);
	          binder = {};
	          binder.wall = wallBind;
	          inWallRib(binder.wall);
	          var line = qSVG.create('none', 'line', {
	            x1: binder.wall.start.x, y1: binder.wall.start.y, x2: binder.wall.end.x, y2: binder.wall.end.y,
	            "stroke-width": 5,
	            stroke: "#5cba79"
	          });
	          var ball1 = qSVG.create('none', 'circle', {
	            class: "extension-floorplanner-circle_css",
	            cx: binder.wall.start.x, cy: binder.wall.start.y,
	            r: Rcirclebinder / 1.8
	          });
	          var ball2 = qSVG.create('none', 'circle', {
	            class: "extension-floorplanner-circle_css",
	            cx: binder.wall.end.x, cy: binder.wall.end.y,
	            r: Rcirclebinder / 1.8
	          });
	          binder.graph = qSVG.create('none', 'g');
	          binder.graph.append(line);
	          binder.graph.append(ball1);
	          binder.graph.append(ball2);
	          //document.querySelector('#extension-floorplanner-boxbind').append(binder.graph);
	          binder.type = "segment";
	          cursor('pointer');
	        }
	      }
	      else {
	        if (typeof (binder) != "undefined" && binder.type == 'segment') {
	          //binder.graph.remove();
	          //delete binder;
						bye_binder();
	          hideAllSize();
	          cursor('default');
	          rib();
	        }
	      }
	    }
	  } // END mode == 'select_mode' && drag == 'off'

	  // ------------------------------  LINE MODE ------------------------------------------------------

	  if ((mode == 'line_mode' || mode == 'partition_mode') && action == 0) {
	    snap = calcul_snap(event, 'off');
	    cursor('grab');
	    pox = snap.x;
	    poy = snap.y;
	    if (helpConstruc = intersection(snap, 25)) {
	      if (helpConstruc.distance < 10) {
	        pox = helpConstruc.x;
	        poy = helpConstruc.y;
	        cursor('grab');
	      } else {
	        cursor('crosshair');
	      }
	    }
	    if (wallNode = floorplanEditor.nearWallNode(snap, 20)) {
	      pox = wallNode.x;
	      poy = wallNode.y;
	      cursor('grab');
	      if (typeof (binder) == 'undefined') {
	        binder = qSVG.create('boxbind', 'circle', {
	          id: "extension-floorplanner-circlebinder",
	          class: "extension-floorplanner-circle_css_2",
	          cx: wallNode.x,
	          cy: wallNode.y,
	          r: Rcirclebinder / 1.5
	        });
	      }
	      intersectionOff();
	    } else {
	      if (!helpConstruc) cursor('crosshair');
	      if (typeof (binder) != "undefined") {
	        if (binder.graph) binder.graph.remove();
	        else bye_binder();//binder.remove();
	        //delete binder;
	      }
	    }
	  }

	  // ******************************************************************************************************
	  // ************************** ACTION = 1   LINE MODE => WALL CREATE                 *********************
	  // ******************************************************************************************************

	  if (action == 1 && (mode == 'line_mode' || mode == 'partition_mode')) {
	    snap = calcul_snap(event, grid_snap);
	    x = snap.x;
	    y = snap.y;
	    starter = minMoveGrid(snap);

	    if (!document.querySelectorAll('#extension-floorplanner-line_construc').length) {
	      if (wallNode = floorplanEditor.nearWallNode(snap, 20)) {
	        pox = wallNode.x;
	        poy = wallNode.y;

	        wallStartConstruc = false;
	        if (wallNode.bestWall == WALLS.length - 1) {
	          cursor('validation');
	        }
	        else {
	          cursor('grab');
	        }
	      } else {
	        cursor('crosshair');
	      }
	    }


	    if (starter > grid) {
		      if (!document.querySelectorAll('#extension-floorplanner-line_construc').length) {
	        var ws = 20;
	        if (mode == 'partition_mode') ws = 10;
	        lineconstruc = qSVG.create("boxbind", "line", {
	          id: "extension-floorplanner-line_construc",
	          x1: pox,
	          y1: poy,
	          x2: x,
	          y2: y,
	          "stroke-width": ws,
	          "stroke-linecap": "butt",
	          "stroke-opacity": 0.7,
	          stroke: "#9fb2e2"
	        });

	        svgadd = qSVG.create("boxbind", "line", { // ORANGE TEMP LINE FOR ANGLE 0 90 45 -+
	          id: "extension-floorplanner-linetemp",
	          x1: pox,
	          y1: poy,
	          x2: x,
	          y2: y,
	          "stroke": "transparent",
	          "stroke-width": 0.5,
	          "stroke-opacity": "0.9"
	        });
	      } else { // THE LINES AND BINDER ARE CREATED

			  // TODO: this check shouldn't exist.. maybe?
			  if(document.querySelector('#extension-floorplanner-linetemp')){
				  document.querySelector('#extension-floorplanner-linetemp').setAttribute('x2',x);
				  document.querySelector('#extension-floorplanner-linetemp').setAttribute('y2',y);
			  }
			  

	        if (helpConstrucEnd = intersection(snap, 10)) {
	          x = helpConstrucEnd.x;
	          y = helpConstrucEnd.y;
	        }
	        if (wallEndConstruc = floorplanEditor.nearWall(snap, 12)) { // TO SNAP SEGMENT TO FINALIZE X2Y2
	          x = wallEndConstruc.x;
	          y = wallEndConstruc.y;
	          cursor('grab');
	        } else {
	          cursor('crosshair');
	        }

	        // nearNode helped to attach the end of the construc line
	        if (wallNode = floorplanEditor.nearWallNode(snap, 20)) {
	          if (typeof (binder) == 'undefined') {
	            binder = qSVG.create('boxbind', 'circle', {
	              id: "extension-floorplanner-circlebinder",
	              class: "extension-floorplanner-circle_css_2",
	              cx: wallNode.x,
	              cy: wallNode.y,
	              r: Rcirclebinder / 1.5
	            });
	          }
						
			  document.querySelector('#extension-floorplanner-line_construc').setAttribute('x2',wallNode.x);
			  document.querySelector('#extension-floorplanner-line_construc').setAttribute('y2',wallNode.y);
  
	          x = wallNode.x;
	          y = wallNode.y;
	          wallEndConstruc = true;
	          intersectionOff();
	          if (wallNode.bestWall == WALLS.length - 1 && document.getElementById("extension-floorplanner-multi").checked) {
	            cursor('validation');
	          }
	          else {
	            cursor('grab');
	          }
	        } else {
	          if (typeof (binder) != "undefined") {
	            //binder.remove();
	            //delete binder;
							bye_binder();
	          }
	          if (wallEndConstruc === false) cursor('crosshair');
	        }
	        // LINETEMP AND LITLLE SNAPPING FOR HELP TO CONSTRUC ANGLE 0 90 45 *****************************************
	        var fltt = qSVG.angle(pox, poy, x, y);
	        var flt = Math.abs(fltt.deg);
	        var coeff = fltt.deg / flt; // -45 -> -1     45 -> 1
	        var phi = poy - (coeff * pox);
	        var Xdiag = (y - phi) / coeff;
	        if (typeof (binder) == 'undefined') {
	          // HELP FOR H LINE
	          var found = false;
	          if (flt < 15 && Math.abs(poy - y) < 25) {
	            y = poy;
	            found = true;
	          } // HELP FOR V LINE
	          if (flt > 75 && Math.abs(pox - x) < 25) {
	            x = pox;
	            found = true;
	          } // HELP FOR DIAG LINE
	          if (flt < 55 && flt > 35 && Math.abs(Xdiag - x) < 20) {
	            x = Xdiag;
	            found = true;
	          }
	          if (found) document.querySelector('#extension-floorplanner-line_construc').setAttribute( "stroke-opacity",1);
	          else document.querySelector('#extension-floorplanner-line_construc').setAttribute( "stroke-opacity",0.7);
	        }
	        document.querySelector('#extension-floorplanner-line_construc').setAttribute( "x2",x);
			document.querySelector('#extension-floorplanner-line_construc').setAttribute( "y2",y);

	        // SHOW WALL SIZE -------------------------------------------------------------------------
	        var startText = qSVG.middle(pox, poy, x, y);
	        var angleText = qSVG.angle(pox, poy, x, y);
	        var valueText = ((qSVG.measure({
	          x: pox,
	          y: poy
	        }, {
	          x: x,
	          y: y
	        })) / 60).toFixed(2);
	        if (typeof (lengthTemp) == 'undefined') {
	          lengthTemp = document.createElementNS('http://www.w3.org/2000/svg', 'text');
	          lengthTemp.setAttributeNS(null, 'x', startText.x);
	          lengthTemp.setAttributeNS(null, 'y', (startText.y) - 15);
	          lengthTemp.setAttributeNS(null, 'text-anchor', 'middle');
	          lengthTemp.setAttributeNS(null, 'stroke', 'none');
	          lengthTemp.setAttributeNS(null, 'stroke-width', '0.6px');
	          lengthTemp.setAttributeNS(null, 'fill', '#777777');
	          lengthTemp.textContent = valueText + 'm';
	          document.querySelector('#extension-floorplanner-boxbind').append(lengthTemp);
	        }
	        if (typeof (lengthTemp) != 'undefined' && valueText > 0.1) {
	          lengthTemp.setAttributeNS(null, 'x', startText.x);
	          lengthTemp.setAttributeNS(null, 'y', (startText.y) - 15);
	          lengthTemp.setAttribute("transform", "rotate(" + angleText.deg + " " + startText.x + "," + startText.y + ")");
	          lengthTemp.textContent = valueText + ' m';
	        }
	        if (typeof (lengthTemp) != 'undefined' && valueText < 0.1) {
	          lengthTemp.textContent = "";
	        }
	      }
	    }
	  } // END LINE MODE DETECT && ACTION = 1

	  //ONMOVE
	  // **************************************************************************************************
	  //        ____ ___ _   _ ____  _____ ____
	  //        | __ )_ _| \ | |  _ \| ____|  _ \
	  //        |  _ \| ||  \| | | | |  _| | |_) |
	  //        | |_) | || |\  | |_| | |___|  _ <
	  //        |____/___|_| \_|____/|_____|_| \_\
	  //
	  // **************************************************************************************************

	  if (mode == 'bind_mode') {
		  console.log("in bind_mode. binder: ", binder);
		  console.log("--binder.type: ", binder.type);
	    snap = calcul_snap(event, grid_snap);
		  console.log("snap: ", snap);
		
	    if (binder.type == 'node') {
				console.log("binder type is node");
	      var coords = snap;
	      var magnetic = false;
	      for (var k in wallListRun) {
	        if (isObjectsEquals(wallListRun[k].end, binder.data)) {
	          if (Math.abs(wallListRun[k].start.x - snap.x) < 20) { coords.x = wallListRun[k].start.x; magnetic = "H"; }
	          if (Math.abs(wallListRun[k].start.y - snap.y) < 20) { coords.y = wallListRun[k].start.y; magnetic = "V"; }
	        }
	        if (isObjectsEquals(wallListRun[k].start, binder.data)) {
	          if (Math.abs(wallListRun[k].end.x - snap.x) < 20) { coords.x = wallListRun[k].end.x; magnetic = "H"; }
	          if (Math.abs(wallListRun[k].end.y - snap.y) < 20) { coords.y = wallListRun[k].end.y; magnetic = "V"; }
	        }
	      }

				console.log("near wall? ", floorplanEditor.nearWallNode(snap, 15, wallListRun));
	      if (nodeMove = floorplanEditor.nearWallNode(snap, 15, wallListRun)) { // sic: single =
	        coords.x = nodeMove.x;
	        coords.y = nodeMove.y;
					
					console.log("WRONG BINDER?! ", binder);
					
					if(document.querySelector('#extension-floorplanner-circlebinder')){
						console.log("circlebinder el existed: ", document.querySelector('#extension-floorplanner-circlebinder'));
						document.querySelector('#extension-floorplanner-circlebinder').setAttribute( "class","extension-floorplanner-circleGum");
						document.querySelector('#extension-floorplanner-circlebinder').setAttribute( "cx",coords.x);
						document.querySelector('#extension-floorplanner-circlebinder').setAttribute( "cy",coords.y);
					}
					else{
						console.log("circlebinder el did not exist");
						bye_binder();
		        binder = qSVG.create('boxbind', 'circle', {
		          id: "extension-floorplanner-circlebinder",
		          class: "extension-floorplanner-circleGum",
		          cx: coords.x,
		          cy: coords.y,
		          r: Rcirclebinder
		        });
		        //binder.data = wallNode;
		        //binder.type = "node";
					}
					
	        cursor('grab');
	      } else {
					console.log("RIGHT BINDER?!", binder);
	        if (magnetic != false) {
	          if (magnetic == "H") snap.x = coords.x;
	          else snap.y = coords.y;
	        }
	        if (helpConstruc = intersection(snap, 10, wallListRun)) {
	          coords.x = helpConstruc.x;
	          coords.y = helpConstruc.y;
	          snap.x = helpConstruc.x;
	          snap.y = helpConstruc.y;
	          if (magnetic != false) {
	            if (magnetic == "H") snap.x = coords.x;
	            else snap.y = coords.y;
	          }
	          cursor('grab');
	        } else {
	          cursor('move');
	        }
	        binder.remove()
	        //document.querySelector('#extension-floorplanner-circlebinder').attr({"class": "circle_css", cx: coords.x, cy: coords.y});
	      }
	      for (var k in wallListRun) {
	        if (isObjectsEquals(wallListRun[k].start, binder.data)) {
	          wallListRun[k].start.x = coords.x;
	          wallListRun[k].start.y = coords.y;
	        }
	        if (isObjectsEquals(wallListRun[k].end, binder.data)) {
	          wallListRun[k].end.x = coords.x;
	          wallListRun[k].end.y = coords.y;
	        }
	      }
	      binder.data = coords;
	      floorplanEditor.wallsComputing(WALLS, false); // UPDATE FALSE

	      for (var k in wallListObj) {
	        var wall = wallListObj[k].wall;
	        var objTarget = wallListObj[k].obj;
	        var angleWall = qSVG.angleDeg(wall.start.x, wall.start.y, wall.end.x, wall.end.y);
	        var limits = limitObj(wall.equations.base, 2 * wallListObj[k].distance, wallListObj[k].from); // COORDS OBJ AFTER ROTATION
	        var indexLimits = 0;
	        if (qSVG.btwn(limits[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[1].y, wall.start.y, wall.end.y)) indexLimits = 1;
	        // NEW COORDS OBJDATA[obj]
	        objTarget.x = limits[indexLimits].x;
	        objTarget.y = limits[indexLimits].y;
	        objTarget.angle = angleWall;
	        if (objTarget.angleSign == 1) objTarget.angle = angleWall + 180;

	        var limitBtwn = limitObj(wall.equations.base, objTarget.size, objTarget); // OBJ SIZE OK BTWN xy1/xy2

	        if (qSVG.btwn(limitBtwn[0].x, wall.start.x, wall.end.x) && qSVG.btwn(limitBtwn[0].y, wall.start.y, wall.end.y) && qSVG.btwn(limitBtwn[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limitBtwn[1].y, wall.start.y, wall.end.y)) {
	          objTarget.limit = limitBtwn;
	          objTarget.update();
	        }
	        else {
	          objTarget.graph.remove();
	          //delete objTarget;
	          OBJDATA.splice(wall.indexObj, 1);
	          wallListObj.splice(k, 1);
	        }
	      }
	      // for (k in toClean)
	      document.querySelector('#extension-floorplanner-boxRoom').replaceChildren();
	      document.querySelector('#extension-floorplanner-boxSurface').replaceChildren();
	      Rooms = qSVG.polygonize(WALLS);
	      floorplanEditor.roomMaker(Rooms);
	    }

	    // WALL MOVING ----BINDER TYPE SEGMENT-------- FUNCTION FOR H,V and Calculate Vectorial Translation

	    if (binder.type == 'segment' && action == 1) {
	      rib();

	      if (equation2.A == 'v') { equation2.B = snap.x; }
	      else if (equation2.A == 'h') { equation2.B = snap.y; }
	      else { equation2.B = snap.y - (snap.x * equation2.A); }

	      var intersection1 = qSVG.intersectionOfEquations(equation1, equation2, "obj");
	      var intersection2 = qSVG.intersectionOfEquations(equation2, equation3, "obj");
	      var intersection3 = qSVG.intersectionOfEquations(equation1, equation3, "obj");

	      if (binder.wall.parent != null) {
	        if (isObjectsEquals(binder.wall.parent.end, binder.wall.start)) binder.wall.parent.end = intersection1;
	        else if (isObjectsEquals(binder.wall.parent.start, binder.wall.start)) binder.wall.parent.start = intersection1;
	        else binder.wall.parent.end = intersection1;
	      }

	      if (binder.wall.child != null) {
	        if (isObjectsEquals(binder.wall.child.start, binder.wall.end)) binder.wall.child.start = intersection2;
	        else if (isObjectsEquals(binder.wall.child.end, binder.wall.end)) binder.wall.child.end = intersection2;
	        else binder.wall.child.start = intersection2;
	      }

	      binder.wall.start = intersection1;
	      binder.wall.end = intersection2;
	      binder.graph.remove()
	      // binder.graph[0].children[0].setAttribute("x1",intersection1.x);
	      // binder.graph[0].children[0].setAttribute("x2",intersection2.x);
	      // binder.graph[0].children[0].setAttribute("y1",intersection1.y);
	      // binder.graph[0].children[0].setAttribute("y2",intersection2.y);
	      // binder.graph[0].children[1].setAttribute("cx",intersection1.x);
	      // binder.graph[0].children[1].setAttribute("cy",intersection1.y);
	      // binder.graph[0].children[2].setAttribute("cx",intersection2.x);
	      // binder.graph[0].children[2].setAttribute("cy",intersection2.y);

	      // THE EQ FOLLOWED BY eq (PARENT EQ1 --- CHILD EQ3)
	      if (equation1.follow != undefined) {
	        if (!qSVG.rayCasting(intersection1, equation1.backUp.coords)) { // IF OUT OF WALL FOLLOWED
	          var distanceFromStart = qSVG.gap(equation1.backUp.start, intersection1);
	          var distanceFromEnd = qSVG.gap(equation1.backUp.end, intersection1);
	          if (distanceFromStart > distanceFromEnd) { // NEAR FROM End
	            equation1.follow.end = intersection1;
	          }
	          else {
	            equation1.follow.start = intersection1;
	          }
	        }
	        else {
	          equation1.follow.end = equation1.backUp.end;
	          equation1.follow.start = equation1.backUp.start;
	        }
	      }
	      if (equation3.follow != undefined) {
	        if (!qSVG.rayCasting(intersection2, equation3.backUp.coords)) { // IF OUT OF WALL FOLLOWED
	          var distanceFromStart = qSVG.gap(equation3.backUp.start, intersection2);
	          var distanceFromEnd = qSVG.gap(equation3.backUp.end, intersection2);
	          if (distanceFromStart > distanceFromEnd) { // NEAR FROM End
	            equation3.follow.end = intersection2;
	          }
	          else {
	            equation3.follow.start = intersection2;
	          }
	        }
	        else {
	          equation3.follow.end = equation3.backUp.end;
	          equation3.follow.start = equation3.backUp.start;
	        }
	      }

	      // EQ FOLLOWERS WALL MOVING
	      for (var i = 0; i < equationFollowers.length; i++) {
	        var intersectionFollowers = qSVG.intersectionOfEquations(equationFollowers[i].eq, equation2, "obj");
	        if (qSVG.btwn(intersectionFollowers.x, binder.wall.start.x, binder.wall.end.x, 'round') && qSVG.btwn(intersectionFollowers.y, binder.wall.start.y, binder.wall.end.y, 'round')) {
	          var size = qSVG.measure(equationFollowers[i].wall.start, equationFollowers[i].wall.end);
	          if (equationFollowers[i].type == "start") {
	            equationFollowers[i].wall.start = intersectionFollowers;
	            if (size < 5) {
	              if (equationFollowers[i].wall.child == null) {
	                WALLS.splice(WALLS.indexOf(equationFollowers[i].wall), 1);
	                equationFollowers.splice(i, 1);
	              }
	            }
	          }
	          if (equationFollowers[i].type == "end") {
	            equationFollowers[i].wall.end = intersectionFollowers;
	            if (size < 5) {
	              if (equationFollowers[i].wall.parent == null) {
	                WALLS.splice(WALLS.indexOf(equationFollowers[i].wall), 1);
	                equationFollowers.splice(i, 1);
	              }
	            }
	          }
	        }
	      }
	      // WALL COMPUTING, BLOCK FAMILY OF BINDERWALL IF NULL (START OR END) !!!!!
	      floorplanEditor.wallsComputing(WALLS, "move");
	      Rooms = qSVG.polygonize(WALLS);

	      // OBJDATA(s) FOLLOW 90° EDGE SELECTED
	      for (var rp = 0; rp < equationsObj.length; rp++) {
	        var objTarget = equationsObj[rp].obj;
	        var intersectionObj = qSVG.intersectionOfEquations(equationsObj[rp].eq, equation2);
	        // NEW COORDS OBJDATA[o]
	        objTarget.x = intersectionObj[0];
	        objTarget.y = intersectionObj[1];
	        var limits = limitObj(equation2, objTarget.size, objTarget);
	        if (qSVG.btwn(limits[0].x, binder.wall.start.x, binder.wall.end.x) && qSVG.btwn(limits[0].y, binder.wall.start.y, binder.wall.end.y) && qSVG.btwn(limits[1].x, binder.wall.start.x, binder.wall.end.x) && qSVG.btwn(limits[1].y, binder.wall.start.y, binder.wall.end.y)) {
	          objTarget.limit = limits;
	          objTarget.update();
	        }
	      }
	      // DELETING ALL OBJECT "INWALL" OVERSIZED INTO ITS EDGE (EDGE BY EDGE CONTROL)
	      for (var k in WALLS) {
	        var objWall = floorplanEditor.objFromWall(WALLS[k]); // LIST OBJ ON EDGE
	        for (var ob in objWall) {
	          var objTarget = objWall[ob];
	          var eq = floorplanEditor.createEquationFromWall(WALLS[k]);
	          var limits = limitObj(eq, objTarget.size, objTarget);
	          if (!qSVG.btwn(limits[0].x, WALLS[k].start.x, WALLS[k].end.x) || !qSVG.btwn(limits[0].y, WALLS[k].start.y, WALLS[k].end.y) || !qSVG.btwn(limits[1].x, WALLS[k].start.x, WALLS[k].end.x) || !qSVG.btwn(limits[1].y, WALLS[k].start.y, WALLS[k].end.y)) {
	            objTarget.graph.remove();
	            //delete objTarget;
	            var indexObj = OBJDATA.indexOf(objTarget);
	            OBJDATA.splice(indexObj, 1);
	          }
	        }
	      }

	      equationsObj = []; // REINIT eqObj -> MAYBE ONE OR PLUS OF OBJDATA REMOVED !!!!
	      var objWall = floorplanEditor.objFromWall(binder.wall); // LIST OBJ ON EDGE
	      for (var ob = 0; ob < objWall.length; ob++) {
	        var objTarget = objWall[ob];
	        equationsObj.push({ obj: objTarget, wall: binder.wall, eq: qSVG.perpendicularEquation(equation2, objTarget.x, objTarget.y) });
	      }

	      document.querySelector('#extension-floorplanner-boxRoom').replaceChildren();
	      document.querySelector('#extension-floorplanner-boxSurface').replaceChildren();
	      floorplanEditor.roomMaker(Rooms);
	      document.querySelector('#extension-floorplanner-lin').style.cursor = 'pointer';
	    }

	    // **********************************************************************
	    // ----------------------  BOUNDING BOX ------------------------------
	    // **********************************************************************
	    // binder.obj.params.move ---> FOR MEASURE DONT MOVE
	    if (binder.type == 'boundingBox' && action == 1 && binder.obj.params.move) {
	      binder.x = snap.x;
	      binder.y = snap.y;
	      binder.obj.x = snap.x;
	      binder.obj.y = snap.y;
	      binder.obj.update();
	      binder.update();
	    }

	    // **********************************************************************
	    // OBJ MOVING
	    // **********************************************************************
	    if (binder.type == 'obj' && action == 1) {
	      if (wallSelect = floorplanEditor.nearWall(snap)) {
	        if (wallSelect.wall.type != 'separate') {
	          inWallRib(wallSelect.wall);

	          var objTarget = binder.obj;
	          var wall = wallSelect.wall;
	          var angleWall = qSVG.angleDeg(wall.start.x, wall.start.y, wall.end.x, wall.end.y);
	          var v1 = qSVG.vectorXY({ x: wall.start.x, y: wall.start.y }, { x: wall.end.x, y: wall.end.y });
	          var v2 = qSVG.vectorXY({ x: wall.end.x, y: wall.end.y }, snap);
	          var newAngle = qSVG.vectorDeter(v1, v2);
	          binder.angleSign = 0;
	          objTarget.angleSign = 0;
	          if (Math.sign(newAngle) == 1) {
	            angleWall += 180;
	            binder.angleSign = 1;
	            objTarget.angleSign = 1;
	          }
	          var limits = limitObj(wall.equations.base, binder.size, wallSelect);
	          if (qSVG.btwn(limits[0].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[0].y, wall.start.y, wall.end.y) && qSVG.btwn(limits[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[1].y, wall.start.y, wall.end.y)) {
	            binder.x = wallSelect.x;
	            binder.y = wallSelect.y;
	            binder.angle = angleWall;
	            binder.thick = wall.thick;
	            objTarget.x = wallSelect.x;
	            objTarget.y = wallSelect.y;
	            objTarget.angle = angleWall;
	            objTarget.thick = wall.thick;
	            objTarget.limit = limits;
	            binder.update();
	            objTarget.update();
	          }

	          if ((wallSelect.x == wall.start.x && wallSelect.y == wall.start.y) || (wallSelect.x == wall.end.x && wallSelect.y == wall.end.y)) {
	            if (qSVG.btwn(limits[0].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[0].y, wall.start.y, wall.end.y)) {
	              binder.x = limits[0].x;
	              binder.y = limits[0].y;
	              objTarget.x = limits[0].x;
	              objTarget.y = limits[0].y;
	              objTarget.limit = limits;
	            }
	            if (qSVG.btwn(limits[1].x, wall.start.x, wall.end.x) && qSVG.btwn(limits[1].y, wall.start.y, wall.end.y)) {
	              binder.x = limits[1].x;
	              binder.y = limits[1].y;
	              objTarget.x = limits[1].x;
	              objTarget.y = limits[1].y;
	              objTarget.limit = limits;
	            }
	            binder.angle = angleWall;
	            binder.thick = wall.thick;
	            objTarget.angle = angleWall;
	            objTarget.thick = wall.thick;
	            binder.update();
	            objTarget.update();
	          }
	        }
	      }
	    } // END OBJ MOVE
	    if (binder.type != 'obj' && binder.type != 'segment') rib();
	  }
	  // ENDBIND ACTION MOVE **************************************************************************

	  // ---DRAG VIEWBOX PANNING -------------------------------------------------------

	  if (mode == 'select_mode' && drag == 'on') {
	    snap = calcul_snap(event, grid_snap);
	    document.querySelector('#extension-floorplanner-lin').style.cursor = 'move';
	    distX = (snap.xMouse - pox) * factor;
	    distY = (snap.yMouse - poy) * factor;
	    // pox = event.pageX;
	    // poy = event.pageY;
	    zoom_maker('zoomdrag', distX, distY);
	  }
	} // END MOUSEMOVE

	// *****************************************************************************************************
	// *****************************************************************************************************
	// *****************************************************************************************************
	// ******************************        MOUSE DOWN            *****************************************
	// *****************************************************************************************************
	// *****************************************************************************************************
	// *****************************************************************************************************

	function _MOUSEDOWN(event) {
		
	  event.preventDefault();
		hide_submenus();
	  // *******************************************************************
	  // **************************   DISTANCE MODE   **********************
	  // *******************************************************************
	  if (mode == 'distance_mode') {
	    if (action == 0) {
	      action = 1;
	      snap = calcul_snap(event, grid_snap);
	      pox = snap.x;
	      poy = snap.y;
	    }
	  }

	  // *******************************************************************
	  // *************************   LINE/WALL MODE   **********************
	  // *******************************************************************
	  if (mode == 'line_mode' || mode == 'partition_mode') {
	    if (action == 0) {
	      snap = calcul_snap(event, grid_snap);
	      pox = snap.x;
	      poy = snap.y;
	      if (wallStartConstruc = floorplanEditor.nearWall(snap, 12)) { // TO SNAP SEGMENT TO FINALIZE X2Y2
	        pox = wallStartConstruc.x;
	        poy = wallStartConstruc.y;
	      }
	    }
	    else {
	      // FINALIZE LINE_++
	      construc = 1;
	    }
	    action = 1;
	  }
	  if (mode == 'edit_door_mode') { // ACTION 1 ACTIVATE EDITION OF THE DOOR
	    action = 1;
	    document.querySelector('#extension-floorplanner-lin').style.cursor = 'pointer';
	  }

	  // *******************************************************************
	  // **********************   SELECT MODE + BIND   *********************
	  // *******************************************************************
	  if (mode == 'select_mode') {
	    if (typeof (binder) != 'undefined' && (binder.type == 'segment' || binder.type == 'node' || binder.type == 'obj' || binder.type == 'boundingBox')) {
	      mode = 'bind_mode';

	      if (binder.type == 'obj') {
	        action = 1;
	      }

	      if (binder.type == 'boundingBox') {
	        action = 1;
	      }

	      // INIT FOR HELP BINDER NODE MOVING H V (MOUSE DOWN)
	      if (binder.type == 'node') {
	        document.querySelector('#extension-floorplanner-boxScale').style.display='none'
	        var node = binder.data;
	        pox = node.x;
	        poy = node.y;
	        var nodeControl = { x: pox, y: poy };

	        // DETERMINATE DISTANCE OF OPPOSED NODE ON EDGE(s) PARENT(s) OF THIS NODE !!!! NODE 1 -- NODE 2 SYSTE% :-(
	        wallListObj = []; // SUPER VAR -- WARNING
	        var objWall;
	        wallListRun = [];
	        for (var ee = WALLS.length - 1; ee > -1; ee--) { // SEARCH MOST YOUNG WALL COORDS IN NODE BINDER
	          if (isObjectsEquals(WALLS[ee].start, nodeControl) || isObjectsEquals(WALLS[ee].end, nodeControl)) {
	            wallListRun.push(WALLS[ee]);
	            break;
	          }
	        }
					console.log("wallListRun: ", wallListRun);
					if(wallListRun.length){
		        if (wallListRun[0].child != null) {
		          if (isObjectsEquals(wallListRun[0].child.start, nodeControl) || isObjectsEquals(wallListRun[0].child.end, nodeControl)) wallListRun.push(wallListRun[0].child);
		        }
		        if (wallListRun[0].parent != null) {
		          if (isObjectsEquals(wallListRun[0].parent.start, nodeControl) || isObjectsEquals(wallListRun[0].parent.end, nodeControl)) wallListRun.push(wallListRun[0].parent);
		        }
					}
	        

	        for (var k in wallListRun) {
	          if (isObjectsEquals(wallListRun[k].start, nodeControl) || isObjectsEquals(wallListRun[k].end, nodeControl)) {
	            var nodeTarget = wallListRun[k].start;
	            if (isObjectsEquals(wallListRun[k].start, nodeControl)) {
	              nodeTarget = wallListRun[k].end;
	            }
	            objWall = floorplanEditor.objFromWall(wallListRun[k]); // LIST OBJ ON EDGE -- NOT INDEX !!!
	            wall = wallListRun[k];
	            for (var ob = 0; ob < objWall.length; ob++) {
	              var objTarget = objWall[ob];
	              var distance = qSVG.measure(objTarget, nodeTarget);
	              wallListObj.push({ wall: wall, from: nodeTarget, distance: distance, obj: objTarget, indexObj: ob });
	            }
	          }
	        }
	        magnetic = 0;
	        action = 1;
	      }
	      if (binder.type == 'segment') {

	        document.querySelector('#extension-floorplanner-boxScale').style.display='none'
	        var wall = binder.wall;
	        binder.before = binder.wall.start;
	        equation2 = floorplanEditor.createEquationFromWall(wall);
	        if (wall.parent != null) {
	          equation1 = floorplanEditor.createEquationFromWall(wall.parent);
	          var angle12 = qSVG.angleBetweenEquations(equation1.A, equation2.A);
	          if (angle12 < 20 || angle12 > 160) {
	            var found = true;
	            for (var k in WALLS) {
	              if (qSVG.rayCasting(wall.start, WALLS[k].coords) && !isObjectsEquals(WALLS[k], wall.parent) && !isObjectsEquals(WALLS[k], wall)) {
	                if (wall.parent.parent != null && isObjectsEquals(wall, wall.parent.parent)) wall.parent.parent = null;
	                if (wall.parent.child != null && isObjectsEquals(wall, wall.parent.child)) wall.parent.child = null;
	                wall.parent = null;
	                found = false;
	                break;
	              }
	            }
	            if (found) {
	              var newWall;
	              if (isObjectsEquals(wall.parent.end, wall.start, "1")) {
	                newWall = new floorplanEditor.wall(wall.parent.end, wall.start, "normal", wall.thick);
	                WALLS.push(newWall);
	                newWall.parent = wall.parent;
	                newWall.child = wall;
	                wall.parent.child = newWall;
	                wall.parent = newWall;
	                equation1 = qSVG.perpendicularEquation(equation2, wall.start.x, wall.start.y);
	              }
	              else if (isObjectsEquals(wall.parent.start, wall.start, "2")) {
	                newWall = new floorplanEditor.wall(wall.parent.start, wall.start, "normal", wall.thick);
	                WALLS.push(newWall);
	                newWall.parent = wall.parent;
	                newWall.child = wall;
	                wall.parent.parent = newWall;
	                wall.parent = newWall;
	                equation1 = qSVG.perpendicularEquation(equation2, wall.start.x, wall.start.y);
	              }
	              // CREATE NEW WALL
	            }
	          }
	        }
	        if (wall.parent == null) {
	          var foundEq = false;
	          for (var k in WALLS) {
	            if (qSVG.rayCasting(wall.start, WALLS[k].coords) && !isObjectsEquals(WALLS[k].coords, wall.coords)) {
	              var angleFollow = qSVG.angleBetweenEquations(WALLS[k].equations.base.A, equation2.A);
	              if (angleFollow < 20 || angleFollow > 160) break;
	              equation1 = floorplanEditor.createEquationFromWall(WALLS[k]);
	              equation1.follow = WALLS[k];
	              equation1.backUp = {
	                coords: WALLS[k].coords,
	                start: WALLS[k].start,
	                end: WALLS[k].end,
	                child: WALLS[k].child,
	                parent: WALLS[k].parent
	              };
	              foundEq = true;
	              break;
	            }
	          }
	          if (!foundEq) equation1 = qSVG.perpendicularEquation(equation2, wall.start.x, wall.start.y);
	        }

	        if (wall.child != null) {
	          equation3 = floorplanEditor.createEquationFromWall(wall.child);
	          var angle23 = qSVG.angleBetweenEquations(equation3.A, equation2.A);
	          if (angle23 < 20 || angle23 > 160) {
	            var found = true;
	            for (var k in WALLS) {
	              if (qSVG.rayCasting(wall.end, WALLS[k].coords) && !isObjectsEquals(WALLS[k], wall.child) && !isObjectsEquals(WALLS[k], wall)) {
	                if (wall.child.parent != null && isObjectsEquals(wall, wall.child.parent)) wall.child.parent = null;
	                if (wall.child.child != null && isObjectsEquals(wall, wall.child.child)) wall.child.child = null;
	                wall.child = null;
	                found = false;
	                break;
	              }
	            }
	            if (found) {
	              if (isObjectsEquals(wall.child.start, wall.end)) {
	                var newWall = new floorplanEditor.wall(wall.end, wall.child.start, "new", wall.thick);
	                WALLS.push(newWall);
	                newWall.parent = wall;
	                newWall.child = wall.child;
	                wall.child.parent = newWall;
	                wall.child = newWall;
	                equation3 = qSVG.perpendicularEquation(equation2, wall.end.x, wall.end.y);
	              }
	              else if (isObjectsEquals(wall.child.end, wall.end)) {
	                var newWall = new floorplanEditor.wall(wall.end, wall.child.end, "normal", wall.thick);
	                WALLS.push(newWall);
	                newWall.parent = wall;
	                newWall.child = wall.child;
	                wall.child.child = newWall;
	                wall.child = newWall;
	                equation3 = qSVG.perpendicularEquation(equation2, wall.end.x, wall.end.y);
	              }
	              // CREATE NEW WALL
	            }
	          }
	        }
	        if (wall.child == null) {
	          var foundEq = false;
	          for (var k in WALLS) {
	            if (qSVG.rayCasting(wall.end, WALLS[k].coords) && !isObjectsEquals(WALLS[k].coords, wall.coords, "4")) {
	              var angleFollow = qSVG.angleBetweenEquations(WALLS[k].equations.base.A, equation2.A);
	              if (angleFollow < 20 || angleFollow > 160) break;
	              equation3 = floorplanEditor.createEquationFromWall(WALLS[k]);
	              equation3.follow = WALLS[k];
	              equation3.backUp = {
	                coords: WALLS[k].coords,
	                start: WALLS[k].start,
	                end: WALLS[k].end,
	                child: WALLS[k].child,
	                parent: WALLS[k].parent
	              };
	              foundEq = true;
	              break;
	            }
	          }
	          if (!foundEq) equation3 = qSVG.perpendicularEquation(equation2, wall.end.x, wall.end.y);
	        }

	        equationFollowers = [];
	        for (var k in WALLS) {
	          if (WALLS[k].child == null && qSVG.rayCasting(WALLS[k].end, wall.coords) && !isObjectsEquals(wall, WALLS[k])) {
	            equationFollowers.push({
	              wall: WALLS[k],
	              eq: floorplanEditor.createEquationFromWall(WALLS[k]),
	              type: "end"
	            });
	          }
	          if (WALLS[k].parent == null && qSVG.rayCasting(WALLS[k].start, wall.coords) && !isObjectsEquals(wall, WALLS[k])) {
	            equationFollowers.push({
	              wall: WALLS[k],
	              eq: floorplanEditor.createEquationFromWall(WALLS[k]),
	              type: "start"
	            });
	          }
	        }

	        equationsObj = [];
	        var objWall = floorplanEditor.objFromWall(wall); // LIST OBJ ON EDGE
	        for (var ob = 0; ob < objWall.length; ob++) {
	          var objTarget = objWall[ob];
	          equationsObj.push({ obj: objTarget, wall: wall, eq: qSVG.perpendicularEquation(equation2, objTarget.x, objTarget.y) });
	        }
	        action = 1;
	      }
	    }

	    else {
	      action = 0;
	      drag = 'on';
	      snap = calcul_snap(event, grid_snap);
	      pox = snap.xMouse;
	      poy = snap.yMouse;
	    }
	  }
	}

	//******************************************************************************************************
	//*******************  *****  ******        ************************************************************
	//*******************  *****  ******  ****  ************************************************************
	//*******************  *****  ******  ****  ************************************************************
	//*******************  *****  ******        ************************************************************
	//*******************         ******  ******************************************************************
	//**********************************  ******************************************************************

	function _MOUSEUP(event) {
	  if (showRib) document.querySelector('#extension-floorplanner-boxScale').style.display = 'block'
	  drag = 'off';
	  cursor('default');
		
		if(document.body.classList.contains('developer')){
			document.getElementById('extension-floorplanner-title').innerText = mode;
		}
		
	  if (mode == 'select_mode') {
	    if (typeof (binder) != 'undefined') {
	      //binder.remove();
	      //delete binder;
				bye_binder();
	      floorplanSave();
	    }
	  }

	  //**************************************************************************
	  //********************   TEXTE   MODE **************************************
	  //**************************************************************************
	  if (mode == 'text_mode') {
	    if (action == 0) {
	      action = 1;
	      const textModal = document.querySelector('#extension-floorplanner-textToLayer');

	      textModal.style.display='block';
	      mode == 'edit_text_mode';
	    }
	  }

	  //**************************************************************************
	  //**************        OBJECT   MODE **************************************
	  //**************************************************************************
	  if (mode == 'object_mode') {
		  console.log("in object_mode. this fixates an object?");
	    OBJDATA.push(binder);
		 console.log("OBJDATA is now: ", OBJDATA);
	    if(typeof binder.graph != 'undefined') binder.graph.remove();
	    var targetBox = 'boxcarpentry';
	    if (OBJDATA[OBJDATA.length - 1].class == 'energy') targetBox = 'boxEnergy';
	    if (OBJDATA[OBJDATA.length - 1].class == 'furniture') targetBox = 'boxFurniture';
	    document.querySelector('#extension-floorplanner-' + targetBox).append(OBJDATA[OBJDATA.length - 1].graph);
	    //delete binder;
			bye_binder();
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Object added';
	    fonc_button('select_mode');
	    floorplanSave();
	  }

	  // *******************************************************************
	  // **************************   DISTANCE MODE   **********************
	  // *******************************************************************
	  if (mode == 'distance_mode') {

	    if (action == 1) {
	      action = 0;
	      // MODIFY BBOX FOR BINDER ZONE (TXT)
	      var bbox = labelMeasure[0].getBoundingClientRect();
	      bbox.x = (bbox.x * factor) - (offset.left * factor) + originX_viewbox;
	      bbox.y = (bbox.y * factor) - (offset.top * factor) + originY_viewbox;
	      bbox.origin = { x: bbox.x + (bbox.width / 2), y: bbox.y + (bbox.height / 2) };
	      binder.bbox = bbox;
	      binder.realBbox = [
	        { x: binder.bbox.x, y: binder.bbox.y }, { x: binder.bbox.x + binder.bbox.width, y: binder.bbox.y }, { x: binder.bbox.x + binder.bbox.width, y: binder.bbox.y + binder.bbox.height }, { x: binder.bbox.x, y: binder.bbox.y + binder.bbox.height }];
	      binder.size = binder.bbox.width;
	      binder.thick = binder.bbox.height;
	      binder.graph.append(labelMeasure);
	      OBJDATA.push(binder);
	      if(typeof binder.graph != 'undefine') binder.graph.remove();
	      document.querySelector('#extension-floorplanner-boxcarpentry').append(OBJDATA[OBJDATA.length - 1].graph);
	      //delete binder;
				bye_binder();
	      //delete labelMeasure;
	      cross.remove();
	      //delete cross;
	      document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Measure added';
	      fonc_button('select_mode');
	      floorplanSave();
	    }
	  }

	  // *******************************************************************
	  // **************************   ROOM MODE   **************************
	  // *******************************************************************

	  if (mode == 'room_mode') {

	    if (typeof (binder) == "undefined") {
	      return false;
	    }

	    var area = binder.area / 3600;
		binder.setAttribute('fill', 'none');
		binder.setAttribute('stroke', '#ddf00a');
		binder.setAttribute('stroke-width', 7);
	    document.querySelector('.extension-floorplanner-size').innerHTML = area.toFixed(2) + " m²";
	    document.querySelector('#extension-floorplanner-roomIndex').value = binder.id;
	    if (ROOM[binder.id].surface != '') document.querySelector('#extension-floorplanner-roomSurface').value = ROOM[binder.id].surface;
	    else document.querySelector('#extension-floorplanner-roomSurface').value = '';
	    document.querySelector('#extension-floorplanner-seeArea').checked = ROOM[binder.id].showSurface;
	    document.querySelector('#extension-floorplanner-roomBackground').value = ROOM[binder.id].color;
	    var roomName = ROOM[binder.id].name;
	    document.querySelector('#extension-floorplanner-roomName').value = roomName;
	    if (ROOM[binder.id].name != '') {
	      document.querySelector('#extension-floorplanner-roomLabel').innerHTML = roomName + ' <span class="caret"></span>';
	    }
	    else {
	      document.querySelector('#extension-floorplanner-roomLabel').innerHTML = 'None <span class="caret"></span>';
	    }

	    var actionToDo = ROOM[binder.id].action;
	    document.querySelector('#extension-floorplanner-' + actionToDo + 'Action').checked = true;
	    document.querySelector('#extension-floorplanner-panel').style.display='none';
	    document.querySelector('#extension-floorplanner-roomTools').style.display='block';
	    document.querySelector('#extension-floorplanner-lin').style.cursor = 'default';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Select a room';

	    mode = 'edit_room_mode';
	    floorplanSave();
	  }

	  // *******************************************************************
	  // **************************   NODE MODE   **************************
	  // *******************************************************************

	  if (mode == 'node_mode') {
	    if (typeof (binder) != 'undefined') { // ALSO ON MOUSEUP WITH HAVE CIRCLEBINDER ON ADDPOINT
	      var newWall = new floorplanEditor.wall({ x: binder.data.x, y: binder.data.y }, binder.data.wall.end, "normal", binder.data.wall.thick);
	      WALLS.push(newWall);
	      binder.data.wall.end = { x: binder.data.x, y: binder.data.y };
	      //binder.remove();
	      //delete binder;
				bye_binder();
	      floorplanEditor.architect(WALLS);
	      floorplanSave();
	    }
	    fonc_button('select_mode');
	  }

	  // *******************************************************************  ***** ****      *******  ******  ******  *****
	  // **************************   OBJ MODE   ***************************  *   * *******     *****  ******  ******   **
	  // *******************************************************************  ***** ****       ******  ******  ******  ***

	  if (mode == 'door_mode') {
	    if (typeof (binder) == "undefined") {
	      document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'The plan currently contains no wall.';
	      fonc_button('select_mode');
	      return false;
	    }
	    OBJDATA.push(binder);
	    if(typeof binder.graph != 'undefined') binder.graph.remove();
	    document.querySelector('#extension-floorplanner-boxcarpentry').append(OBJDATA[OBJDATA.length - 1].graph);
	    //delete binder;
			bye_binder();
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Element added';
	    fonc_button('select_mode');
	    floorplanSave();
	  }

	  // *******************************************************************
	  // ********************   LINE MODE MOUSE UP   ***********************
	  // *******************************************************************

	  if (mode == 'line_mode' || mode == 'partition_mode') {
		  // This shouldn't be here.. of maybe it should.
		  //if(document.querySelector('#extension-floorplanner-linetemp')){
		  	document.querySelector('#extension-floorplanner-linetemp').remove(); // DEL LINE HELP CONSTRUC 0 45 90
		  //}
		
		  
	    intersectionOff();

	    var sizeWall = qSVG.measure({ x: x, y: y }, { x: pox, y: poy });
	    sizeWall = sizeWall / meter;
	    if (document.querySelectorAll('#extension-floorplanner-line_construc').length && sizeWall > 0.3) {
	      var sizeWall = wallSize;
	      if (mode == 'partition_mode') sizeWall = partitionSize;
	      var wall = new floorplanEditor.wall({ x: pox, y: poy }, { x: x, y: y }, "normal", sizeWall);
	      WALLS.push(wall);
	      floorplanEditor.architect(WALLS);

	      if (document.getElementById("extension-floorplanner-multi").checked && !wallEndConstruc) {
	        cursor('validation');
	        action = 1;
	      }
	      else action = 0;
	      document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Wall added <span style=\'font-size:0.6em\'>Moy. ' + (qSVG.measure(
	        { x: pox, y: poy }, { x: x, y: y }) / 60).toFixed(2) + ' m</span>';
	      document.querySelector('#extension-floorplanner-line_construc').remove(); // DEL LINE CONSTRUC HELP TO VIEW NEW SEG PATH
	      lengthTemp.remove();
	      //delete lengthTemp;
	      construc = 0;
	      if (wallEndConstruc) action = 0;
	      //delete wallEndConstruc;
	      pox = x;
	      poy = y;
	      floorplanSave();
	    }
	    else {
	      action = 0;
	      construc = 0;
	      document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Select mode';
	      fonc_button('select_mode');
	      if (typeof (binder) != 'undefined') {
	        //binder.remove();
	        //delete binder;
					bye_binder();
	      }
	      snap = calcul_snap(event, grid_snap);
	      pox = snap.x;
	      poy = snap.y;
	    }
	  }
	  // **************************** END LINE MODE MOUSE UP **************************

	  //**************************************************************************************
	  //**********************      BIND MODE MOUSE UP    ************************************
	  //**************************************************************************************

	  if (mode == 'bind_mode') {
		  console.log("in bind_mode");
	    action = 0;
	    construc = 0; // CONSTRUC 0 TO FREE BINDER GROUP NODE WALL MOVING
	    if (typeof (binder) != 'undefined') {
	      fonc_button('select_mode');
	      if (binder.type == 'node') {

	      } // END BINDER NODE

	      if (binder.type == 'segment') {

	        var found = false;
	        if (binder.wall.start == binder.before) {
	          found = true;
	        }

	        if (found) {
	          document.querySelector('#extension-floorplanner-panel').style.display='none'
	          var objWall = floorplanEditor.objFromWall(wallBind);
	          document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Modify a wall<br/><span style="font-size:0.7em;color:#de9b43">This wall can\'t become a separation (contains doors or windows) !</span>';
	          if (objWall.length > 0) document.querySelector('#extension-floorplanner-separate').style.display='none';
	          else if (binder.wall.type == 'separate') {
	            document.querySelector('#extension-floorplanner-separate').style.display='none';
	            document.querySelector('#extension-floorplanner-rangeThick').style.display='none';
	            document.querySelector('#extension-floorplanner-recombine').style.display='block';
	            document.querySelector('#extension-floorplanner-cutWall').style.display='none';
	            document.getElementById('extension-floorplanner-titleWallTools').textContent = "Modify the separation";
	          }
	          else {
	            document.querySelector('#extension-floorplanner-cutWall').style.display='block';
	            document.querySelector('#extension-floorplanner-separate').style.display='block';
	            document.querySelector('#extension-floorplanner-rangeThick').style.display='block';
	            document.querySelector('#extension-floorplanner-recombine').style.display='none';
	            document.getElementById('extension-floorplanner-titleWallTools').textContent = "Modify the wall";
	            document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Modify the wall';
	          }
	          document.querySelector('#extension-floorplanner-wallTools').style.display = 'block'
	          document.getElementById('extension-floorplanner-wallWidth').setAttribute('min', 7);
	          document.getElementById('extension-floorplanner-wallWidth').setAttribute('max', 50);
	          document.getElementById('extension-floorplanner-wallWidthScale').textContent = "7-50";
	          document.getElementById("extension-floorplanner-wallWidth").value = binder.wall.thick;
	          document.getElementById("extension-floorplanner-wallWidthVal").textContent = binder.wall.thick;
	          mode = 'edit_wall_mode';
	        }
	        //delete equation1;
	        //delete equation2;
	        //delete equation3;
	        //delete intersectionFollowers;
	      }

	      if (binder.type == 'obj') {
	        var moveObj = Math.abs(binder.oldXY.x - binder.x) + Math.abs(binder.oldXY.y - binder.y);
	        if (moveObj < 1) {
			  document.querySelector('#extension-floorplanner-panel').style.display='none';
			  document.querySelector('#extension-floorplanner-objTools').style.display='block';
	          document.querySelector('#extension-floorplanner-lin').style.cursor = 'default';
	          document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Config. the door/window';
	          //console.log('obj ??', obj);
	          document.getElementById('extension-floorplanner-doorWindowWidth').setAttribute('min', binder.obj.params.resizeLimit.width.min);
	          document.getElementById('extension-floorplanner-doorWindowWidth').setAttribute('max', binder.obj.params.resizeLimit.width.max);
	          document.getElementById('extension-floorplanner-doorWindowWidthScale').textContent = binder.obj.params.resizeLimit.width.min + "-" + binder.obj.params.resizeLimit.width.max;
	          document.getElementById("extension-floorplanner-doorWindowWidth").value = binder.obj.size;
	          document.getElementById("extension-floorplanner-doorWindowWidthVal").textContent = binder.obj.size;
	          mode = 'edit_door_mode';
			  console.log("setting edit_door_mode");
	        }
	        else {
						console.log("modify door failure")
	          mode = "select_mode";
	          action = 0;
	          if(typeof binder.graph != 'undefined') binder.graph.remove();
	          //delete binder;
						bye_binder();
	        }
	      }

	      if (typeof (binder) != 'undefined' && binder.type == 'boundingBox') {
	        var moveObj = Math.abs(binder.oldX - binder.x) + Math.abs(binder.oldY - binder.y);
	        var objTarget = binder.obj;
	        if (!objTarget.params.move) {
	          // TO REMOVE MEASURE ON PLAN
	          objTarget.graph.remove();
	          OBJDATA.splice(OBJDATA.indexOf(objTarget), 1);
	          document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Measure deleted !';
	        }
	        if (moveObj < 1 && objTarget.params.move) {
	          if (!objTarget.params.resize) document.querySelector('#extension-floorplanner-objBoundingBoxScale').style.display='none';
	          else document.querySelector('#extension-floorplanner-objBoundingBoxScale').style.display='block';
	          if (!objTarget.params.rotate) document.querySelector('#extension-floorplanner-objBoundingBoxRotation').style.display='none';
	          else document.querySelector('#extension-floorplanner-objBoundingBoxRotation').style.display='block';
	          document.querySelector('#extension-floorplanner-panel').style.display='none'
	          //console.log(objTarget.params.resizeLimit.width.min)
	          document.querySelector('#extension-floorplanner-objBoundingBox').style.display='block'
	          document.querySelector('#extension-floorplanner-lin').style.cursor ='default';
	          document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Modify the object';
	          //console.log(objTarget)
						if(objTarget.params.resizeLimit){
							console.log("object has resize limit: ", objTarget.params.resizeLimit);
							
		          document.getElementById('extension-floorplanner-bboxWidth').setAttribute('min', objTarget.params.resizeLimit.width.min);
		          document.getElementById('extension-floorplanner-bboxWidth').setAttribute('max', objTarget.params.resizeLimit.width.max);
		          document.getElementById('extension-floorplanner-bboxWidthScale').textContent = objTarget.params.resizeLimit.width.min + "-" + objTarget.params.resizeLimit.height.max;
		          document.getElementById('extension-floorplanner-bboxHeight').setAttribute('min', objTarget.params.resizeLimit.height.min);
		          document.getElementById('extension-floorplanner-bboxHeight').setAttribute('max', objTarget.params.resizeLimit.height.max);
		          document.getElementById('extension-floorplanner-bboxHeightScale').textContent = objTarget.params.resizeLimit.height.min + "-" + objTarget.params.resizeLimit.height.max;
						}
	          
	          document.querySelector('#extension-floorplanner-stepsCounter').style.display='none';
	          if (objTarget.class == 'stair') {
	            document.getElementById("extension-floorplanner-bboxStepsVal").textContent = objTarget.value;
	            document.querySelector('#extension-floorplanner-stepsCounter').style.display='block';
	          }
	          document.getElementById("extension-floorplanner-bboxWidth").value = objTarget.width * 100;
	          document.getElementById("extension-floorplanner-bboxWidthVal").textContent = objTarget.width * 100;
	          document.getElementById("extension-floorplanner-bboxHeight").value = objTarget.height * 100;
	          document.getElementById("extension-floorplanner-bboxHeightVal").textContent = objTarget.height * 100;
	          document.getElementById("extension-floorplanner-bboxRotation").value = objTarget.angle;
	          document.getElementById("extension-floorplanner-bboxRotationVal").textContent = objTarget.angle;
	          mode = 'edit_boundingBox_mode';
	        }
	        else {
	          mode = "select_mode";
	          action = 0;
	          if(typeof binder.graph != 'undefined') binder.graph.remove();
	          //delete binder;
						bye_binder();
	        }
	      }

	      if (mode == 'bind_mode') {
	        //binder.remove();
	        //delete binder;
					bye_binder();
	      }
	    } // END BIND IS DEFINED
	    floorplanSave();
	  } // END BIND MODE

	  if (mode != 'edit_room_mode') {
	    floorplanEditor.showScaleBox();
	    rib();
	  }
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	//
	//   FUNC
	//
	
	
	
	
	
	//init
	let WALLS = [];
	let OBJDATA = [];
	let ROOM = [];
	let HISTORY = [];
	let wallSize = 20;
	let partitionSize = 8;
	let drag = 'off';
	let action = 0;
	let magnetic = 0;
	let construc = 0;
	let Rcirclebinder = 8;
	let mode = 'select_mode';
	let modeOption;
	console.log("linElement: ", linElement);
	
	
	
	var rect = linElement.getBoundingClientRect(); // get the bounding rectangle

	console.log( rect.width );
	console.log( rect.height);
	
	let taille_w = rect.width; //linElement.getBBox().width;
	let taille_h = rect.height; //linElement.getBBox().height;
	let offset = getOffset(linElement);
	console.error("taille_w: ", taille_w);
	console.log("lin element offset.top: ", offset.top);
	let grid = 20;
	let showRib = true;
	let showArea = true;
	let meter = 60;
	let grid_snap = 'off';
	let colorbackground = "#ffffff";
	let colorline = "#fff";
	let colorroom = "#f0daaf";
	let colorWall = "#666";
	let pox = 0;
	let poy = 0;
	let segment = 0;
	let xpath = 0;
	let ypath = 0;
	let width_viewbox = taille_w;
	let height_viewbox = taille_h;
	let ratio_viewbox = height_viewbox / width_viewbox;
	let originX_viewbox = 0;
	let originY_viewbox = 0;
	let zoom = 9;
	let factor = 1;

	let sizeText = [];
	let showAllSizeStatus = 0;

	console.error("in func.js. ratio_viewbox: ", ratio_viewbox);

	// **************************************************************************
	// *****************   LOAD / SAVE LOCALSTORAGE      ************************
	// **************************************************************************

	function initHistory(boot = false) {
		console.log("in initHistory. boot: ", boot);
		document.getElementById('extension-floorplanner-myModal').style.display = 'none';
	    HISTORY.index = 0;
	    if (!boot && localStorage.getItem('extension-floorplanner-history')) localStorage.removeItem('extension-floorplanner-history');
	    if (localStorage.getItem('extension-floorplanner-history') && boot === "recovery") {
	        let historyTemp = JSON.parse(localStorage.getItem('extension-floorplanner-history'));
	        floorplanLoad(historyTemp.length - 1, "boot");
	        floorplanSave("boot");
	    }
	    if (boot === "newSquare") {
	        if (localStorage.getItem('extension-floorplanner-history')) localStorage.removeItem('extension-floorplanner-history');
	        HISTORY.push({
	            "objData": [],
	            "wallData": [{
	                "thick": 20,
	                "start": { "x": 540, "y": 194 },
	                "end": { "x": 540, "y": 734 },
	                "type": "normal",
	                "parent": 3,
	                "child": 1,
	                "angle": 1.5707963267948966,
	                "equations": { "up": { "A": "v", "B": 550 }, "down": { "A": "v", "B": 530 }, "base": { "A": "v", "B": 540 } },
	                "coords": [{ "x": 550, "y": 204 }, { "x": 530, "y": 184 }, { "x": 530, "y": 744 }, { "x": 550, "y": 724 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 540, "y": 734 },
	                "end": { "x": 1080, "y": 734 },
	                "type": "normal",
	                "parent": 0,
	                "child": 2,
	                "angle": 0,
	                "equations": { "up": { "A": "h", "B": 724 }, "down": { "A": "h", "B": 744 }, "base": { "A": "h", "B": 734 } },
	                "coords": [{ "x": 550, "y": 724 }, { "x": 530, "y": 744 }, { "x": 1090, "y": 744 }, { "x": 1070, "y": 724 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1080, "y": 734 },
	                "end": { "x": 1080, "y": 194 },
	                "type": "normal",
	                "parent": 1,
	                "child": 3,
	                "angle": -1.5707963267948966,
	                "equations": {
	                    "up": { "A": "v", "B": 1070 },
	                    "down": { "A": "v", "B": 1090 },
	                    "base": { "A": "v", "B": 1080 }
	                },
	                "coords": [{ "x": 1070, "y": 724 }, { "x": 1090, "y": 744 }, { "x": 1090, "y": 184 }, { "x": 1070, "y": 204 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1080, "y": 194 },
	                "end": { "x": 540, "y": 194 },
	                "type": "normal",
	                "parent": 2,
	                "child": 0,
	                "angle": 3.141592653589793,
	                "equations": { "up": { "A": "h", "B": 204 }, "down": { "A": "h", "B": 184 }, "base": { "A": "h", "B": 194 } },
	                "coords": [{ "x": 1070, "y": 204 }, { "x": 1090, "y": 184 }, { "x": 530, "y": 184 }, { "x": 550, "y": 204 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }],
	            "roomData": [{
	                "coords": [{ "x": 540, "y": 734 }, { "x": 1080, "y": 734 }, { "x": 1080, "y": 194 }, {
	                    "x": 540,
	                    "y": 194
	                }, { "x": 540, "y": 734 }],
	                "coordsOutside": [{ "x": 1090, "y": 744 }, { "x": 1090, "y": 184 }, { "x": 530, "y": 184 }, {
	                    "x": 530,
	                    "y": 744
	                }, { "x": 1090, "y": 744 }],
	                "coordsInside": [{ "x": 1070, "y": 724 }, { "x": 1070, "y": 204 }, { "x": 550, "y": 204 }, {
	                    "x": 550,
	                    "y": 724
	                }, { "x": 1070, "y": 724 }],
	                "inside": [],
	                "way": ["0", "2", "3", "1", "0"],
	                "area": 270400,
	                "surface": "",
	                "name": "",
	                "color": "gradientWhite",
	                "showSurface": true,
	                "action": "add"
	            }]
	        });
	        HISTORY[0] = JSON.stringify(HISTORY[0]);
	        localStorage.setItem('extension-floorplanner-history', JSON.stringify(HISTORY));
	        floorplanLoad(0);
	        floorplanSave();
	    }
	    if (boot === "newL") {
	        if (localStorage.getItem('extension-floorplanner-history')) localStorage.removeItem('extension-floorplanner-history');
	        HISTORY.push({
	            "objData": [],
	            "wallData": [{
	                "thick": 20,
	                "start": { "x": 447, "y": 458 },
	                "end": { "x": 447, "y": 744 },
	                "type": "normal",
	                "parent": 5,
	                "child": 1,
	                "angle": 1.5707963267948966,
	                "equations": { "up": { "A": "v", "B": 457 }, "down": { "A": "v", "B": 437 }, "base": { "A": "v", "B": 447 } },
	                "coords": [{ "x": 457, "y": 468 }, { "x": 437, "y": 448 }, { "x": 437, "y": 754 }, { "x": 457, "y": 734 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 447, "y": 744 },
	                "end": { "x": 1347, "y": 744 },
	                "type": "normal",
	                "parent": 0,
	                "child": 2,
	                "angle": 0,
	                "equations": { "up": { "A": "h", "B": 734 }, "down": { "A": "h", "B": 754 }, "base": { "A": "h", "B": 744 } },
	                "coords": [{ "x": 457, "y": 734 }, { "x": 437, "y": 754 }, { "x": 1357, "y": 754 }, { "x": 1337, "y": 734 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1347, "y": 744 },
	                "end": { "x": 1347, "y": 144 },
	                "type": "normal",
	                "parent": 1,
	                "child": 3,
	                "angle": -1.5707963267948966,
	                "equations": {
	                    "up": { "A": "v", "B": 1337 },
	                    "down": { "A": "v", "B": 1357 },
	                    "base": { "A": "v", "B": 1347 }
	                },
	                "coords": [{ "x": 1337, "y": 734 }, { "x": 1357, "y": 754 }, { "x": 1357, "y": 134 }, { "x": 1337, "y": 154 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1347, "y": 144 },
	                "end": { "x": 1020, "y": 144 },
	                "type": "normal",
	                "parent": 2,
	                "child": 4,
	                "angle": 3.141592653589793,
	                "equations": { "up": { "A": "h", "B": 154 }, "down": { "A": "h", "B": 134 }, "base": { "A": "h", "B": 144 } },
	                "coords": [{ "x": 1337, "y": 154 }, { "x": 1357, "y": 134 }, { "x": 1010, "y": 134 }, { "x": 1030, "y": 154 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1020, "y": 144 },
	                "end": { "x": 1020, "y": 458 },
	                "type": "normal",
	                "parent": 3,
	                "child": 5,
	                "angle": 1.5707963267948966,
	                "equations": {
	                    "up": { "A": "v", "B": 1030 },
	                    "down": { "A": "v", "B": 1010 },
	                    "base": { "A": "v", "B": 1020 }
	                },
	                "coords": [{ "x": 1030, "y": 154 }, { "x": 1010, "y": 134 }, { "x": 1010, "y": 448 }, { "x": 1030, "y": 468 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }, {
	                "thick": 20,
	                "start": { "x": 1020, "y": 458 },
	                "end": { "x": 447, "y": 458 },
	                "type": "normal",
	                "parent": 4,
	                "child": 0,
	                "angle": 3.141592653589793,
	                "equations": { "up": { "A": "h", "B": 468 }, "down": { "A": "h", "B": 448 }, "base": { "A": "h", "B": 458 } },
	                "coords": [{ "x": 1030, "y": 468 }, { "x": 1010, "y": 448 }, { "x": 437, "y": 448 }, { "x": 457, "y": 468 }],
	                "graph": { "0": {}, "context": {}, "length": 1 }
	            }],
	            "roomData": [{
	                "coords": [{ "x": 447, "y": 744 }, { "x": 1347, "y": 744 }, { "x": 1347, "y": 144 }, {
	                    "x": 1020,
	                    "y": 144
	                }, { "x": 1020, "y": 458 }, { "x": 447, "y": 458 }, { "x": 447, "y": 744 }],
	                "coordsOutside": [{ "x": 1357, "y": 754 }, { "x": 1357, "y": 134 }, { "x": 1010, "y": 134 }, {
	                    "x": 1010,
	                    "y": 448
	                }, { "x": 437, "y": 448 }, { "x": 437, "y": 754 }, { "x": 1357, "y": 754 }],
	                "coordsInside": [{ "x": 1337, "y": 734 }, { "x": 1337, "y": 154 }, { "x": 1030, "y": 154 }, {
	                    "x": 1030,
	                    "y": 468
	                }, { "x": 457, "y": 468 }, { "x": 457, "y": 734 }, { "x": 1337, "y": 734 }],
	                "inside": [],
	                "way": ["0", "2", "3", "4", "5", "1", "0"],
	                "area": 330478,
	                "surface": "",
	                "name": "",
	                "color": "gradientWhite",
	                "showSurface": true,
	                "action": "add"
	            }]
	        });
	        HISTORY[0] = JSON.stringify(HISTORY[0]);
	        localStorage.setItem('extension-floorplanner-history', JSON.stringify(HISTORY));
	        floorplanLoad(0);
	        floorplanSave();
	    }
	}

	document.getElementById('extension-floorplanner-redo').addEventListener("click", function () {
		floorplanner_undo();
	});
	
	function floorplanner_undo(){
		console.log("in floorplanner undo. HISTORY.index ?<? HISTORY.length", HISTORY.index, HISTORY.length);
    if (HISTORY.index < HISTORY.length) {
        floorplanLoad(HISTORY.index);
        HISTORY.index++;
        document.querySelector('#extension-floorplanner-undo').classList.remove('extension-floorplanner-disabled');
        if (HISTORY.index === HISTORY.length) {
            document.querySelector('#extension-floorplanner-redo').classList.add('extension-floorplanner-disabled');
        }
    }
	}

	document.getElementById('extension-floorplanner-undo').addEventListener("click", function () {
		floorplanner_redo();
	});
	
	function floorplanner_redo(){
    if (HISTORY.index > 0) {
        document.querySelector('#extension-floorplanner-undo').classList.remove('extension-floorplanner-disabled');
        if (HISTORY.index - 1 > 0) {
            HISTORY.index--;
            floorplanLoad(HISTORY.index - 1);
            document.querySelector('#extension-floorplanner-redo').classList.remove('extension-floorplanner-disabled');
        }
    }
    if (HISTORY.index === 1) document.querySelector('#extension-floorplanner-undo').classList.add('extension-floorplanner-disabled');
	}

	function floorplanSave(boot = false) {
		console.log("\nin floorplanSave. boot: ", boot);
		console.log("WALLS: ", WALLS);
		console.log("OBJDATA: ", OBJDATA);
		console.log("ROOM: ", ROOM);
		console.log("HISTORY: ", HISTORY);
		
		//console.log("HISTORY[HISTORY.length - 1]: ", HISTORY[HISTORY.length - 1]);
		
		if(ROOM.length){
			root_el.classList.add('extension-floorplanner-has-room');
		}
		else{
			root_el.classList.remove('extension-floorplanner-has-room');
		}
		
		
    if (boot) localStorage.removeItem('extension-floorplanner-history');
    // FOR CYCLIC OBJ INTO LOCALSTORAGE !!!
    for (let k in WALLS) {
        if (WALLS[k].child != null) {
            WALLS[k].child = WALLS.indexOf(WALLS[k].child);
        }
        if (WALLS[k].parent != null) {
            WALLS[k].parent = WALLS.indexOf(WALLS[k].parent);
        }
    }
    if (JSON.stringify({ objData: OBJDATA, wallData: WALLS, roomData: ROOM }) === HISTORY[HISTORY.length - 1]) {
        for (let k in WALLS) {
            if (WALLS[k].child != null) {
                WALLS[k].child = WALLS[WALLS[k].child];
            }
            if (WALLS[k].parent != null) {
                WALLS[k].parent = WALLS[WALLS[k].parent];
            }
        }
				console.warn("not saving because no real change");
        return false;
    }

    if (HISTORY.index < HISTORY.length) {
        HISTORY.splice(HISTORY.index, (HISTORY.length - HISTORY.index));
        document.querySelector('#extension-floorplanner-redo').classList.add('extension-floorplanner-disabled');
    }
    HISTORY.push(JSON.stringify({ objData: OBJDATA, wallData: WALLS, roomData: ROOM }));
		console.log("pushed HISTORY: ", HISTORY);
    localStorage.setItem('extension-floorplanner-history', JSON.stringify(HISTORY));
		console.log("localstorage: ", localStorage.getItem('extension-floorplanner-history'));
    HISTORY.index++;
    if (HISTORY.index > 1) document.querySelector('#extension-floorplanner-undo').classList.remove('extension-floorplanner-disabled');
    for (let k in WALLS) {
        if (WALLS[k].child != null) {
            WALLS[k].child = WALLS[WALLS[k].child];
        }
        if (WALLS[k].parent != null) {
            WALLS[k].parent = WALLS[WALLS[k].parent];
        }
    }
    return true;
	}


	function floorplanLoad(index = HISTORY.index, boot = false) {
	    if (HISTORY.length === 0 && !boot) return false;
	    for (let k in OBJDATA) {
	        OBJDATA[k].graph.remove();
	    }
	    OBJDATA = [];
	    let historyTemp = [];
	    historyTemp = JSON.parse(localStorage.getItem('extension-floorplanner-history'));
	    historyTemp = JSON.parse(historyTemp[index]);
		  console.log("floorplanLoad: historyTemp: ", historyTemp);
		
	    for (let k in historyTemp.objData) {
	        let OO = historyTemp.objData[k];
	        // if (OO.family === 'energy') OO.family = 'byObject';
	        let obj = new floorplanEditor.obj2D(OO.family, OO.class, OO.type, {
	            x: OO.x,
	            y: OO.y
	        }, OO.angle, OO.angleSign, OO.size, OO.hinge = 'normal', OO.thick, OO.value);
	        obj.limit = OO.limit;
	        OBJDATA.push(obj);
	        document.querySelector('#extension-floorplanner-boxEnergy').append(OBJDATA[OBJDATA.length - 1].graph);
	        obj.update();
	    }
	    WALLS = historyTemp.wallData;
	    for (let k in WALLS) {
			console.log("recreating walls? WALLS[k]",WALLS[k]);
	        if (WALLS[k].child != null) {
	            WALLS[k].child = WALLS[WALLS[k].child];
	        }
	        if (WALLS[k].parent != null) {
	            WALLS[k].parent = WALLS[WALLS[k].parent];
	        }
	    }
	    ROOM = historyTemp.roomData;
	    floorplanEditor.architect(WALLS);
	    floorplanEditor.showScaleBox();
	    rib();
	}

	document.querySelectorAll('#extension-floorplanner-tool-root svg').forEach(function (element) {
		console.error("!!! SETTING VIEWBOX 1: ", originX_viewbox, originY_viewbox, width_viewbox,height_viewbox);
	  element.setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox);
	});

	// **************************************************************************
	// *****************   FUNCTIONS ON BUTTON click     ************************
	// **************************************************************************

	document.getElementById('extension-floorplanner-report_mode').addEventListener("click", function () {
	    if (typeof (globalArea) === "undefined") return false;
	    mode = "report_mode";
	    document.querySelector('#extension-floorplanner-panel').style.display='none';
	    document.querySelector('#extension-floorplanner-reportTools').style.display='block'
	    document.getElementById('extension-floorplanner-reportTotalSurface').innerHTML = "Total surface : <b>" + (globalArea / 3600).toFixed(1) + "</b> m²";
	    document.querySelector('#extension-floorplanner-reportTotalSurface').style.display='block'
	    document.getElementById('extension-floorplanner-reportNumberSurface').innerHTML = "Number of rooms : <b>" + ROOM.length + "</b>";
	    document.querySelector('#extension-floorplanner-reportNumberSurface').style.display='block'
	    let number = 1;
	    let reportRoom = '<div class="row">\n';
	    for (let k in ROOM) {
	        let nameRoom = "Room n°" + number + " <small>(sans nom)</small>";
	        if (ROOM[k].name != "") nameRoom = ROOM[k].name;
	        reportRoom += '<div class="col-md-6"><p>' + nameRoom + '</p></div>\n';
	        reportRoom += '<div class="col-md-6"><p>Surface : <b>' + ((ROOM[k].area) / 3600).toFixed(2) + '</b> m²</p></div>\n';
	        number++;
	    }
	    reportRoom += '</div><hr/>\n';
	    reportRoom += '<div>\n';
	    let switchNumber = 0;
	    let plugNumber = 0;
	    let lampNumber = 0;
	    for (let k in OBJDATA) {
	        if (OBJDATA[k].class === 'energy') {
	            if (OBJDATA[k].type === 'switch' || OBJDATA[k].type === 'doubleSwitch' || OBJDATA[k].type === 'dimmer') switchNumber++;
	            if (OBJDATA[k].type === 'plug' || OBJDATA[k].type === 'plug20' || OBJDATA[k].type === 'plug32') plugNumber++;
	            if (OBJDATA[k].type === 'wallLight' || OBJDATA[k].type === 'roofLight') lampNumber++;
	        }
	    }
	    reportRoom += '<p>Switch number : ' + switchNumber + '</p>';
	    reportRoom += '<p>Electric outlet number : ' + plugNumber + '</p>';
	    reportRoom += '<p>Light point number : ' + lampNumber + '</p>';
	    reportRoom += '</div>';
	    reportRoom += '<div>\n';
	    reportRoom += '<h2>Energy distribution per room</h2>\n';
	    number = 1;
	    reportRoom += '<div class="row">\n';
	    reportRoom += '<div class="col-md-4"><p>Label</p></div>\n';
	    reportRoom += '<div class="col-md-2"><small>Swi.</small></div>\n';
	    reportRoom += '<div class="col-md-2"><small>Elec. out.</small></div>\n';
	    reportRoom += '<div class="col-md-2"><small>Light.</small></div>\n';
	    reportRoom += '<div class="col-md-2"><small>Watts Max</small></div>\n';
	    reportRoom += '</div>';

	    let roomEnergy = [];
	    for (let k in ROOM) {
	        reportRoom += '<div class="row">\n';
	        let nameRoom = "Room n°" + number + " <small>(no name)</small>";
	        if (ROOM[k].name != "") nameRoom = ROOM[k].name;
	        reportRoom += '<div class="col-md-4"><p>' + nameRoom + '</p></div>\n';
	        switchNumber = 0;
	        plugNumber = 0;
	        let plug20 = 0;
	        let plug32 = 0;
	        lampNumber = 0;
	        let wattMax = 0;
	        let plug = false;
	        for (let i in OBJDATA) {
	            if (OBJDATA[i].class === 'energy') {
	                if (OBJDATA[i].type === 'switch' || OBJDATA[i].type === 'doubleSwitch' || OBJDATA[i].type === 'dimmer') {
	                    if (roomTarget = floorplanEditor.rayCastingRoom(OBJDATA[i])) {
	                        if (isObjectsEquals(ROOM[k], roomTarget)) switchNumber++;
	                    }
	                }
	                if (OBJDATA[i].type === 'plug' || OBJDATA[i].type === 'plug20' || OBJDATA[i].type === 'plug32') {
	                    if (roomTarget = floorplanEditor.rayCastingRoom(OBJDATA[i])) {
	                        if (isObjectsEquals(ROOM[k], roomTarget)) {
	                            plugNumber++;
	                            if (OBJDATA[i].type === 'plug' && !plug) {
	                                wattMax += 3520;
	                                plug = true;
	                            }
	                            if (OBJDATA[i].type === 'plug20') {
	                                wattMax += 4400;
	                                plug20++;
	                            }
	                            if (OBJDATA[i].type === 'plug32') {
	                                wattMax += 7040;
	                                plug32++;
	                            }
	                        }
	                    }
	                }
	                if (OBJDATA[i].type === 'wallLight' || OBJDATA[i].type === 'roofLight') {
	                    if (roomTarget = floorplanEditor.rayCastingRoom(OBJDATA[i])) {
	                        if (isObjectsEquals(ROOM[k], roomTarget)) {
	                            lampNumber++;
	                            wattMax += 100;
	                        }
	                    }
	                }
	            }
	        }
	        roomEnergy.push({
	            switch: switchNumber,
	            plug: plugNumber,
	            plug20: plug20,
	            plug32: plug32,
	            light: lampNumber
	        });
	        reportRoom += '<div class="col-md-2"><b>' + switchNumber + '</b></div>\n';
	        reportRoom += '<div class="col-md-2"><b>' + plugNumber + '</b></div>\n';
	        reportRoom += '<div class="col-md-2"><b>' + lampNumber + '</b></div>\n';
	        reportRoom += '<div class="col-md-2"><b>' + wattMax + '</b></div>\n';
	        number++;
	        reportRoom += '</div>';
	    }
	    reportRoom += '<hr/><h2>Standard details NF C 15-100</h2>\n';
	    number = 1;

	    for (let k in ROOM) {
	        reportRoom += '<div class="row">\n';
	        let nfc = true;
	        let nameRoom = "Room n°" + number + " <small>(no name)</small>";
	        if (ROOM[k].name != "") nameRoom = ROOM[k].name;
	        reportRoom += '<div class="col-md-4"><p>' + nameRoom + '</p></div>\n';
	        if (ROOM[k].name === "") {
	            reportRoom +=
	                '<div class="col-md-8"><p><i class="fa fa-ban" aria-hidden="true" style="color:red"></i> The room has no label, Home Rough Editor cannot provide you with information.</p></div>\n';
	        } else {
	            if (ROOM[k].name === "Salon") {
	                for (let g in ROOM) {
	                    if (ROOM[g].name === "Salle à manger") {
	                        roomEnergy[k].light += roomEnergy[g].light;
	                        roomEnergy[k].plug += roomEnergy[g].plug;
	                        roomEnergy[k].switch += roomEnergy[g].switch;
	                    }
	                }
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 controlled light point</b> <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug < 5) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>5 power outlets</b> <small>(actually ' +
	                        roomEnergy[k].plug + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	            if (ROOM[k].name === "Salle à manger") {
	                reportRoom +=
	                    '<div class="col-md-8"><p><i class="fa fa-info" aria-hidden="true" style="color:blue"></i> This room is linked to the <b>living room / living room</b> according to the standard.</p></div>\n';
	            }
	            if (ROOM[k].name.substr(0, 7) === "Chambre") {
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 controlled light point</b> <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug < 3) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>3 power outlets</b> <small>(actually ' +
	                        roomEnergy[k].plug + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	            if (ROOM[k].name === "SdB") {
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 light point</b> <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug < 2) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>2 power outlets</b> <small>(actually ' +
	                        roomEnergy[k].plug + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].switch === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 switch</b> <small>(actually ' +
	                        roomEnergy[k].switch + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	            if (ROOM[k].name === "Couloir") {
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 controlled light point</b> <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug < 1) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 power outlet</b> <small>(actually ' +
	                        roomEnergy[k].plug + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	            if (ROOM[k].name === "Toilette") {
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 light point</b>. <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	            if (ROOM[k].name === "Cuisine") {
	                reportRoom += '<div class="col-md-8">';
	                if (roomEnergy[k].light === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 controlled light point</b> <small>(actually ' +
	                        roomEnergy[k].light + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug < 6) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>6 power outlets</b> <small>(actually ' +
	                        roomEnergy[k].plug + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug32 === 0) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>1 32A power outlet</b> <small>(actually ' +
	                        roomEnergy[k].plug32 + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (roomEnergy[k].plug20 < 2) {
	                    reportRoom +=
	                        '<p><i class="fa fa-exclamation-triangle" style="color:orange" aria-hidden="true"></i> This room must have at least <b>2 20A power outlets</b> <small>(actually ' +
	                        roomEnergy[k].plug20 + ')</small>.</p>\n';
	                    nfc = false;
	                }
	                if (nfc) reportRoom += '<i class="fa fa-check" aria-hidden="true" style="color:green"></i>';
	                reportRoom += '</div>';
	            }
	        }
	        number++;
	        reportRoom += '</div>';
	    }

	    document.getElementById('extension-floorplanner-reportRooms').innerHTML = reportRoom;
	    document.querySelector('#extension-floorplanner-reportRooms').style.display='block'



	});

	document.getElementById('extension-floorplanner-wallWidth').addEventListener("input", function () {
	    let sliderValue = this.value;
	    binder.wall.thick = sliderValue;
	    binder.wall.type = "normal";
	    floorplanEditor.architect(WALLS);
	    let objWall = floorplanEditor.objFromWall(binder.wall); // LIST OBJ ON EDGE
	    for (let w = 0; w < objWall.length; w++) {
	        objWall[w].thick = sliderValue;
	        objWall[w].update();
	    }
	    rib();
	    document.getElementById("wallWidthVal").textContent = sliderValue;
	});

	document.getElementById("extension-floorplanner-bboxTrash").addEventListener("click", function () {
	    if(typeof binder.obj != 'undefined' && typeof binder.obj.graph != 'undefined') binder.obj.graph.remove();
	    if(typeof binder.graph != 'undefined') binder.graph.remove();
	    if(typeof binder.obj != 'undefined') OBJDATA.splice(OBJDATA.indexOf(binder.obj), 1);
	    document.querySelector('#extension-floorplanner-objBoundingBox').style.display = 'none';
	    document.querySelector('#extension-floorplanner-panel').style.display='block';
	    fonc_button('select_mode');
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Deleted object';
	    //delete binder;
			bye_binder();
	    rib();
	});

	document.getElementById("extension-floorplanner-bboxStepsAdd").addEventListener("click", function () {
	    let newValue = document.getElementById("extension-floorplanner-bboxStepsVal").textContent;
	    if (newValue < 15) {
	        newValue++;
	        binder.obj.value = newValue;
	        binder.obj.update();
	        document.getElementById("bboxStepsVal").textContent = newValue;
	    }
	});

	document.getElementById("extension-floorplanner-bboxStepsMinus").addEventListener("click", function () {
	    let newValue = document.getElementById("extension-floorplanner-bboxStepsVal").textContent;
	    if (newValue > 2) {
	        newValue--;
	        binder.obj.value = newValue;
	        binder.obj.update();
	        document.getElementById("bboxStepsVal").textContent = newValue;
	    }
	});

	document.getElementById('extension-floorplanner-bboxWidth').addEventListener("input", function () {
	    let sliderValue = this.value;
			if(typeof binder != 'undefined' && typeof binder.obj != 'undefined'){
		    let objTarget = binder.obj;
		    objTarget.size = (sliderValue / 100) * meter;
		    objTarget.update();
		    binder.size = (sliderValue / 100) * meter;
		    binder.update();
		    document.getElementById("extension-floorplanner-bboxWidthVal").textContent = sliderValue;
			}
			else{
				console.error("cannot scale object, no binder or binder.obj");
			}
	    
	});

	document.getElementById('extension-floorplanner-bboxHeight').addEventListener("input", function () {
	    let sliderValue = this.value;
	    let objTarget = binder.obj;
	    objTarget.thick = (sliderValue / 100) * meter;
	    objTarget.update();
	    binder.thick = (sliderValue / 100) * meter;
	    binder.update();
	    document.getElementById("extension-floorplanner-bboxHeightVal").textContent = sliderValue;
	});

	document.getElementById('extension-floorplanner-bboxRotation').addEventListener("input", function () {
	    let sliderValue = this.value;
	    let objTarget = binder.obj;
	    objTarget.angle = sliderValue;
	    objTarget.update();
	    binder.angle = sliderValue;
	    binder.update();
	    document.getElementById("extension-floorplanner-bboxRotationVal").textContent = sliderValue;
	});

	document.getElementById('extension-floorplanner-doorWindowWidth').addEventListener("input", function () {
	    let sliderValue = this.value;
	    let objTarget = binder.obj;
	    let wallBind = floorplanEditor.rayCastingWalls(objTarget, WALLS);
	    if (wallBind.length > 1) {
	        wallBind = wallBind[wallBind.length - 1];
	    }
	    let limits = limitObj(wallBind.equations.base, sliderValue, objTarget);
	    if (qSVG.btwn(limits[1].x, wallBind.start.x, wallBind.end.x) && qSVG.btwn(limits[1].y, wallBind.start.y, wallBind.end.y) &&
	        qSVG.btwn(limits[0].x, wallBind.start.x, wallBind.end.x) && qSVG.btwn(limits[0].y, wallBind.start.y, wallBind.end.y)) {
	        objTarget.size = sliderValue;
	        objTarget.limit = limits;
	        objTarget.update();
	        binder.size = sliderValue;
	        binder.limit = limits;
	        binder.update();
	        document.getElementById("extension-floorplanner-doorWindowWidthVal").textContent = sliderValue;
	    }
	    inWallRib(wallBind);
	});

	document.getElementById("extension-floorplanner-objToolsHinge").addEventListener("click", function () {
		console.log("hinge change. binder: ", binder);
		console.log("hinge change. binder.obj: ", binder.obj);
	    let objTarget = binder.obj;
	    let hingeStatus = objTarget.hinge; // normal - reverse
	    if (hingeStatus === 'normal') {
	        objTarget.hinge = 'reverse';
	    } else objTarget.hinge = 'normal';
	    objTarget.update();
	});



	document.getElementById('extension-floorplanner-sizePolice').addEventListener("input", function () {
	    document.getElementById('extension-floorplanner-labelBox').style.fontSize = this.value + 'px';
	});

	// CANDLE TODO onclick klopt hier niet
	document.querySelector('#extension-floorplanner-save-text').addEventListener("click",function (e) {
		console.log("saving text");
	    fonc_button('select_mode');
	    action = 0;
	    let textToMake = document.getElementById('extension-floorplanner-labelBox').textContent;
			console.log("new text: ", textToMake);
	    if (textToMake != "" && textToMake != "Your text") {
					console.log("creating text binder")
	        binder = new floorplanEditor.obj2D("free", "text", document.getElementById('extension-floorplanner-labelBox').style.color, snap, 0, 0, 0, "normal", 0, {
	            text: textToMake,
	            size: document.getElementById('extension-floorplanner-sizePolice').value
	        });
					console.log("binder with text before update: ", binder);
	        binder.update();
					console.log("binder with text after update: ", binder);
	        OBJDATA.push(binder);
	        if(typeof binder.graph != 'undefined') binder.graph.remove();
	        document.querySelector('#extension-floorplanner-boxText').append(OBJDATA[OBJDATA.length - 1].graph);
	        OBJDATA[OBJDATA.length - 1].update();
	        //delete binder;
					bye_binder();
	        document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Added text';
	        floorplanSave();
	    } else {
				console.warn("no relevant text provided");
	        document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Selection mode';
	    }
	    document.getElementById('extension-floorplanner-labelBox').textContent = "Your text";
	    document.getElementById('extension-floorplanner-labelBox').style.color = "#333333";
	    document.getElementById('extension-floorplanner-labelBox').style.fontSize = "15px";
	    document.getElementById('extension-floorplanner-sizePolice').value = 15;
	});

	if (!Array.prototype.includes) {
	    Object.defineProperty(Array.prototype, 'includes', {
	        value: function (searchElement, fromIndex) {
	            if (this === null) {
	                throw new TypeError('"this" is null or not defined');
	            }

	            let o = Object(this);
	            let len = o.length >>> 0;
	            if (len === 0) {
	                return false;
	            }
	            let n = fromIndex | 0;
	            let k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);

	            while (k < len) {
	                if (o[k] === searchElement) {
	                    return true;
	                }
	                k++;
	            }
	            return false;
	        }
	    });
	}

	function isObjectsEquals(a, b, message = false) {
	    if (message) console.log("equals message: ", message);
	    let isOK = true;
	    for (let prop in a) {
	        if (a[prop] !== b[prop]) {
	            isOK = false;
	            break;
	        }
	    }
	    return isOK;
	};

	function throttle(callback, delay) {
	    let last;
	    let timer;
	    return function () {
	        let context = this;
	        let now = +new Date();
	        let args = arguments;
	        if (last && now < last + delay) {
	            // le délai n'est pas écoulé on reset le timer
	            clearTimeout(timer);
	            timer = setTimeout(function () {
	                last = now;
	                callback.apply(context, args);
	            }, delay);
	        } else {
	            last = now;
	            callback.apply(context, args);
	        }
	    };
	}
	
	/*
	linElement.mousewheel(throttle(function (event) {
	    event.preventDefault();
	    if (event.deltaY > 0) {
	        zoom_maker('zoomin', 200);
	    } else {
	        zoom_maker('zoomout', 200);
	    }
	}, 100));
	*/
	zoom_maker('zoomout', 200);
	
	document.getElementById("extension-floorplanner-showRib").addEventListener("click", function () {
	    if (document.getElementById("extension-floorplanner-showRib").checked) {
	        document.querySelector('#extension-floorplanner-boxScale').style.display='block';
	        document.querySelector('#extension-floorplanner-boxRib').style.display='block';
					document.querySelector('#extension-floorplanner-boxArea').style.display='block';
					document.querySelector('#extension-floorplanner-areaValue').style.display='block';
	        showRib = true;
	    } else {
	        document.querySelector('#extension-floorplanner-boxScale').style.display = 'none';
	        document.querySelector('#extension-floorplanner-boxRib').style.display = 'none';
					document.querySelector('#extension-floorplanner-boxArea').style.display = 'none';
					document.querySelector('#extension-floorplanner-areaValue').style.display='none';
	        showRib = false;
	    }
	});

/*
	document.getElementById("extension-floorplanner-showArea").addEventListener("click", function () {
	    if (document.getElementById("extension-floorplanner-showArea").checked) {
	        document.querySelector('#extension-floorplanner-boxArea').style.display='block';
	    } else {
	        document.querySelector('#extension-floorplanner-boxArea').style.display = 'none';
	    }
	});
*/
	document.getElementById("extension-floorplanner-showLayerRoom").addEventListener("click", function () {
	    if (document.getElementById("extension-floorplanner-showLayerRoom").checked) {
	        document.querySelector('#extension-floorplanner-boxRoom').style.display='block';
	    } else {
	        document.querySelector('#extension-floorplanner-boxRoom').style.display = 'none';
	    }
	});

	document.getElementById("extension-floorplanner-showLayerEnergy").addEventListener("click", function () {
		console.log("toggling energy/furniture layer");
	    if (document.getElementById("extension-floorplanner-showLayerEnergy").checked) {
				console.log("showing furniture");
	      document.querySelector('#extension-floorplanner-boxEnergy').style.display='block';
					//document.querySelector('#extension-floorplanner-boxcarpentry').style.display='block';
	    } else {
			  console.log("hiding furniture");
	      document.querySelector('#extension-floorplanner-boxEnergy').style.display = 'none';
					//document.querySelector('#extension-floorplanner-boxcarpentry').style.display = 'none';
	    }
	});

	// document.getElementById("showLayerFurniture").addEventListener("click", function () {
	//   if (document.getElementById("showLayerFurniture").checked) {
	//     document.querySelector('#extension-floorplanner-boxFurniture').style.display='block';
	//   }
	//   else {
	//     document.querySelector('#extension-floorplanner-boxFurniture').style.display = 'none';
	//   }
	// });

	document.getElementById("extension-floorplanner-applySurface").addEventListener("click", function () {
	    document.querySelector('#extension-floorplanner-roomTools').style.display = 'none';
	    document.querySelector('#extension-floorplanner-panel').style.display='block';
	    //binder.remove();
	    //delete binder;
			bye_binder();
	    let id = document.querySelector('#extension-floorplanner-roomIndex').value;
		console.log("roomIndex: ", id);
	    //COLOR
	    let data = document.querySelector('#extension-floorplanner-roomBackground').value;
	    ROOM[id].color = "extension-floorplanner-" + data;
	    //ROOM NAME
	    let roomName = document.querySelector('#extension-floorplanner-roomName').value;
	    if (roomName === 'None') {
	        roomName = '';
	    }
	    ROOM[id].name = roomName;
	    //ROOM SURFACE
	    let area = document.querySelector('#extension-floorplanner-roomSurface').value;
	    ROOM[id].surface = area;
	    //SHOW SURFACE
	    let show = document.querySelector("#extension-floorplanner-seeArea").checked;
	    ROOM[id].showSurface = show;
	    //ACTION PARAM
	    let action = document.querySelector('#extension-floorplanner-tool-root input[type=radio]:checked').value;
	    ROOM[id].action = action;
	    if (action === 'sub') {
	        ROOM[id].color = 'hatch';
	    }
	    if (action != 'sub' && data === 'hatch') {
	        ROOM[id].color = 'gradientNeutral';
	    }
	    document.querySelector('#extension-floorplanner-boxRoom').replaceChildren();
	    document.querySelector('#extension-floorplanner-boxSurface').replaceChildren();
	    floorplanEditor.roomMaker(Rooms);
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Updated room';
	    fonc_button('select_mode');
	});

	document.getElementById("extension-floorplanner-resetRoomTools").addEventListener("click", function () {
	    document.querySelector('#extension-floorplanner-roomTools').style.display = 'none';
	    document.querySelector('#extension-floorplanner-panel').style.display='block';
	    //binder.remove();
	    //delete binder;
			bye_binder();
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Updated room';
	    fonc_button('select_mode');

	});

	document.getElementById("extension-floorplanner-wallTrash").addEventListener("click", function () {
	    let wall = binder.wall;
	    for (let k in WALLS) {
	        if (isObjectsEquals(WALLS[k].child, wall)) WALLS[k].child = null;
	        if (isObjectsEquals(WALLS[k].parent, wall)) {
	            WALLS[k].parent = null;
	        }
	    }
	    WALLS.splice(WALLS.indexOf(wall), 1);
	    document.querySelector('#extension-floorplanner-wallTools').style.display = 'none';
	    wall.graph.remove();
	    binder.graph.remove();
	    floorplanEditor.architect(WALLS);
	    rib();
	    mode = "select_mode";
	    document.querySelector('#extension-floorplanner-panel').style.display='block';
	});

	let textEditorColorBtn = document.querySelectorAll('.extension-floorplanner-textEditorColor');
	for (let k = 0; k < textEditorColorBtn.length; k++) {
	    textEditorColorBtn[k].addEventListener('click', function () {
	        document.getElementById('extension-floorplanner-labelBox').style.color = this.style.color;
	    });
	}

	let zoomBtn = document.querySelectorAll('.extension-floorplanner-zoom');
	console.log("zoomBtn: ", zoomBtn);
	for (let k = 0; k < zoomBtn.length; k++) {
	    zoomBtn[k].addEventListener("click", function () {
	        let lens = this.getAttribute('data-zoom');
	        zoom_maker(lens, 200, 50);
	    })
	}

	let roomColorBtn = document.querySelectorAll(".extension-floorplanner-roomColor");
	for (let k = 0; k < roomColorBtn.length; k++) {
	    roomColorBtn[k].addEventListener("click", function (event) {
			
	        let data = event.target.getAttribute('data-type');
			console.log("clicked on roomcolor button. data: ", data);
			console.log("--document.querySelector('#extension-floorplanner-roomBackground'): ", document.querySelector('#extension-floorplanner-roomBackground'));
			console.log("--BINDER: ", binder);
	        document.querySelector('#extension-floorplanner-roomBackground').value = data;
	        binder.setAttribute('fill', 'url(#extension-floorplanner-' + data + ')');
	    });
	}

	let objTrashBtn = document.querySelectorAll(".extension-floorplanner-objTrash");
	for (let k = 0; k < objTrashBtn.length; k++) {
	    objTrashBtn[k].addEventListener("click", function () {
	        document.querySelector('#extension-floorplanner-objTools').style.display = 'none';
	        let obj = binder.obj;
	        obj.graph.remove();
	        OBJDATA.splice(OBJDATA.indexOf(obj), 1);
	        fonc_button('select_mode');
	        document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Selection mode';
	        document.querySelector('#extension-floorplanner-panel').style.display = 'block';
	        if(typeof binder.graph != 'undefined') binder.graph.remove();
	        //delete binder;
					bye_binder();
	        rib();
	        document.querySelector('#extension-floorplanner-panel').style.display = 'block';
	    });
	}

	let dropdownMenu = document.querySelectorAll(".extension-floorplanner-dropdown-menu li a");
	for (let k = 0; k < dropdownMenu.length; k++) {
	    dropdownMenu[k].addEventListener("click", function () {
	        let selText = this.textContent;
			// TODO: is parents van jquery?
	        document.querySelector(this).closest('.extension-floorplanner-btn-group').querySelector('.extension-floorplanner-dropdown-toggle').innerHTML = selText + ' <span class="caret"></span>';
	        if (selText != 'None') document.querySelector('#extension-floorplanner-roomName').value = selText;
	        else document.querySelector('#extension-floorplanner-roomName').value = '';
	    });
	}

	// TRY MATRIX CALC FOR BBOX REAL COORDS WITH TRAS + ROT.
	function matrixCalc(el, message = false) {
	    if (message) console.log("matrixCalc called by -> ", message);
	    let m = el.getCTM();
	    let bb = el.getBBox();
	    let tpts = [
	        matrixXY(m, bb.x, bb.y),
	        matrixXY(m, bb.x + bb.width, bb.y),
	        matrixXY(m, bb.x + bb.width, bb.y + bb.height),
	        matrixXY(m, bb.x, bb.y + bb.height)];
	    return tpts;
	}

	function matrixXY(m, x, y) {
	    return { x: x * m.a + y * m.c + m.e, y: x * m.b + y * m.d + m.f };
	}

	function realBboxShow(coords) {
	    for (let k in coords) {
	        debugPoint(coords[k]);
	    }
	}


	function limitObj(equation, size, coords, message = false) {
	    if (message) {
	        console.log("limitObj: message: ", message);
	    }
	    let Px = coords.x;
	    let Py = coords.y;
	    let Aq = equation.A;
	    let Bq = equation.B;
	    let pos1, pos2;
	    if (Aq === 'v') {
	        pos1 = { x: Px, y: Py - size / 2 };
	        pos2 = { x: Px, y: Py + size / 2 };
	    } else if (Aq === 'h') {
	        pos1 = { x: Px - size / 2, y: Py };
	        pos2 = { x: Px + size / 2, y: Py };
	    } else {
	        let A = 1 + Aq * Aq;
	        let B = (-2 * Px) + (2 * Aq * Bq) + (-2 * Py * Aq);
	        let C = (Px * Px) + (Bq * Bq) - (2 * Py * Bq) + (Py * Py) - (size * size) / 4; // -N
	        let Delta = (B * B) - (4 * A * C);
	        let posX1 = (-B - (Math.sqrt(Delta))) / (2 * A);
	        let posX2 = (-B + (Math.sqrt(Delta))) / (2 * A);
	        pos1 = { x: posX1, y: (Aq * posX1) + Bq };
	        pos2 = { x: posX2, y: (Aq * posX2) + Bq };
	    }
	    return [pos1, pos2];
	}

	function zoom_maker(lens, xmove, xview) {
		console.log("in zoom_maker.  lens, xmove, xview: ", lens, xmove, xview);
	    if (lens === 'zoomout' && zoom > 1 && zoom < 17) {
	        zoom--;
	        width_viewbox += xmove;
	        let ratioWidthZoom = taille_w / width_viewbox;
	        height_viewbox = width_viewbox * ratio_viewbox;
	        myDiv = document.getElementById("extension-floorplanner-scaleVal");
	        myDiv.style.width = 60 * ratioWidthZoom + 'px';
	        originX_viewbox = originX_viewbox - (xmove / 2);
	        originY_viewbox = originY_viewbox - (xmove / 2 * ratio_viewbox);
	    }
	    if (lens === 'zoomin' && zoom < 14 && zoom > 0) {
	        zoom++;
	        let oldWidth = width_viewbox;
	        width_viewbox -= xmove;
	        let ratioWidthZoom = taille_w / width_viewbox;
	        height_viewbox = width_viewbox * ratio_viewbox;
	        myDiv = document.getElementById("extension-floorplanner-scaleVal");
	        myDiv.style.width = 60 * ratioWidthZoom + 'px';

	        originX_viewbox = originX_viewbox + (xmove / 2);
	        originY_viewbox = originY_viewbox + (xmove / 2 * ratio_viewbox);
	    }
	    factor = width_viewbox / taille_w;
	    if (lens === 'zoomreset') {
	        originX_viewbox = 0;
	        originY_viewbox = 0;
	        width_viewbox = taille_w;
	        height_viewbox = taille_h;
	        factor = 1;
	    }
	    if (lens === 'zoomright') {
	        originX_viewbox += xview;
	    }
	    if (lens === 'zoomleft') {
	        originX_viewbox -= xview;
	    }
	    if (lens === 'zoomtop') {
	        originY_viewbox -= xview;
	    }
	    if (lens === 'zoombottom') {
	        originY_viewbox += xview;
	    }
	    if (lens === 'zoomdrag') {
	        originX_viewbox -= xmove;
	        originY_viewbox -= xview;
	    }
	    document.querySelectorAll('#extension-floorplanner-tool-root svg').forEach(function (element) {
			  //console.error("!!! SETTING VIEWBOX 2: ", originX_viewbox, originY_viewbox, width_viewbox,height_viewbox);
	      element.setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox);
	    });
	}

	tactile = false;

	function calcul_snap(event, state) {
	    if (event.touches) {
	        let touches = event.changedTouches;
	        console.log("calcul_snap touches");
	        eX = touches[0].pageX;
	        eY = touches[0].pageY;
	        tactile = true;
	    } else {
	        eX = event.pageX;
	        eY = event.pageY;
	    }
	    x_mouse = (eX * factor) - (offset.left * factor) + originX_viewbox;
	    y_mouse = (eY * factor) - (offset.top * factor) + originY_viewbox;

	    if (state === 'on') {
	        x_grid = Math.round(x_mouse / grid) * grid;
	        y_grid = Math.round(y_mouse / grid) * grid;
	    }
	    if (state === 'off') {
	        x_grid = x_mouse;
	        y_grid = y_mouse;
	    }
	    return {
	        x: x_grid,
	        y: y_grid,
	        xMouse: x_mouse,
	        yMouse: y_mouse
	    };
	}

	minMoveGrid = function (mouse) {
	    return Math.abs(Math.abs(pox - mouse.x) + Math.abs(poy - mouse.y));
	}

	function intersectionOff() {
	    if (typeof (lineIntersectionP) != 'undefined') {
	        lineIntersectionP.remove();
	        //delete lineIntersectionP;
	    }
	}

	function intersection(snap, range = Infinity, except = ['']) {
	    // ORANGE LINES 90° NEAR SEGMENT
	    let bestEqPoint = {};
	    let equation = {};

	    bestEqPoint.distance = range;

	    if (typeof (lineIntersectionP) != 'undefined') {
	        lineIntersectionP.remove();
	        //delete lineIntersectionP;
	    }

	    lineIntersectionP = qSVG.create("boxbind", "path", { // ORANGE TEMP LINE FOR ANGLE 0 90 45 -+
	        d: "",
	        "stroke": "transparent",
	        "stroke-width": 0.5,
	        "stroke-opacity": "1",
	        fill: "none"
	    });

	    for (index = 0; index < WALLS.length; index++) {
	        if (except.indexOf(WALLS[index]) === -1) {
	            let x1 = WALLS[index].start.x;
	            let y1 = WALLS[index].start.y;
	            let x2 = WALLS[index].end.x;
	            let y2 = WALLS[index].end.y;

	            // EQUATION 90° of segment nf/nf-1 at X2/Y2 Point
	            if (Math.abs(y2 - y1) === 0) {
	                equation.C = 'v'; // C/D equation 90° Coef = -1/E
	                equation.D = x1;
	                equation.E = 'h'; // E/F equation Segment
	                equation.F = y1;
	                equation.G = 'v'; // G/H equation 90° Coef = -1/E
	                equation.H = x2;
	                equation.I = 'h'; // I/J equation Segment
	                equation.J = y2;
	            } else if (Math.abs(x2 - x1) === 0) {
	                equation.C = 'h'; // C/D equation 90° Coef = -1/E
	                equation.D = y1;
	                equation.E = 'v'; // E/F equation Segment
	                equation.F = x1;
	                equation.G = 'h'; // G/H equation 90° Coef = -1/E
	                equation.H = y2;
	                equation.I = 'v'; // I/J equation Segment
	                equation.J = x2;
	            } else {
	                equation.C = (x1 - x2) / (y2 - y1);
	                equation.D = y1 - (x1 * equation.C);
	                equation.E = (y2 - y1) / (x2 - x1);
	                equation.F = y1 - (x1 * equation.E);
	                equation.G = (x1 - x2) / (y2 - y1);
	                equation.H = y2 - (x2 * equation.C);
	                equation.I = (y2 - y1) / (x2 - x1);
	                equation.J = y2 - (x2 * equation.E);
	            }
	            equation.A = equation.C;
	            equation.B = equation.D;
	            eq = qSVG.nearPointOnEquation(equation, snap);
	            if (eq.distance < bestEqPoint.distance) {
	                setBestEqPoint(bestEqPoint, eq.distance, index, eq.x, eq.y, x1, y1, x2, y2, 1);
	            }
	            equation.A = equation.E;
	            equation.B = equation.F;
	            eq = qSVG.nearPointOnEquation(equation, snap);
	            if (eq.distance < bestEqPoint.distance) {
	                setBestEqPoint(bestEqPoint, eq.distance, index, eq.x, eq.y, x1, y1, x2, y2, 1);
	            }
	            equation.A = equation.G;
	            equation.B = equation.H;
	            eq = qSVG.nearPointOnEquation(equation, snap);
	            if (eq.distance < bestEqPoint.distance) {
	                setBestEqPoint(bestEqPoint, eq.distance, index, eq.x, eq.y, x1, y1, x2, y2, 2);
	            }
	            equation.A = equation.I;
	            equation.B = equation.J;
	            eq = qSVG.nearPointOnEquation(equation, snap);
	            if (eq.distance < bestEqPoint.distance) {
	                setBestEqPoint(bestEqPoint, eq.distance, index, eq.x, eq.y, x1, y1, x2, y2, 2);
	            }
	        } // END INDEXOF EXCEPT TEST
	    } // END LOOP FOR

	    if (bestEqPoint.distance < range) {
	        if (bestEqPoint.way === 2) {
				lineIntersectionP.setAttribute("d","M" + bestEqPoint.x1 + "," + bestEqPoint.y1 + " L" + bestEqPoint.x2 + "," + bestEqPoint.y2 + " L" + bestEqPoint.x + "," + bestEqPoint.y);
	            lineIntersectionP.setAttribute("stroke","#d7ac57");
	        } else {
				// ORANGE TEMP LINE FOR ANGLE 0 90 45 -+
				lineIntersectionP.setAttribute("d","M" + bestEqPoint.x2 + "," + bestEqPoint.y2 + " L" + bestEqPoint.x1 + "," + bestEqPoint.y1 + " L" + bestEqPoint.x + "," + bestEqPoint.y);
	            lineIntersectionP.setAttribute("stroke","#d7ac57");
	        }
	        return ({
	            x: bestEqPoint.x,
	            y: bestEqPoint.y,
	            wall: WALLS[bestEqPoint.node],
	            distance: bestEqPoint.distance
	        });
	    } else {
	        return false;
	    }
	}

	function debugPoint(point, name, color = "#00ff00") {
		console.warn("in debugPoint. point, name, color: ", point, name, color);
	    qSVG.create('boxDebug', 'circle', {
	        cx: point.x,
	        cy: point.y,
	        r: 7,
	        fill: color,
	        id: name,
	        class: "extension-floorplanner-visu"
	    });
	}

	function showVertex() {
	    for (let i = 0; i < vertex.length; i++) {
	        debugPoint(vertex[i], i);

	    }
	}

	function showJunction() {
	    for (let i = 0; i < junction.length; i++) {
	        debugPoint({ x: junction[i].values[0], y: junction[i].values[1] }, i);

	    }
	}

	

	function hideAllSize() {
	    document.querySelector('#extension-floorplanner-boxbind').replaceChildren(); //.innerHTML = '';
	    sizeText = [];
	    showAllSizeStatus = 0;
	}

	function allRib() {
	    document.querySelector('#extension-floorplanner-boxRib').replaceChildren(); //.innerHTML = '';
	    for (let i in WALLS) {
	        inWallRib(WALLS[i], 'all');
	    }
	}

	function inWallRib(wall, option = false) {
	    if (!option) document.querySelector('#extension-floorplanner-boxRib').replaceChildren(); //.innerHTML = '';
	    ribMaster = [];
	    ribMaster.push([]);
	    ribMaster.push([]);
	    let inter;
	    let distance;
	    let cross;
	    let angleTextValue = wall.angle * (180 / Math.PI);
	    let objWall = floorplanEditor.objFromWall(wall); // LIST OBJ ON EDGE
	    if (objWall.length == 0) return
	    ribMaster[0].push({ wall: wall, crossObj: false, side: 'up', coords: wall.coords[0], distance: 0 });
	    ribMaster[1].push({ wall: wall, crossObj: false, side: 'down', coords: wall.coords[1], distance: 0 });
	    let objTarget = null
	    for (let ob in objWall) {
	        objTarget = objWall[ob];
	        objTarget.up = [
	            qSVG.nearPointOnEquation(wall.equations.up, objTarget.limit[0]),
	            qSVG.nearPointOnEquation(wall.equations.up, objTarget.limit[1])
	        ];
	        objTarget.down = [
	            qSVG.nearPointOnEquation(wall.equations.down, objTarget.limit[0]),
	            qSVG.nearPointOnEquation(wall.equations.down, objTarget.limit[1])
	        ];

	        distance = qSVG.measure(wall.coords[0], objTarget.up[0]) / meter;
	        ribMaster[0].push({
	            wall: objTarget,
	            crossObj: ob,
	            side: 'up',
	            coords: objTarget.up[0],
	            distance: distance.toFixed(2)
	        });
	        distance = qSVG.measure(wall.coords[0], objTarget.up[1]) / meter;
	        ribMaster[0].push({
	            wall: objTarget,
	            crossObj: ob,
	            side: 'up',
	            coords: objTarget.up[1],
	            distance: distance.toFixed(2)
	        });
	        distance = qSVG.measure(wall.coords[1], objTarget.down[0]) / meter;
	        ribMaster[1].push({
	            wall: objTarget,
	            crossObj: ob,
	            side: 'down',
	            coords: objTarget.down[0],
	            distance: distance.toFixed(2)
	        });
	        distance = qSVG.measure(wall.coords[1], objTarget.down[1]) / meter;
	        ribMaster[1].push({
	            wall: objTarget,
	            crossObj: ob,
	            side: 'down',
	            coords: objTarget.down[1],
	            distance: distance.toFixed(2)
	        });
	    }
	    distance = qSVG.measure(wall.coords[0], wall.coords[3]) / meter;
	    ribMaster[0].push({ wall: objTarget, crossObj: false, side: 'up', coords: wall.coords[3], distance: distance });
	    distance = qSVG.measure(wall.coords[1], wall.coords[2]) / meter;
	    ribMaster[1].push({ wall: objTarget, crossObj: false, side: 'down', coords: wall.coords[2], distance: distance });
	    ribMaster[0].sort(function (a, b) {
	        return (a.distance - b.distance).toFixed(2);
	    });
	    ribMaster[1].sort(function (a, b) {
	        return (a.distance - b.distance).toFixed(2);
	    });
	    for (let t in ribMaster) {
	        for (let n = 1; n < ribMaster[t].length; n++) {
	            let found = true;
	            let shift = -5;
	            let valueText = Math.abs(ribMaster[t][n - 1].distance - ribMaster[t][n].distance);
	            let angleText = angleTextValue;
	            if (found) {
	                if (ribMaster[t][n - 1].side === 'down') {
	                    shift = -shift + 10;
	                }
	                if (angleText > 89 || angleText < -89) {
	                    angleText -= 180;
	                    if (ribMaster[t][n - 1].side === 'down') {
	                        shift = -5;
	                    } else shift = -shift + 10;
	                }


	                sizeText[n] = document.createElementNS('http://www.w3.org/2000/svg', 'text');
	                let startText = qSVG.middle(ribMaster[t][n - 1].coords.x, ribMaster[t][n - 1].coords.y, ribMaster[t][n].coords.x,
	                    ribMaster[t][n].coords.y);
	                sizeText[n].setAttributeNS(null, 'x', startText.x);
	                sizeText[n].setAttributeNS(null, 'y', (startText.y) + shift);
	                sizeText[n].setAttributeNS(null, 'text-anchor', 'middle');
	                sizeText[n].setAttributeNS(null, 'font-family', 'roboto');
	                sizeText[n].setAttributeNS(null, 'stroke', '#ffffff');
	                sizeText[n].textContent = valueText.toFixed(2);
	                if (sizeText[n].textContent < 1) {
	                    sizeText[n].setAttributeNS(null, 'font-size', '0.8em');
	                    sizeText[n].textContent = sizeText[n].textContent.substring(1, sizeText[n].textContent.length);
	                } else sizeText[n].setAttributeNS(null, 'font-size', '1em');
	                sizeText[n].setAttributeNS(null, 'stroke-width', '0.27px');
	                sizeText[n].setAttributeNS(null, 'fill', '#666666');
	                sizeText[n].setAttribute("transform", "rotate(" + angleText + " " + startText.x + "," + (startText.y) + ")");

	                document.querySelector('#extension-floorplanner-boxRib').append(sizeText[n]);
	            }
	        }
	    }
	}

	function rib(shift = 5) {
	    // return false;
	    let ribMaster = [];
	    ribMaster.push([]);
	    ribMaster.push([]);
	    let inter;
	    let distance;
	    let cross;
	    for (let i in WALLS) {
	        if (WALLS[i].equations.base) {
	            ribMaster[0].push([]);
	            pushToRibMaster(ribMaster, 0, i, i, i, 'up', WALLS[i].coords[0], 0);
	            ribMaster[1].push([]);
	            pushToRibMaster(ribMaster, 1, i, i, i, 'down', WALLS[i].coords[1], 0);

	            for (let p in WALLS) {
	                if (i != p && WALLS[p].equations.base) {
	                    cross = qSVG.intersectionOfEquations(WALLS[i].equations.base, WALLS[p].equations.base, "object");
	                    if (qSVG.btwn(cross.x, WALLS[i].start.x, WALLS[i].end.x, 'round') &&
	                        qSVG.btwn(cross.y, WALLS[i].start.y, WALLS[i].end.y, 'round')) {

	                        inter = qSVG.intersectionOfEquations(WALLS[i].equations.up, WALLS[p].equations.up, "object");
	                        if (qSVG.btwn(inter.x, WALLS[i].coords[0].x, WALLS[i].coords[3].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[i].coords[0].y, WALLS[i].coords[3].y, 'round') &&
	                            qSVG.btwn(inter.x, WALLS[p].coords[0].x, WALLS[p].coords[3].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[p].coords[0].y, WALLS[p].coords[3].y, 'round')) {
	                            distance = qSVG.measure(WALLS[i].coords[0], inter) / meter;
	                            pushToRibMaster(ribMaster, 0, i, i, p, 'up', inter, distance.toFixed(2));

	                        }

	                        inter = qSVG.intersectionOfEquations(WALLS[i].equations.up, WALLS[p].equations.down, "object");
	                        if (qSVG.btwn(inter.x, WALLS[i].coords[0].x, WALLS[i].coords[3].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[i].coords[0].y, WALLS[i].coords[3].y, 'round') &&
	                            qSVG.btwn(inter.x, WALLS[p].coords[1].x, WALLS[p].coords[2].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[p].coords[1].y, WALLS[p].coords[2].y, 'round')) {
	                            distance = qSVG.measure(WALLS[i].coords[0], inter) / meter;
	                            pushToRibMaster(ribMaster, 0, i, i, p, 'up', inter, distance.toFixed(2));

	                        }

	                        inter = qSVG.intersectionOfEquations(WALLS[i].equations.down, WALLS[p].equations.up, "object");
	                        if (qSVG.btwn(inter.x, WALLS[i].coords[1].x, WALLS[i].coords[2].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[i].coords[1].y, WALLS[i].coords[2].y, 'round') &&
	                            qSVG.btwn(inter.x, WALLS[p].coords[0].x, WALLS[p].coords[3].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[p].coords[0].y, WALLS[p].coords[3].y, 'round')) {
	                            distance = qSVG.measure(WALLS[i].coords[1], inter) / meter;
	                            pushToRibMaster(ribMaster, 1, i, i, p, 'down', inter, distance.toFixed(2));

	                        }

	                        inter = qSVG.intersectionOfEquations(WALLS[i].equations.down, WALLS[p].equations.down, "object");
	                        if (qSVG.btwn(inter.x, WALLS[i].coords[1].x, WALLS[i].coords[2].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[i].coords[1].y, WALLS[i].coords[2].y, 'round') &&
	                            qSVG.btwn(inter.x, WALLS[p].coords[1].x, WALLS[p].coords[2].x, 'round') &&
	                            qSVG.btwn(inter.y, WALLS[p].coords[1].y, WALLS[p].coords[2].y, 'round')) {
	                            distance = qSVG.measure(WALLS[i].coords[1], inter) / meter;
	                            pushToRibMaster(ribMaster, 1, i, i, p, 'down', inter, distance.toFixed(2));

	                        }
	                    }
	                }
	            }
	            distance = qSVG.measure(WALLS[i].coords[0], WALLS[i].coords[3]) / meter;
	            pushToRibMaster(ribMaster, 0, i, i, i, 'up', WALLS[i].coords[3], distance.toFixed(2));

	            distance = qSVG.measure(WALLS[i].coords[1], WALLS[i].coords[2]) / meter;
	            pushToRibMaster(ribMaster, 1, i, i, i, 'down', WALLS[i].coords[2], distance.toFixed(2));
	        }
	    }

	    for (let a in ribMaster[0]) {
	        ribMaster[0][a].sort(function (a, b) {
	            return (a.distance - b.distance).toFixed(2);
	        });
	    }
	    for (let a in ribMaster[1]) {
	        ribMaster[1][a].sort(function (a, b) {
	            return (a.distance - b.distance).toFixed(2);
	        });
	    }

	    let sizeText = [];
	    if (shift === 5) document.querySelector('#extension-floorplanner-boxRib').replaceChildren(); //.innerHTML = '';
	    for (let t in ribMaster) {
	        for (let a in ribMaster[t]) {
	            for (let n = 1; n < ribMaster[t][a].length; n++) {
	                if (ribMaster[t][a][n - 1].wallIndex === ribMaster[t][a][n].wallIndex) {
	                    let edge = ribMaster[t][a][n].wallIndex;
	                    let found = true;
	                    let valueText = Math.abs(ribMaster[t][a][n - 1].distance - ribMaster[t][a][n].distance);
	                    // CLEAR TOO LITTLE VALUE
	                    if (valueText < 0.15) {
	                        found = false;
	                    }
	                    // CLEAR (thick) BETWEEN CROSS EDGE
	                    if (found && ribMaster[t][a][n - 1].crossEdge === ribMaster[t][a][n].crossEdge && ribMaster[t][a][n].crossEdge !=
	                        ribMaster[t][a][n].wallIndex) {
	                        found = false;
	                    }
	                    // CLEAR START INTO EDGE
	                    if (found && ribMaster[t][a].length > 2 && n === 1) {
	                        let polygon = [];
	                        for (let pp = 0; pp < 4; pp++) {
	                            polygon.push({
	                                x: WALLS[ribMaster[t][a][n].crossEdge].coords[pp].x,
	                                y: WALLS[ribMaster[t][a][n].crossEdge].coords[pp].y
	                            }); // FOR Z
	                        }
	                        if (qSVG.rayCasting(ribMaster[t][a][0].coords, polygon)) {
	                            found = false;
	                        }
	                    }
	                    // CLEAR END INTO EDGE
	                    if (found && ribMaster[t][a].length > 2 && n === ribMaster[t][a].length - 1) {
	                        let polygon = [];
	                        for (let pp = 0; pp < 4; pp++) {
	                            polygon.push({
	                                x: WALLS[ribMaster[t][a][n - 1].crossEdge].coords[pp].x,
	                                y: WALLS[ribMaster[t][a][n - 1].crossEdge].coords[pp].y
	                            }); // FOR Z
	                        }
	                        if (qSVG.rayCasting(ribMaster[t][a][ribMaster[t][a].length - 1].coords, polygon)) {
	                            found = false;
	                        }
	                    }

	                    if (found) {
	                        let angleText = WALLS[ribMaster[t][a][n].wallIndex].angle * (180 / Math.PI);
	                        let shiftValue = -shift;
	                        if (ribMaster[t][a][n - 1].side === 'down') {
	                            shiftValue = -shiftValue + 10;
	                        }
	                        if (angleText > 90 || angleText < -89) {
	                            angleText -= 180;
	                            if (ribMaster[t][a][n - 1].side === 'down') {
	                                shiftValue = -shift;
	                            } else shiftValue = -shiftValue + 10;
	                        }
	                        sizeText[n] = document.createElementNS('http://www.w3.org/2000/svg', 'text');
	                        let startText = qSVG.middle(ribMaster[t][a][n - 1].coords.x, ribMaster[t][a][n - 1].coords.y, ribMaster[t][a][n].coords.x,
	                            ribMaster[t][a][n].coords.y);
	                        sizeText[n].setAttributeNS(null, 'x', startText.x);
	                        sizeText[n].setAttributeNS(null, 'y', (startText.y) + (shiftValue));
	                        sizeText[n].setAttributeNS(null, 'text-anchor', 'middle');
	                        sizeText[n].setAttributeNS(null, 'font-family', 'roboto');
	                        sizeText[n].setAttributeNS(null, 'stroke', '#ffffff');
	                        sizeText[n].textContent = valueText.toFixed(2);
	                        if (sizeText[n].textContent < 1) {
	                            sizeText[n].setAttributeNS(null, 'font-size', '0.73em');
	                            sizeText[n].textContent = sizeText[n].textContent.substring(1, sizeText[n].textContent.length);
	                        } else sizeText[n].setAttributeNS(null, 'font-size', '0.9em');
	                        sizeText[n].setAttributeNS(null, 'stroke-width', '0.2px');
	                        sizeText[n].setAttributeNS(null, 'fill', '#555555');
	                        sizeText[n].setAttribute("transform", "rotate(" + angleText + " " + startText.x + "," + (startText.y) + ")");

	                        document.querySelector('#extension-floorplanner-boxRib').append(sizeText[n]);
	                    }
	                }
	            }
	        }
	    }
	}

	function cursor(tool) {
	    if (tool === 'grab') tool =
	        "url('https://wiki.openmrs.org/s/en_GB/7502/b9217199c27dd617c8d51f6186067d7767c5001b/_/images/icons/emoticons/add.png') 8 8, auto";
	    if (tool === 'scissor') tool = "url('https://maxcdn.icons8.com/windows10/PNG/64/Hands/hand_scissors-64.png'), auto";
	    if (tool === 'trash') tool = "url('https://cdn4.iconfinder.com/data/icons/common-toolbar/36/Cancel-32.png'), auto";
	    if (tool === 'validation') tool = "url('https://images.fatguymedia.com/wp-content/uploads/2015/09/check.png'), auto";
	    linElement.style.cursor = tool;
	}

	function fullscreen() {
	    // go full-screen
	    let i = document.body;
	    if (i.requestFullscreen) {
	        i.requestFullscreen();
	    } else if (i.webkitRequestFullscreen) {
	        i.webkitRequestFullscreen();
	    } else if (i.mozRequestFullScreen) {
	        i.mozRequestFullScreen();
	    } else if (i.msRequestFullscreen) {
	        i.msRequestFullscreen();
	    }
	}

	function outFullscreen() {
	    if (document.exitFullscreen) {
	        document.exitFullscreen();
	    } else if (document.mozCancelFullScreen) {
	        document.mozCancelFullScreen();
	    } else if (document.webkitExitFullscreen) {
	        document.webkitExitFullscreen();
	    }
	}

	document.addEventListener("fullscreenchange", function () {
	    if (
	        !document.fullscreenElement &&
	        !document.webkitFullscreenElement &&
	        !document.mozFullScreenElement &&
	        !document.msFullscreenElement) {
	        document.querySelector('#extension-floorplanner-nofull_mode').display = 'none';
	        document.querySelector('#extension-floorplanner-full_mode').style.display='block';
	    }
	});

	function raz_button() {
		if(document.querySelector('#extension-floorplanner-rect_mode')){
		    document.querySelector('#extension-floorplanner-rect_mode').classList.remove('extension-floorplanner-btn-success');
		    document.querySelector('#extension-floorplanner-rect_mode').classList.add('extension-floorplanner-btn-default');
		}
	    document.querySelector('#extension-floorplanner-select_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-select_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-line_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-line_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-partition_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-partition_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-door_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-door_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-node_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-node_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-text_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-text_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-room_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-room_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-distance_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-distance_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-object_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-object_mode').classList.add('extension-floorplanner-btn-default');
	    document.querySelector('#extension-floorplanner-stair_mode').classList.remove('extension-floorplanner-btn-success');
	    document.querySelector('#extension-floorplanner-stair_mode').classList.add('extension-floorplanner-btn-default');
	}

	function fonc_button(modesetting, option) {
		console.error("in fonc_button.  modesetting, option: ", modesetting, option);
		//if(modesetting == 'door_mode'){
		//	binder.remove();
		//}
	    floorplanSave();

	    hide_submenus();
	    raz_button();
	    if (option != 'simpleStair') {
	        document.querySelector('#extension-floorplanner-' + modesetting).classList.remove('extension-floorplanner-btn-default');
	        document.querySelector('#extension-floorplanner-' + modesetting).classList.add('extension-floorplanner-btn-success');
	    }
	    mode = modesetting;
	    modeOption = option;

	    if (typeof (lineIntersectionP) != 'undefined') {
	        lineIntersectionP.remove();
	        //delete lineIntersectionP;
	    }
	}


	document.querySelector('#extension-floorplanner-distance_mode').addEventListener('click',function () {
	    linElement.style.cursor = 'crosshair';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add a measurement';
	    fonc_button('distance_mode');
	});

	document.querySelector('#extension-floorplanner-room_mode').addEventListener('click',function () {
	    linElement.style.cursor = 'pointer';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Select a room';
	    fonc_button('room_mode');
	});

	document.querySelector('#extension-floorplanner-select_mode').addEventListener('click',function () {
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Select';
	    if (typeof (binder) != 'undefined') {
	        //binder.remove();
	        //delete binder;
					bye_binder();
	    }

	    fonc_button('select_mode');
	});

	document.querySelector('#extension-floorplanner-line_mode').addEventListener('click',function () {
		console.log("floorplanner: clicked on wall button");
	    linElement.style.cursor = 'crosshair';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Create walls';
	    multi = 0;
	    action = 0;
	    // snap = calcul_snap(event, grid_snap);
	    //
	    // pox = snap.x;
	    // poy = snap.y;
	    fonc_button('line_mode');
	});

	document.querySelector('#extension-floorplanner-partition_mode').addEventListener('click',function () {
	    linElement.style.cursor = 'crosshair';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Creation of thin wall(s)';
	    multi = 0;
	    fonc_button('partition_mode');
	});

	if(document.querySelector('#extension-floorplanner-rect_mode')){
		document.querySelector('#extension-floorplanner-rect_mode').addEventListener('click',function () {
		    linElement.style.cursor = 'crosshair';
		    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Room(s) creation';
		    fonc_button('rect_mode');
		});
	}
	

	document.querySelectorAll('.extension-floorplanner-door').forEach(function (element) {
		element.addEventListener('click',function () {
	    	linElement.style.cursor = 'crosshair';
	    	document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add a door';
	    	document.querySelector('#extension-floorplanner-door_list').style.display = 'none';
	    	fonc_button('door_mode', element.getAttribute('data-type'));
		});
	});

	document.querySelectorAll('.extension-floorplanner-window').forEach(function (element) {
		element.addEventListener('click',function () {
	    linElement.style.cursor = 'crosshair';
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add a window';
	    document.querySelector('#extension-floorplanner-door_list').style.display = 'none';
	    document.querySelector('#extension-floorplanner-window_list').style.display = 'none';
	    fonc_button('door_mode', element.id.replace('extension-floorplanner-',''));
		});
	});

	document.querySelectorAll('.extension-floorplanner-object').forEach(function (element) {
		element.addEventListener('click',function () {
	    cursor('move');
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add an object';
	    fonc_button('object_mode', element.id.replace('extension-floorplanner-',''));
	        //element.setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox);
		});
	});
/*
	document.querySelectorAll('.extension-floorplanner-object').forEach(function (element) {
	    cursor('move');
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add an object';
	    fonc_button('object_mode', element.id.replace('extension-floorplanner-',''));
	        //element.setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox);
		//});
	});
*/
	document.querySelector('#extension-floorplanner-stair_mode').addEventListener('click',function () {
	    cursor('move');
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add stair';
	    fonc_button('object_mode', 'simpleStair');
	});

	document.querySelector('#extension-floorplanner-node_mode').addEventListener('click',function () {
	    document.querySelector('#extension-floorplanner-boxinfo')
		.innerHTML = 'Add a joint to a wall<br/><span style=\"font-size:0.7em\">Note: this may delete rooms or doors already on that wall.</span>';
	    fonc_button('node_mode');
	});

	document.querySelector('#extension-floorplanner-text_mode').addEventListener('click',function () {
	    document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Add text<br/><span style=\"font-size:0.7em\">Place the cursor to the desired location, then type your text.</span>';
	    fonc_button('text_mode');
	});

	if(document.querySelector('#extension-floorplanner-grid_mode')){
		document.querySelector('#extension-floorplanner-grid_mode').addEventListener('click',function () {
		    if (grid_snap === 'on') {
		        grid_snap = 'off';
		        document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Help grid off';
		        document.querySelector('#extension-floorplanner-grid_mode').classList.remove('extension-floorplanner-btn-success');
		        document.querySelector('#extension-floorplanner-grid_mode').classList.add('btn-warning');
		        document.querySelector('#extension-floorplanner-grid_mode').innerHTML = 'GRID OFF';
		        document.querySelector('#extension-floorplanner-boxgrid').style.opacity='0.5';
		    } else {
		        grid_snap = 'on';
		        document.querySelector('#extension-floorplanner-boxinfo').innerHTML = 'Help grid on';
		        document.querySelector('#extension-floorplanner-grid_mode').classList.remove('btn-warning');
		        document.querySelector('#extension-floorplanner-grid_mode').classList.add('extension-floorplanner-btn-success');
		        document.querySelector('#extension-floorplanner-grid_mode').innerHTML = 'GRID ON';
		        document.querySelector('#extension-floorplanner-boxgrid').style.opacity='1';
		    }
		});
	}
	

	//  RETURN PATH(s) ARRAY FOR OBJECT + PROPERTY params => bindBox (false = open sideTool), move, resize, rotate
	function carpentryCalc(classObj, typeObj, sizeObj, thickObj, dividerObj = 10) {
		  console.log("in carpentryCalc.  classObj, typeObj, sizeObj, thickObj, dividerObj: ", classObj, typeObj, sizeObj, thickObj, dividerObj);
	    let construc = [];
	    construc.params = {};
	    construc.params.bindBox = false;
	    construc.params.move = false;
	    construc.params.resize = false;
	    construc.params.resizeLimit = {};
	    construc.params.resizeLimit.width = { min: false, max: false };
	    construc.params.resizeLimit.height = { min: false, max: false };
	    construc.params.rotate = false;

	    if (classObj === 'socle') {
	        pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," +
	            thickObj / 2 + " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2) +
	            " Z", "#5cba79", "#5cba79", '');
	    }


	    if (classObj === 'doorWindow') {
	        if (typeObj === 'simple') {

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2) + " Z", "#ccc", "none",
	                '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," +
	                (-sizeObj - thickObj / 2) + "  A" + sizeObj + "," + sizeObj + " 0 0,1 " + sizeObj / 2 + "," + (-thickObj / 2), "none", colorWall,
	                '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 40, max: 120 };
	        }
	        if (typeObj === 'double') {

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2) + " Z", "#ccc", "none",
	                '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," +
	                (-sizeObj / 2 - thickObj / 2) + "  A" + sizeObj / 2 + "," + sizeObj / 2 + " 0 0,1 0," + (-thickObj / 2), "none", colorWall,
	                '');

	            pushToConstruc(construc, "M " + (sizeObj / 2) + "," + (-thickObj / 2) + " L " + (sizeObj / 2) + "," +
	                (-sizeObj / 2 - thickObj / 2) + "  A" + sizeObj / 2 + "," + sizeObj / 2 + " 0 0,0 0," + (-thickObj / 2), "none", colorWall,
	                '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 40, max: 160 };
	        }
	        if (typeObj === 'pocket') {
	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-(thickObj / 2) - 4) + " L " + (-sizeObj / 2) + "," +
	                thickObj / 2 + " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-(thickObj / 2) - 4) + " Z", "#ccc",
	                "none",
	                'none');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " M " + (sizeObj / 2) + "," + (thickObj / 2) + " L " + (sizeObj / 2) + "," + (-thickObj / 2), "none", "#494646",
	                '5 5');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," +
	                (-thickObj / 2 - 5) + " L " + (+sizeObj / 2) + "," + (-thickObj / 2 - 5) + " L " + (+sizeObj / 2) +
	                "," + (-thickObj / 2) + " Z", "url(#hatch)", "#494646", '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 60, max: 200 };
	        }
	        if (typeObj === 'aperture') {
	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2) + " Z", "#ccc", "#494646",
	                '5,5');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-(thickObj / 2)) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " L " + ((-sizeObj / 2) + 5) + "," + thickObj / 2 + " L " + ((-sizeObj / 2) + 5) + "," + (-(thickObj / 2)) + " Z", "none",
	                "#494646",
	                'none');

	            pushToConstruc(construc, "M " + ((sizeObj / 2) - 5) + "," + (-(thickObj / 2)) + " L " + ((sizeObj / 2) - 5) + "," + thickObj / 2 +
	                " L " + (sizeObj / 2) + "," + thickObj / 2 + " L " + (sizeObj / 2) + "," + (-(thickObj / 2)) + " Z", "none", "#494646",
	                'none');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 40, max: 500 };
	        }
	        if (typeObj === 'fix') {
	            pushToConstruc(construc, "M " + (-sizeObj / 2) + ",-2 L " + (-sizeObj / 2) + ",2 L " +
	                sizeObj / 2 + ",2 L " + sizeObj / 2 + ",-2 Z", "#ccc", "none", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " M " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2), "none", "#ccc", '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 30, max: 300 };
	        }
	        if (typeObj === 'flap') {

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + ",-2 L " + (-sizeObj / 2) + ",2 L " +
	                sizeObj / 2 + ",2 L " + sizeObj / 2 + ",-2 Z", "#ccc", "none", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " M " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2), "none", "#ccc", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + ((-sizeObj / 2) +
	                ((sizeObj) * 0.866)) + "," + ((-sizeObj / 2) - (thickObj / 2)) + "  A" + sizeObj + "," +
	                sizeObj + " 0 0,1 " + sizeObj / 2 + "," + (-thickObj / 2), "none", colorWall, '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 20, max: 100 };
	        }
	        if (typeObj === 'twin') {

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + ",-2 L " + (-sizeObj / 2) + ",2 L " + sizeObj / 2 +
	                ",2 L " + sizeObj / 2 + ",-2 Z", "#000", "none", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " L " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2), "#fff", "#fff", '', 0.7);

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " M " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2), "none", "#000", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + ((-sizeObj / 2) +
	                ((sizeObj / 2) * 0.866)) + "," + (-sizeObj / 4 - thickObj / 2) + "  A" +
	                sizeObj / 2 + "," + sizeObj / 2 + " 0 0,1 0," + (-thickObj / 2), "none", colorWall, '');

	            pushToConstruc(construc, "M " + (sizeObj / 2) + "," + (-thickObj / 2) + " L " + ((sizeObj / 2) +
	                ((-sizeObj / 2) * 0.866)) + "," + (-sizeObj / 4 - thickObj / 2) + "  A" +
	                sizeObj / 2 + "," + sizeObj / 2 + " 0 0,0 0," + (-thickObj / 2), "none", colorWall, '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 40, max: 200 };
	        }
	        if (typeObj === 'bay') {

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 +
	                " M " + sizeObj / 2 + "," + thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2), "none", "#ccc", '');

	            pushToConstruc(construc, "M " + (-sizeObj / 2) + ",-2 L " + (-sizeObj / 2) + ",0 L 2,0 L 2,2 L 3,2 L 3,-2 Z", "#ccc", "none", '');

	            pushToConstruc(construc, "M -2,1 L -2,3 L " + sizeObj / 2 + ",3 L " + sizeObj / 2 + ",1 L -1,1 L -1,-1 L -2,-1 Z", "#ccc", "none", '');
	            construc.params.resize = true;
	            construc.params.resizeLimit.width = { min: 60, max: 300 };
	        }
	    }

	    if (classObj === 'measure') {
	        construc.params.bindBox = true;
	        pushToConstruc(construc, "M-" + (sizeObj / 2) + ",0 l10,-10 l0,8 l" + (sizeObj - 20) +
	            ",0 l0,-8 l10,10 l-10,10 l0,-8 l-" + (sizeObj - 20) + ",0 l0,8 Z", "#729eeb", "none", '');
	    }

	    if (classObj === 'boundingBox') {

	        pushToConstruc(construc,
	            "M" + (-sizeObj / 2 - 10) + "," + (-thickObj / 2 - 10) + " L" + (sizeObj / 2 + 10) + "," + (-thickObj / 2 - 10) + " L" +
	            (sizeObj / 2 + 10) + "," + (thickObj / 2 + 10) + " L" + (-sizeObj / 2 - 10) + "," + (thickObj / 2 + 10) + " Z", 'none',
	            "#aaa", '');

	        // construc.push({'path':"M"+dividerObj[0].x+","+dividerObj[0].y+" L"+dividerObj[1].x+","+dividerObj[1].y+" L"+dividerObj[2].x+",
	        // "+dividerObj[2].y+" L"+dividerObj[3].x+","+dividerObj[3].y+" Z", 'fill':'none', 'stroke':"#000", 'strokeDashArray': ''});
	    }

	    //typeObj = color  dividerObj = text
	    if (classObj === 'text') {
	        construc.params.bindBox = true;
	        construc.params.move = true;
	        construc.params.rotate = true;
	        construc.push({
	            'text': dividerObj.text,
	            'x': '0',
	            'y': '0',
	            'fill': typeObj,
	            'stroke': typeObj,
	            'fontSize': dividerObj.size + 'px',
	            "strokeWidth": "0px"
	        });
	    }

	    if (classObj === 'stair') {
	        construc.params.bindBox = true;
	        construc.params.move = true;
	        construc.params.resize = true;
	        construc.params.rotate = true;
	        construc.params.width = 60;
	        construc.params.height = 180;
	        if (typeObj === 'simpleStair') {

	            pushToConstruc(construc,
	                "M " + (-sizeObj / 2) + "," + (-thickObj / 2) + " L " + (-sizeObj / 2) + "," + thickObj / 2 + " L " + sizeObj / 2 + "," +
	                thickObj / 2 + " L " + sizeObj / 2 + "," + (-thickObj / 2) + " Z", "#fff", "#000", '');

	            let heightStep = thickObj / (dividerObj);
	            for (let i = 1; i < dividerObj + 1; i++) {
	                pushToConstruc(construc, "M " + (-sizeObj / 2) + "," + ((-thickObj / 2) + (i * heightStep)) + " L " + (sizeObj / 2) + "," +
	                    ((-thickObj / 2) + (i * heightStep)), "none", "#000", 'none');
	            }
	            construc.params.resizeLimit.width = { min: 40, max: 200 };
	            construc.params.resizeLimit.height = { min: 40, max: 400 };
	        }

	    }

	    if (classObj === 'energy') {
	        construc.params.bindBox = true;
	        construc.params.move = true;
	        construc.params.resize = true;
	        construc.params.rotate = true;
          construc.params.resizeLimit = {};
					construc.params.resizeLimit.width = { min: 20, max: 200 };
          construc.params.resizeLimit.height = { min: 20, max: 200 };
					
	        if (typeObj === 'circle') {
            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#333", '');
            construc.params.width = 36;
            construc.params.height = 36;
            construc.family = 'free';
	        }
	        if (typeObj === 'half-circle') {
            pushToConstruc(construc, "m 40 20 L 40 20 C 40 8.95 31.05 0 20 0 C 8.95 0 0 8.95 0 20 L 40 20 Z", "#fff", "#333", '');
            construc.params.width = 40;
            construc.params.height = 20;
            construc.family = 'free';
	        }
					
	        if (typeObj === 'square') {
	            pushToConstruc(construc, "m -20,-20 l 40,0 l0,40 l-40,0 Z", "#fff", "#333", '');
							/*
	            construc.push({
	                'text': "@",
	                'x': '0',
	                'y': '4',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '1.2em',
	                "strokeWidth": "0.4px"
	            });
							*/
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'heart') {
						  // 						construc, path, fill, stroke, strokeDashArray, opacity = 1
	            //pushToConstruc(construc, "m 0,0 c-15,-25,-64,0,-30,35 l30,30 l30,-30 c34,-40,-15,-60,-30,-35", "#f00", "#333", '');
							pushToConstruc(construc, "m 11.73 2.96 C 10.7 4.85 9.24 6.69 7.35 8.49 C 5.46 10.28 3.22 11.99 0.63 13.62 C 0.47 13.72 0.3 13.81 0.13 13.88 C -0.18 14.04 -0.55 14.04 -0.86 13.88 C -1.03 13.81 -1.2 13.72 -1.36 13.62 C -3.94 11.99 -6.18 10.28 -8.07 8.49 C -9.97 6.69 -11.43 4.85 -12.46 2.96 C -13.49 1.06 -14 -0.91 -14 -2.84 C -14 -4.44 -13.66 -5.8 -12.98 -7.04 C -12.35 -8.24 -11.4 -9.24 -10.24 -9.95 C -9.08 -10.65 -7.75 -11.02 -6.39 -11 C -5.04 -11 -3.82 -10.66 -2.81 -9.98 C -1.79 -9.31 -0.95 -8.4 -0.36 -7.34 C 0.22 -8.4 1.06 -9.31 2.08 -9.98 C 3.1 -10.66 4.32 -11 5.66 -11 C 7.02 -11.02 8.36 -10.65 9.51 -9.95 C 10.67 -9.24 11.62 -8.24 12.26 -7.04 C 12.93 -5.8 13.27 -4.44 13.27 -2.84 C 13.27 -0.91 12.76 1.06 11.73 2.96 Z", "#f00", "#333", '');
							
	            construc.params.width = 60;
	            construc.params.height = 60;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'droplet') {
	            pushToConstruc(construc, "m 2 13a5 5 0 0 0 10 0c0-1.73-1.66-5.03-5-9.65C3.66 7.97 2 11.27 2 13zM7 0c4.67 6.09 7 10.42 7 13a7 7 0 0 1-14 0c0-2.58 2.33-6.91 7-13z", "#fff", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'triangle') {
	            pushToConstruc(construc, "m 0 -16.5 L -18 15 L 18 15 Z", "#fff", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'half-rounded-square') {
	            pushToConstruc(construc, "m 20 0 L 20 0 C 20 -11.05 11.05 -20 0 -20 C -11.05 -20 -20 -11.05 -20 0 L -20 20 L 20 20 L 20 0 Z", "#fff", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'flower') {
	            pushToConstruc(construc, "m 4.1 -9.9 C 9.13 -22.03 -9.13 -22.03 -4.1 -9.9 C -9.13 -22.03 -22.03 -9.13 -9.9 -4.1 C -22.03 -9.13 -22.03 9.13 -9.9 4.1 C -22.03 9.13 -9.13 22.03 -4.1 9.9 C -9.13 22.03 9.13 22.03 4.1 9.9 C 9.13 22.03 22.03 9.13 9.9 4.1 C 22.03 9.13 22.03 -9.13 9.9 -4.1 C 22.03 -9.13 9.12 -22.03 4.1 -9.9 Z", "#8f8", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'star') {
	            pushToConstruc(construc, "m 0.5 -11 L -3.42 -4.18 L -11.39 -2.71 L -5.85 2.98 L -6.85 10.71 L 0.5 7.41 L 7.85 10.71 L 6.85 2.98 L 12.39 -2.71 L 4.42 -4.18 Z", "#ff0", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'rounded-square1') {
	            pushToConstruc(construc, "m 9.92 20 C 4.44 20 0 15.52 0 10 C 0 4.48 4.44 0 9.92 0 L 30.08 0 C 35.56 0 40 4.48 40 10 C 40 15.52 35.56 20 30.08 20 L 9.92 20 Z", "#8f8", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'paw') {
	            pushToConstruc(construc, "m 9.87 19 C 6.63 19 5.72 17.22 0 17.22 C -5.72 17.22 -6.63 19 -9.87 19 C -14.29 19 -15.02 15.3 -15.02 13.38 C -15.02 10.12 -12.62 8.11 -8.84 5.24 C -5.15 2.43 -5.03 -1.42 0 -1.42 C 5.03 -1.42 5.15 2.43 8.84 5.24 C 12.62 8.11 15.02 10.12 15.02 13.38 C 15.02 15.3 14.29 19 9.87 19 Z M -6.68 -17.98 C -4.08 -18.3 -1.47 -14.37 -0.97 -10.3 C -0.47 -6.22 -2.28 -3.55 -4.87 -3.23 C -7.47 -2.91 -9.87 -5.07 -10.37 -9.14 C -10.87 -13.21 -9.27 -17.66 -6.68 -17.98 Z M -16.51 -9.31 C -14.17 -10.03 -11.11 -6.83 -9.99 -3.14 C -8.87 0.54 -10.11 3.31 -12.45 4.04 C -14.8 4.76 -17.37 3.15 -18.49 -0.53 C -19.61 -4.22 -18.86 -8.59 -16.51 -9.31 Z M 6.68 -17.98 C 4.08 -18.3 1.47 -14.37 0.97 -10.3 C 0.47 -6.22 2.28 -3.55 4.87 -3.23 C 7.47 -2.91 9.87 -5.07 10.37 -9.14 C 10.87 -13.21 9.27 -17.66 6.68 -17.98 Z M 16.51 -9.31 C 14.17 -10.03 11.11 -6.83 9.99 -3.14 C 8.87 0.54 10.11 3.31 12.46 4.04 C 14.8 4.76 17.37 3.15 18.49 -0.53 C 19.61 -4.22 18.86 -8.59 16.51 -9.31 Z", "#8f8", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
					// 17.85 28.54
	        if (typeObj === 'note') {
	            pushToConstruc(construc, "m 8.85 8.54 C 10.55 6.59 11.47 3.73 11.47 0.59 C 11.47 -5.7 3.62 -8.84 3.62 -8.84 L 3.62 12.96 L 3.62 12.96 C 3.62 14.91 2.1 17.06 -0.35 18.22 C -1.38 18.72 -2.5 18.98 -3.64 19 C -5.49 19 -7.06 18.24 -7.7 16.83 C -7.9 16.4 -8 15.94 -8 15.47 C -8 13.52 -6.47 11.37 -4.03 10.21 C -3 9.71 -1.88 9.44 -0.74 9.43 C 0.53 9.42 1.66 9.79 2.46 10.47 L 2.46 -19 L 3.62 -19 C 3.62 -14.2 6.82 -12.24 9.58 -8.4 C 11.26 -6.05 12.63 -3.42 12.63 -0.29 C 12.63 3.24 11.24 6.33 8.85 8.54 Z", "#8f8", "#333", '');
	            construc.params.width = 20;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
					
	        if (typeObj === 'wifi') {
	            pushToConstruc(construc, "m 16.66 -6.5 C 16.49 -6.33 16.26 -6.23 16.02 -6.23 C 15.78 -6.24 15.56 -6.34 15.39 -6.51 C 11.4 -10.81 5.83 -13.25 0 -13.25 C -5.83 -13.25 -11.4 -10.81 -15.39 -6.51 C -15.56 -6.34 -15.78 -6.24 -16.02 -6.23 C -16.26 -6.23 -16.49 -6.33 -16.66 -6.5 L -18.74 -8.6 C -19.08 -8.93 -19.09 -9.49 -18.76 -9.84 C -13.88 -15.05 -7.1 -18 0 -18 C 7.1 -18 13.88 -15.05 18.76 -9.84 C 19.09 -9.49 19.08 -8.94 18.74 -8.6 Z M 0 -8.47 C 4.63 -8.47 9.04 -6.49 12.14 -3.02 C 12.46 -2.66 12.45 -2.11 12.11 -1.77 L 10.02 0.35 C 9.84 0.53 9.61 0.62 9.36 0.62 C 9.12 0.61 8.88 0.5 8.72 0.31 C 6.52 -2.24 3.34 -3.7 0 -3.7 C -3.34 -3.7 -6.52 -2.24 -8.72 0.31 C -8.88 0.5 -9.11 0.61 -9.36 0.62 C -9.61 0.62 -9.84 0.53 -10.02 0.35 L -12.11 -1.77 C -12.45 -2.11 -12.46 -2.66 -12.13 -3.02 C -9.03 -6.49 -4.62 -8.47 0 -8.47 Z M 0 1.07 C 2.16 1.06 4.2 2.05 5.55 3.75 C 5.83 4.1 5.8 4.62 5.48 4.94 L 0.64 9.74 C 0.28 10.09 -0.28 10.09 -0.64 9.74 L -5.48 4.94 C -5.8 4.62 -5.83 4.1 -5.55 3.75 C -4.2 2.05 -2.15 1.06 0 1.07 Z", "#8f8", "#333", '');
	            construc.params.width = 40;
	            construc.params.height = 25;
	            construc.family = 'free';
	        }
	        if (typeObj === 'bed') {
	            pushToConstruc(construc, "m 10 10 L -10 10 L -10 20 L 10 20 Z", "#fff", "#333", '');
							pushToConstruc(construc, "m 10 -20 L -10 -20 L -10 10 L 10 10 Z", "#ccc", "#333", '');
							pushToConstruc(construc, "m 7 14.5 C 7 13.12 5.88 12 4.5 12 L -4.5 12 C -5.88 12 -7 13.12 -7 14.5 C -7 15.88 -5.88 17 -4.5 17 L 4.5 17 C 5.88 17 7 15.88 7 14.5 Z", "#ccc", "#333", '');
	            construc.params.width = 20;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
					
	        if (typeObj === 'lock') {
	            pushToConstruc(construc, "m 10.31 20 L -10.88 20 C -12.6 20 -14 18.61 -14 16.9 L -14 -0.16 C -14 -1.87 -12.6 -3.26 -10.88 -3.26 L -10.73 -3.26 L -10.73 -9.61 C -10.73 -15.35 -6.05 -20 -0.29 -20 C 5.48 -20 10.16 -15.35 10.16 -9.61 L 10.16 -3.26 L 10.31 -3.26 C 12.03 -3.26 13.43 -1.87 13.43 -0.16 L 13.43 16.9 C 13.43 18.61 12.03 20 10.31 20 Z M 7.04 -9.61 C 7.04 -13.64 3.76 -16.9 -0.29 -16.9 C -4.33 -16.9 -7.61 -13.64 -7.61 -9.61 L -7.61 -3.26 L 7.04 -3.26 L 7.04 -9.61 Z", "#fff", "#333", '');
				      construc.params.width = 25;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
					
	        if (typeObj === 'pill') {
	            pushToConstruc(construc, "M -10.077519 10 C -15.557549 10 -20 5.522842 -20 0 C -20 -5.522842 -15.557549 -10 -10.077519 -10 L 10.077518 -10 C 15.557549 -10 20 -5.522842 20 0 C 20 5.522842 15.557549 10 10.077518 10 L -10.077519 10 Z", "#fff", "#333", '');
				      construc.params.width = 40;
	            construc.params.height = 25;
	            construc.family = 'free';
	        }
					
					
					
					
					
					
					
					
					
					
					
	        if (typeObj === 'gtl') {
	            pushToConstruc(construc, "m -20,-20 l 40,0 l0,40 l-40,0 Z", "#fff", "#333", '');
	            construc.push({
	                'text': "GTL",
	                'x': '0',
	                'y': '5',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '0.9em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'switch') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#333", '');
	            pushToConstruc(construc, qSVG.circlePath(-2, 4, 5), "none", "#333", '');
	            pushToConstruc(construc, "m 0,0 5,-9", "none", "#333", '');
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';

	        }
	        if (typeObj === 'doubleSwitch') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#333", '');
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 4), "none", "#333", '');
	            pushToConstruc(construc, "m 2,-3 5,-8 3,2", "none", "#333", '');
	            pushToConstruc(construc, "m -2,3 -5,8 -3,-2", "none", "#333", '');
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'dimmer') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#333", '');
	            pushToConstruc(construc, qSVG.circlePath(-2, 4, 5), "none", "#333", '');
	            pushToConstruc(construc, "m 0,0 5,-9", "none", "#333", '');
	            pushToConstruc(construc, "M -2,-6 L 10,-4 L-2,-2 Z", "none", "#333", '');

	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'plug') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "M 10,-6 a 10,10 0 0 1 -5,8 10,10 0 0 1 -10,0 10,10 0 0 1 -5,-8", "none", "#333", '');
	            pushToConstruc(construc, "m 0,3 v 7", "none", "#333", '');
	            pushToConstruc(construc, "m -10,4 h 20", "none", "#333", '');
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'plug20') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "M 10,-6 a 10,10 0 0 1 -5,8 10,10 0 0 1 -10,0 10,10 0 0 1 -5,-8", "none", "#333", '');
	            pushToConstruc(construc, "m 0,3 v 7", "none", "#333", '');
	            pushToConstruc(construc, "m -10,4 h 20", "none", "#333", '');

	            construc.push({
	                'text': "20A",
	                'x': '0',
	                'y': '-5',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '0.65em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'plug32') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "M 10,-6 a 10,10 0 0 1 -5,8 10,10 0 0 1 -10,0 10,10 0 0 1 -5,-8", "none", "#333", '');
	            pushToConstruc(construc, "m 0,3 v 7", "none", "#333", '');
	            pushToConstruc(construc, "m -10,4 h 20", "none", "#333", '');

	            construc.push({
	                'text': "32A",
	                'x': '0',
	                'y': '-5',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '0.65em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'roofLight') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "M -8,-8 L 8,8 M -8,8 L 8,-8", "none", "#333", '');

	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'free';
	        }
	        if (typeObj === 'wallLight') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "M -8,-8 L 8,8 M -8,8 L 8,-8", "none", "#333", '');
	            pushToConstruc(construc, "M -10,10 L 10,10", "none", "#333", '');

	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'www') {
	            pushToConstruc(construc, "m -20,-20 l 40,0 l0,40 l-40,0 Z", "#fff", "#333", '');

	            construc.push({
	                'text': "@",
	                'x': '0',
	                'y': '4',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '1.2em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 40;
	            construc.params.height = 40;
	            construc.family = 'free';
	        }
	        if (typeObj === 'rj45') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "m-10,5 l0,-10 m20,0 l0,10", "none", "#333", '');
	            pushToConstruc(construc, "m 0,5 v 7", "none", "#333", '');
	            pushToConstruc(construc, "m -10,5 h 20", "none", "#333", '');

	            construc.push({
	                'text': "RJ45",
	                'x': '0',
	                'y': '-5',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '0.5em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'tv') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "m-10,5 l0-10 m20,0 l0,10", "none", "#333", '');
	            pushToConstruc(construc, "m-7,-5 l0,7 l14,0 l0,-7", "none", "#333", '');
	            pushToConstruc(construc, "m 0,5 v 7", "none", "#333", '');
	            pushToConstruc(construc, "m -10,5 h 20", "none", "#333", '');

	            construc.push({
	                'text': "TV",
	                'x': '0',
	                'y': '-5',
	                'fill': "#333333",
	                'stroke': "none",
	                'fontSize': '0.5em',
	                "strokeWidth": "0.4px"
	            });
	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }

	        if (typeObj === 'heater') {
	            pushToConstruc(construc, qSVG.circlePath(0, 0, 16), "#fff", "#000", '');
	            pushToConstruc(construc, "m-15,-4 l30,0", "none", "#333", '');
	            pushToConstruc(construc, "m-14,-8 l28,0", "none", "#333", '');
	            pushToConstruc(construc, "m-11,-12 l22,0", "none", "#333", '');
	            pushToConstruc(construc, "m-16,0 l32,0", "none", "#333", '');
	            pushToConstruc(construc, "m-15,4 l30,0", "none", "#333", '');
	            pushToConstruc(construc, "m-14,8 l28,0", "none", "#333", '');
	            pushToConstruc(construc, "m-11,12 l22,0", "none", "#333", '');

	            construc.params.width = 36;
	            construc.params.height = 36;
	            construc.family = 'stick';
	        }
	        if (typeObj === 'radiator') {
	            pushToConstruc(construc, "m -20,-10 l 40,0 l0,20 l-40,0 Z", "#fff", "#333", '');
	            pushToConstruc(construc, "M -15,-10 L -15,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M -10,-10 L -10,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M -5,-10 L -5,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M -0,-10 L -0,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M 5,-10 L 5,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M 10,-10 L 10,10", "#fff", "#333", '');
	            pushToConstruc(construc, "M 15,-10 L 15,10", "#fff", "#333", '');

	            construc.params.width = 40;
	            construc.params.height = 20;
	            construc.family = 'stick';

	        }
	    }

	    if (classObj === 'furniture') {
	        construc.params.bindBox = true;
	        construc.params.move = true;
	        construc.params.resize = true;
	        construc.params.rotate = true;
	    }

	    return construc;
	}

	function setBestEqPoint(bestEqPoint, distance, index, x, y, x1, y1, x2, y2, way) {
	    bestEqPoint.distance = distance;
	    bestEqPoint.node = index;
	    bestEqPoint.x = x;
	    bestEqPoint.y = y;
	    bestEqPoint.x1 = x1;
	    bestEqPoint.y1 = y1;
	    bestEqPoint.x2 = x2;
	    bestEqPoint.y2 = y2;
	    bestEqPoint.way = way;
	}

	function pushToRibMaster(ribMaster, firstIndex, secondIndex, wallIndex, crossEdge, side, coords, distance) {
	    ribMaster[firstIndex][secondIndex].push({
	        wallIndex: wallIndex,
	        crossEdge: crossEdge,
	        side: side,
	        coords: coords,
	        distance: distance
	    });
	}

	function pushToConstruc(construc, path, fill, stroke, strokeDashArray, opacity = 1) {
	    construc.push({
	        'path': path,
	        'fill': fill,
	        'stroke': stroke,
	        'strokeDashArray': strokeDashArray,
	        'opacity': opacity
	    });
	}
	
	
	
	
	
	
	function saveSvg(svgEl, name) {
	    svgEl.setAttribute("xmlns", "http://www.w3.org/2000/svg");
	    var svgData = svgEl.outerHTML;
	    var preface = '<?xml version="1.0" standalone="no"?>\r\n';
	    var svgBlob = new Blob([preface, svgData], {type:"image/svg+xml;charset=utf-8"});
	    var svgUrl = URL.createObjectURL(svgBlob);
	    var downloadLink = document.createElement("a");
	    downloadLink.href = svgUrl;
	    downloadLink.download = name;
	    document.body.appendChild(downloadLink);
	    downloadLink.click();
	    document.body.removeChild(downloadLink);
	}
	
	
	function download(filename, text) {
	    var element = document.createElement('a');
	    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
	    element.setAttribute('download', filename);

	    element.style.display = 'none';
	    document.body.appendChild(element);

	    element.click();

	    document.body.removeChild(element);
	}

	// Start file download.
	document.getElementById("extension-floorplanner-svg-download-button").addEventListener("click", function(){
		
		let svg_clone = document.getElementById('extension-floorplanner-lin').cloneNode(true);
		
		
		console.log("svg_clone: ", svg_clone);
		
		//var paths = [].slice.call(svg_clone.querySelectorAll('g#extension-floorplanner-boxgrid path'));
		//paths.forEach(path => { path.remove(); });
		
		//let boxgrid_g = svg_clone.querySelector("g#extension-floorplanner-boxgrid");
		//console.log("boxgrid_g: ", boxgrid_g);
		
		//let boxscale_g = svg_clone.querySelector("g#extension-floorplanner-boxScale");
		//console.log("boxscale_g: ", boxscale_g);
		
		svg_clone.querySelector("g#extension-floorplanner-boxgrid").remove();
		svg_clone.querySelector("g#extension-floorplanner-boxScale").remove();
		svg_clone.querySelector("g#extension-floorplanner-boxRib").remove();
		svg_clone.querySelector("g#extension-floorplanner-boxbind").remove();
		svg_clone.querySelector("g#extension-floorplanner-boxArea").remove();
		
		
		
		saveSvg(svg_clone,"floorplanner.svg");
	    // Generate download of hello.txt file with some content
	    //var text = document.getElementById('extension-floorplanner-lin').textContent; //document.getElementById("text-val").value;
	    //var filename = "rooms.svg";
	    //download(filename, text);
	}, false);
	

	
	function hide_submenus(){
		document.querySelectorAll('.extension-floorplanner-sub').forEach(function (element) {
			element.style.display='none';
		});
	}
	
	function cancel_adding_text(){
    fonc_button('select_mode');
    action = 0;
	}
	
	function toggle_furniture(){
		console.log("in toggle_furniture");
		hide_submenus();
		let energy_list_el = document.getElementById('extension-floorplanner-energy_list');
		
		console.log("display?", energy_list_el.style.display);
		if( energy_list_el.style.display == 'block' ){
			energy_list_el.style.display='none';
		}else{
			energy_list_el.style.display='block';
		}
		
	}
	
	function toggle_layers(){
		hide_submenus();
		document.querySelector('#extension-floorplanner-layer_list').style.display='block';
		/*
		if(layers_list_el.classList.contains('extension-floorplanner-hidden')){
			layers_list_el.classList.remove('extension-floorplanner-hidden');
		}
		else{
			layers_list_el.classList.add('extension-floorplanner-hidden');
		}
		*/
	}
	
	
	function new_floorplan(){
		if(WALLS.length || ROOM.length || OBJDATA.length){
			document.getElementById('extension-floorplanner-plan-exists-warning').style.display = 'block';
		}
		else{
			document.getElementById('extension-floorplanner-plan-exists-warning').style.display = 'none';
		}
		document.querySelector('#extension-floorplanner-myModal').style.display = 'block';
	}
	
	
	function bye_binder(){
		//console.log("in bye_binder. binder: ", binder);
		if (typeof (binder) != 'undefined') {
			if (typeof (binder.graph) == 'undefined'){
				binder.remove();
			}
			else{
				delete binder;
			}
		}
	}
	
	
	function save_object(){
		fonc_button('select_mode');
		document.querySelector('#extension-floorplanner-boxinfo').innerHTML='Selection mode';
		document.querySelector('#extension-floorplanner-objBoundingBox').style.display='none';
		document.querySelector('#extension-floorplanner-panel').style.display='block';
		if(typeof binder != 'undefined' && typeof binder.graph != 'undefined') binder.graph.remove(); // superfluous..
		bye_binder();
	}
	
	/*
	export default class {
	   constructor(mouse_wheel_listener) {  
	      mouse_wheel_listener = mouse_wheel_listener || {}; //this is default value for param.
	      this.id = mouse_wheel_listener.id; 
	      this.title = mouse_wheel_listener.title;
				
				var toFix  = ['wheel', 'mousewheel', 'DOMMouseScroll', 'MozMousePixelScroll'],
		    toBind = ( 'onwheel' in document || document.documentMode >= 9 ) ?
		                ['wheel'] : ['mousewheel', 'DomMouseScroll', 'MozMousePixelScroll'],
		    slice  = Array.prototype.slice,
		    nullLowestDeltaTimeout, lowestDelta;
				
	   }
	}
	*/
	

	//let element = document.getElementById('extension-floorplanner-lin');
	let scale = 1.0;
	let half_scale = 1.0;
	linElement.addEventListener('wheel', (ev) => {
	  // This is crucial. Without it, the browser will do a full page zoom
	  ev.preventDefault();

		//console.log("ev.deltaY: ", ev.deltaY);

	  // This is an empirically determined heuristic.
	  // Unfortunately I don't know of any way to do this better.
	  // Typical deltaY values from a trackpad pinch are under 1.0
	  // Typical deltaY values from a mouse wheel are more than 100.
	  let isPinch = Math.abs(ev.deltaY) < 50;

		// TODO: also move the offset. Attempted with the 'halfscale' variable, but couldnt get it to work quickly enough.
		
	  if (isPinch) {
	    // This is a pinch on a trackpad
			//console.log("scale: ", scale);
			let factor = 1 - (0.01 * ev.deltaY);
			let half_factor = 1 - (0.005 * ev.deltaY);
			//console.log("factor initial : ", factor);
			factor = ((factor - 1) * -1) + 1;
			half_factor = ((half_factor - 1) * -1) + 1;

	    scale *= factor;
			half_scale *= half_factor;
			
			
			
			//originX_viewbox = originX_viewbox * half_scale;
			//originY_viewbox = originY_viewbox * half_scale;
      //originX_viewbox = originX_viewbox - ((width_viewbox / 2) * scale);
      //originY_viewbox = originY_viewbox - ((height_viewbox / 2 * ratio_viewbox) * scale);
			
	    
			
	  } else {
	    // This is a mouse wheel
	    let strength = 1.4;
	    let factor = ev.deltaY < 0 ? strength : 1.0 / strength;
	    scale *= factor;
			console.log("mouse scale: ", scale);
	    //element.innerText = `Mouse: scale is ${scale}`;
	  }
		
		if(scale < 0.5){scale=0.5}
		if(scale > 2){scale=2}
		
		//console.log("pinch scale: ", scale);
		//console.log("pinch scale * -1: ", scale/-1);
    //element.innerText = `Pinch: scale is ${scale}`;
		
		//console.log("taille_w: ", taille_w);
		//console.log("taille_h: ", taille_h);
		//console.log("offset.top: ", offset.top);
		//console.log("offset.left: ", offset.left);
		width_viewbox = taille_w * scale;
		height_viewbox = taille_h * scale;
		//taille_w
		
    //width_viewbox += xmove;
    //let ratioWidthZoom = taille_w / width_viewbox;
    //height_viewbox = width_viewbox * ratio_viewbox;
    myDiv = document.getElementById("extension-floorplanner-scaleVal");
    myDiv.style.width = 60 * scale + 'px';
		
    document.querySelectorAll('#extension-floorplanner-tool-root svg').forEach(function (element) {
		  //console.error("!!! SETTING VIEWBOX 2: ", originX_viewbox, originY_viewbox, width_viewbox,height_viewbox);
      linElement.setAttribute('viewBox', originX_viewbox + ' ' + originY_viewbox + ' ' + width_viewbox + ' ' + height_viewbox);
    });
	});

	
	
	
	//
	// Let's get this party started
	//
	
	window.addEventListener("load", function () {
		console.log("STARTING FLOORPLANNER");
	    //document.getElementById('extension-floorplanner-panel').style.transform = "translateX(100px)";
	    /*document.getElementById('extension-floorplanner-panel').addEventListener("transitionend", function () {
	        document.getElementById('extension-floorplanner-moveBox').style.transform = "translateX(-165px)";
	        document.getElementById('extension-floorplanner-zoomBox').style.transform = "translateX(-165px)";
	    });
			*/
      document.getElementById('extension-floorplanner-moveBox').style.transform = "translateX(-165px)";
      document.getElementById('extension-floorplanner-zoomBox').style.transform = "translateX(-165px)";
			
			document.querySelector('#extension-floorplanner-recover').innerHTML = "<p>Select a plan type.";
	    
			
	    if (localStorage.getItem('extension-floorplanner-history')) {
				setTimeout(() => {
					initHistory('recovery');
				},1000);
	    }
			else{
				myModal.style.display='block';
			}
	});
	
	
	
</script>

</html>